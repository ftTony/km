<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>babel学习 | 小武子知识库</title>
    <meta name="description" content="用心，谈技术。大前端">
    <link rel="icon" href="/hero.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.56546b06.css" as="style"><link rel="preload" href="/assets/js/app.564818ec.js" as="script"><link rel="preload" href="/assets/js/2.67134772.js" as="script"><link rel="preload" href="/assets/js/215.64810e28.js" as="script"><link rel="preload" href="/assets/js/3.65dbdf4c.js" as="script"><link rel="prefetch" href="/assets/js/10.bff4801d.js"><link rel="prefetch" href="/assets/js/100.fdf2766f.js"><link rel="prefetch" href="/assets/js/101.d65638e0.js"><link rel="prefetch" href="/assets/js/102.d787c4a2.js"><link rel="prefetch" href="/assets/js/103.7f251797.js"><link rel="prefetch" href="/assets/js/104.9a87083f.js"><link rel="prefetch" href="/assets/js/105.236c6954.js"><link rel="prefetch" href="/assets/js/106.28b94bc4.js"><link rel="prefetch" href="/assets/js/107.25b9d5bc.js"><link rel="prefetch" href="/assets/js/108.4b46f4c3.js"><link rel="prefetch" href="/assets/js/109.a2f535ab.js"><link rel="prefetch" href="/assets/js/11.874d2f25.js"><link rel="prefetch" href="/assets/js/110.4c59cf9f.js"><link rel="prefetch" href="/assets/js/111.347687ef.js"><link rel="prefetch" href="/assets/js/112.806fa0d4.js"><link rel="prefetch" href="/assets/js/113.b52821d0.js"><link rel="prefetch" href="/assets/js/114.a3664b82.js"><link rel="prefetch" href="/assets/js/115.a64664e5.js"><link rel="prefetch" href="/assets/js/116.68e808d9.js"><link rel="prefetch" href="/assets/js/117.b482b2ea.js"><link rel="prefetch" href="/assets/js/118.8554f454.js"><link rel="prefetch" href="/assets/js/119.1d95244a.js"><link rel="prefetch" href="/assets/js/12.320fc3c1.js"><link rel="prefetch" href="/assets/js/120.a715b464.js"><link rel="prefetch" href="/assets/js/121.6dbbf571.js"><link rel="prefetch" href="/assets/js/122.26d135e4.js"><link rel="prefetch" href="/assets/js/123.fbc44687.js"><link rel="prefetch" href="/assets/js/124.bc9e78af.js"><link rel="prefetch" href="/assets/js/125.ed3fd482.js"><link rel="prefetch" href="/assets/js/126.d16ccf60.js"><link rel="prefetch" href="/assets/js/127.95d25ecc.js"><link rel="prefetch" href="/assets/js/128.7e1465cb.js"><link rel="prefetch" href="/assets/js/129.e7fd87a4.js"><link rel="prefetch" href="/assets/js/13.460cc098.js"><link rel="prefetch" href="/assets/js/130.8c991b8b.js"><link rel="prefetch" href="/assets/js/131.8354902d.js"><link rel="prefetch" href="/assets/js/132.a3118de2.js"><link rel="prefetch" href="/assets/js/133.7d2ac0cc.js"><link rel="prefetch" href="/assets/js/134.044a3437.js"><link rel="prefetch" href="/assets/js/135.65090a23.js"><link rel="prefetch" href="/assets/js/136.7cafff19.js"><link rel="prefetch" href="/assets/js/137.90bb25dc.js"><link rel="prefetch" href="/assets/js/138.f232a0c6.js"><link rel="prefetch" href="/assets/js/139.6a645880.js"><link rel="prefetch" href="/assets/js/14.5bf5a960.js"><link rel="prefetch" href="/assets/js/140.dcdd5f46.js"><link rel="prefetch" href="/assets/js/141.2a03e8ff.js"><link rel="prefetch" href="/assets/js/142.f149d96c.js"><link rel="prefetch" href="/assets/js/143.3b3c270b.js"><link rel="prefetch" href="/assets/js/144.2c841760.js"><link rel="prefetch" href="/assets/js/145.1653af8c.js"><link rel="prefetch" href="/assets/js/146.ae9b9618.js"><link rel="prefetch" href="/assets/js/147.5969fc49.js"><link rel="prefetch" href="/assets/js/148.aa2bbf7b.js"><link rel="prefetch" href="/assets/js/149.b6438a53.js"><link rel="prefetch" href="/assets/js/15.a5a7e987.js"><link rel="prefetch" href="/assets/js/150.8953d47c.js"><link rel="prefetch" href="/assets/js/151.292d731a.js"><link rel="prefetch" href="/assets/js/152.b06fbe00.js"><link rel="prefetch" href="/assets/js/153.6e16db60.js"><link rel="prefetch" href="/assets/js/154.14b5ff9c.js"><link rel="prefetch" href="/assets/js/155.7eff00b3.js"><link rel="prefetch" href="/assets/js/156.00b35e6e.js"><link rel="prefetch" href="/assets/js/157.8660ec42.js"><link rel="prefetch" href="/assets/js/158.795dcf73.js"><link rel="prefetch" href="/assets/js/159.b4f3269b.js"><link rel="prefetch" href="/assets/js/16.cd175a74.js"><link rel="prefetch" href="/assets/js/160.e0050db4.js"><link rel="prefetch" href="/assets/js/161.e5cabb60.js"><link rel="prefetch" href="/assets/js/162.768b3438.js"><link rel="prefetch" href="/assets/js/163.013e403b.js"><link rel="prefetch" href="/assets/js/164.6aaf03fb.js"><link rel="prefetch" href="/assets/js/165.e38d8d10.js"><link rel="prefetch" href="/assets/js/166.7154b1ee.js"><link rel="prefetch" href="/assets/js/167.33ef694f.js"><link rel="prefetch" href="/assets/js/168.902a90ad.js"><link rel="prefetch" href="/assets/js/169.e389c187.js"><link rel="prefetch" href="/assets/js/17.97205d47.js"><link rel="prefetch" href="/assets/js/170.90e80ab1.js"><link rel="prefetch" href="/assets/js/171.97333f8f.js"><link rel="prefetch" href="/assets/js/172.0a6ad74c.js"><link rel="prefetch" href="/assets/js/173.2643a678.js"><link rel="prefetch" href="/assets/js/174.026d596f.js"><link rel="prefetch" href="/assets/js/175.1b8c19eb.js"><link rel="prefetch" href="/assets/js/176.d1ce02da.js"><link rel="prefetch" href="/assets/js/177.eac9a756.js"><link rel="prefetch" href="/assets/js/178.5dc44ee7.js"><link rel="prefetch" href="/assets/js/179.b1c201fb.js"><link rel="prefetch" href="/assets/js/18.790af5f6.js"><link rel="prefetch" href="/assets/js/180.1393f2ce.js"><link rel="prefetch" href="/assets/js/181.d30e7a93.js"><link rel="prefetch" href="/assets/js/182.93626fe8.js"><link rel="prefetch" href="/assets/js/183.d551cf4a.js"><link rel="prefetch" href="/assets/js/184.b2637527.js"><link rel="prefetch" href="/assets/js/185.9cf023c7.js"><link rel="prefetch" href="/assets/js/186.188b921f.js"><link rel="prefetch" href="/assets/js/187.3d50ff8a.js"><link rel="prefetch" href="/assets/js/188.88fa6f17.js"><link rel="prefetch" href="/assets/js/189.5e1c0a35.js"><link rel="prefetch" href="/assets/js/19.12004fb2.js"><link rel="prefetch" href="/assets/js/190.0ddb9b5e.js"><link rel="prefetch" href="/assets/js/191.27a3eeb5.js"><link rel="prefetch" href="/assets/js/192.b1721522.js"><link rel="prefetch" href="/assets/js/193.3aae6b16.js"><link rel="prefetch" href="/assets/js/194.200291e9.js"><link rel="prefetch" href="/assets/js/195.d9dba888.js"><link rel="prefetch" href="/assets/js/196.a33ff6ba.js"><link rel="prefetch" href="/assets/js/197.2313a9a7.js"><link rel="prefetch" href="/assets/js/198.06b6bf91.js"><link rel="prefetch" href="/assets/js/199.e582aff6.js"><link rel="prefetch" href="/assets/js/20.e6f271d0.js"><link rel="prefetch" href="/assets/js/200.c3fe439d.js"><link rel="prefetch" href="/assets/js/201.18957b9c.js"><link rel="prefetch" href="/assets/js/202.7c3d1c44.js"><link rel="prefetch" href="/assets/js/203.7e46f4ed.js"><link rel="prefetch" href="/assets/js/204.98bfbdfd.js"><link rel="prefetch" href="/assets/js/205.7533e78f.js"><link rel="prefetch" href="/assets/js/206.520194c0.js"><link rel="prefetch" href="/assets/js/207.ff010f42.js"><link rel="prefetch" href="/assets/js/208.217043b7.js"><link rel="prefetch" href="/assets/js/209.dad39844.js"><link rel="prefetch" href="/assets/js/21.7f365fd5.js"><link rel="prefetch" href="/assets/js/210.0a395f88.js"><link rel="prefetch" href="/assets/js/211.5cba655c.js"><link rel="prefetch" href="/assets/js/212.0077b7f4.js"><link rel="prefetch" href="/assets/js/213.9c3deda8.js"><link rel="prefetch" href="/assets/js/214.28ccb313.js"><link rel="prefetch" href="/assets/js/216.5118cbb6.js"><link rel="prefetch" href="/assets/js/217.e41d830f.js"><link rel="prefetch" href="/assets/js/218.623613ba.js"><link rel="prefetch" href="/assets/js/219.29aa4e3e.js"><link rel="prefetch" href="/assets/js/22.5ed77f4e.js"><link rel="prefetch" href="/assets/js/220.35380140.js"><link rel="prefetch" href="/assets/js/221.1d3a4034.js"><link rel="prefetch" href="/assets/js/222.490688f9.js"><link rel="prefetch" href="/assets/js/223.c76bd366.js"><link rel="prefetch" href="/assets/js/224.1bf6e862.js"><link rel="prefetch" href="/assets/js/225.5060586a.js"><link rel="prefetch" href="/assets/js/23.0bea0c95.js"><link rel="prefetch" href="/assets/js/24.74cc503d.js"><link rel="prefetch" href="/assets/js/25.9252d64b.js"><link rel="prefetch" href="/assets/js/26.03d52c0b.js"><link rel="prefetch" href="/assets/js/27.cd67cca2.js"><link rel="prefetch" href="/assets/js/28.150c403f.js"><link rel="prefetch" href="/assets/js/29.99abb653.js"><link rel="prefetch" href="/assets/js/30.9228ac62.js"><link rel="prefetch" href="/assets/js/31.c71d9cbb.js"><link rel="prefetch" href="/assets/js/32.9c6c713e.js"><link rel="prefetch" href="/assets/js/33.d4e501d2.js"><link rel="prefetch" href="/assets/js/34.e7eb3fd4.js"><link rel="prefetch" href="/assets/js/35.68951ea8.js"><link rel="prefetch" href="/assets/js/36.20332c62.js"><link rel="prefetch" href="/assets/js/37.6c5dd0b5.js"><link rel="prefetch" href="/assets/js/38.1e3cfc45.js"><link rel="prefetch" href="/assets/js/39.1154d037.js"><link rel="prefetch" href="/assets/js/4.803c74cf.js"><link rel="prefetch" href="/assets/js/40.b234d900.js"><link rel="prefetch" href="/assets/js/41.b9073d8f.js"><link rel="prefetch" href="/assets/js/42.daadc6ad.js"><link rel="prefetch" href="/assets/js/43.77738499.js"><link rel="prefetch" href="/assets/js/44.dc93ffb6.js"><link rel="prefetch" href="/assets/js/45.3c3e26b0.js"><link rel="prefetch" href="/assets/js/46.00105000.js"><link rel="prefetch" href="/assets/js/47.f86a0ede.js"><link rel="prefetch" href="/assets/js/48.b65c96c6.js"><link rel="prefetch" href="/assets/js/49.e43f44dd.js"><link rel="prefetch" href="/assets/js/5.444b0f34.js"><link rel="prefetch" href="/assets/js/50.3dd86efa.js"><link rel="prefetch" href="/assets/js/51.992979d2.js"><link rel="prefetch" href="/assets/js/52.b5918f42.js"><link rel="prefetch" href="/assets/js/53.587d4cf7.js"><link rel="prefetch" href="/assets/js/54.66f0e054.js"><link rel="prefetch" href="/assets/js/55.87e8918e.js"><link rel="prefetch" href="/assets/js/56.2bfca2f2.js"><link rel="prefetch" href="/assets/js/57.3b63d65b.js"><link rel="prefetch" href="/assets/js/58.22424b0e.js"><link rel="prefetch" href="/assets/js/59.b6fe3bd3.js"><link rel="prefetch" href="/assets/js/6.b313ca13.js"><link rel="prefetch" href="/assets/js/60.1bad330b.js"><link rel="prefetch" href="/assets/js/61.3d4de16b.js"><link rel="prefetch" href="/assets/js/62.aaf418cd.js"><link rel="prefetch" href="/assets/js/63.a5454868.js"><link rel="prefetch" href="/assets/js/64.60133553.js"><link rel="prefetch" href="/assets/js/65.8d3a2e66.js"><link rel="prefetch" href="/assets/js/66.1246fddf.js"><link rel="prefetch" href="/assets/js/67.2258c271.js"><link rel="prefetch" href="/assets/js/68.32e3bccc.js"><link rel="prefetch" href="/assets/js/69.679fa724.js"><link rel="prefetch" href="/assets/js/7.7075ee3c.js"><link rel="prefetch" href="/assets/js/70.7828e137.js"><link rel="prefetch" href="/assets/js/71.877f1c63.js"><link rel="prefetch" href="/assets/js/72.12dbe3a2.js"><link rel="prefetch" href="/assets/js/73.60edb2aa.js"><link rel="prefetch" href="/assets/js/74.504c7cce.js"><link rel="prefetch" href="/assets/js/75.91522e6c.js"><link rel="prefetch" href="/assets/js/76.1e73b770.js"><link rel="prefetch" href="/assets/js/77.1aeb958f.js"><link rel="prefetch" href="/assets/js/78.5d349504.js"><link rel="prefetch" href="/assets/js/79.841cffdd.js"><link rel="prefetch" href="/assets/js/8.a6eb682b.js"><link rel="prefetch" href="/assets/js/80.2fdb8c99.js"><link rel="prefetch" href="/assets/js/81.b950b26b.js"><link rel="prefetch" href="/assets/js/82.a1be7291.js"><link rel="prefetch" href="/assets/js/83.40603c2d.js"><link rel="prefetch" href="/assets/js/84.846e5e37.js"><link rel="prefetch" href="/assets/js/85.54ebd9b1.js"><link rel="prefetch" href="/assets/js/86.99dce296.js"><link rel="prefetch" href="/assets/js/87.5fd4dbc9.js"><link rel="prefetch" href="/assets/js/88.ab47a51c.js"><link rel="prefetch" href="/assets/js/89.30653238.js"><link rel="prefetch" href="/assets/js/9.1724c902.js"><link rel="prefetch" href="/assets/js/90.ad64d01a.js"><link rel="prefetch" href="/assets/js/91.9b2a9c50.js"><link rel="prefetch" href="/assets/js/92.be03f2d0.js"><link rel="prefetch" href="/assets/js/93.06ee468d.js"><link rel="prefetch" href="/assets/js/94.56447359.js"><link rel="prefetch" href="/assets/js/95.202192f9.js"><link rel="prefetch" href="/assets/js/96.7112282e.js"><link rel="prefetch" href="/assets/js/97.70468495.js"><link rel="prefetch" href="/assets/js/98.be17b042.js"><link rel="prefetch" href="/assets/js/99.f44d26fa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.56546b06.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小武子知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/js/" class="nav-link">javascript</a></div><div class="nav-item"><a href="/css/" class="nav-link">css</a></div><div class="nav-item"><a href="/html5/" class="nav-link">HTML5</a></div><div class="nav-item"><a href="/tool/" class="nav-link router-link-active">工具</a></div><div class="nav-item"><a href="/project/" class="nav-link">软件工程</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机基础</a></div><div class="nav-item"><a href="/materials/" class="nav-link">资料收集</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于作者</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/js/" class="nav-link">javascript</a></div><div class="nav-item"><a href="/css/" class="nav-link">css</a></div><div class="nav-item"><a href="/html5/" class="nav-link">HTML5</a></div><div class="nav-item"><a href="/tool/" class="nav-link router-link-active">工具</a></div><div class="nav-item"><a href="/project/" class="nav-link">软件工程</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机基础</a></div><div class="nav-item"><a href="/materials/" class="nav-link">资料收集</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于作者</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>git版本工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/git.html" class="sidebar-link">git 常用命令与 gitflow 工作流</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>WEB集成化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/ci-cd.html" class="sidebar-link">CI与CD介绍</a></li><li><a href="/tool/npm-2.html" class="sidebar-link">npm 相关参数</a></li><li><a href="/tool/npm-1.html" class="sidebar-link">私有npm仓库搭建</a></li><li><a href="/tool/webhook.html" class="sidebar-link">webhook</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack打包</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/webpack-basic.html" class="sidebar-link">webpack配置</a></li><li><a href="/tool/webpack-babel.html" class="active sidebar-link">babel学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tool/webpack-babel.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/tool/webpack-babel.html#内容" class="sidebar-link">内容</a></li><li class="sidebar-sub-header"><a href="/tool/webpack-babel.html#参考资料" class="sidebar-link">参考资料</a></li><li class="sidebar-sub-header"><a href="/tool/webpack-babel.html#联系作者" class="sidebar-link">联系作者</a></li></ul></li><li><a href="/tool/webpack-plugin.html" class="sidebar-link">webpack插件</a></li><li><a href="/tool/webpack-loader.html" class="sidebar-link">常用loader学习</a></li><li><a href="/tool/webpack-hmr.html" class="sidebar-link">Webpack HMR 原理解析（转载）</a></li><li><a href="/tool/webpack-interview.html" class="sidebar-link">webpack 面试题</a></li><li><a href="/tool/webpack-coder.html" class="sidebar-link">webpack源码分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>gulp打包</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/gulp-basic.html" class="sidebar-link">gulp 入门学习</a></li><li><a href="/tool/gulp-plugin.html" class="sidebar-link">gulp插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>rollup打包</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/rollup-basic.html" class="sidebar-link">rollup常用配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>自定义脚手架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/cli.html" class="sidebar-link">自定义脚手架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>容器工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/docker.html" class="sidebar-link">docker 学习</a></li><li><a href="/tool/k8s.html" class="sidebar-link">Kubernetes学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ngnix配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/nginx.html" class="sidebar-link">nginx 常用配置</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="babel学习"><a href="#babel学习" aria-hidden="true" class="header-anchor">#</a> babel学习</h1> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>Babel是JavaScript编译器，更确切地说是源码到源码的编译器，通常也叫做“转换编译器”。意思是说你为Babel提供一些JavaScript代码，Babel更改这些代码，然后返回给你新生成的代码。</p> <h2 id="内容"><a href="#内容" aria-hidden="true" class="header-anchor">#</a> 内容</h2> <ul><li>抽象语法树</li> <li>Babel 的处理步骤</li> <li>其他配套工具</li> <li>Babel插件实践</li></ul> <h3 id="一、抽象语法树"><a href="#一、抽象语法树" aria-hidden="true" class="header-anchor">#</a> 一、抽象语法树</h3> <p>这个处理过程中的每一步都涉及到创建或是操作抽象语法树，亦称 AST。</p> <blockquote><p>Babel 使用一个基于 ESTree 并修改过的 AST，它的内核说明文档可以在<a href="https://github.com/babel/babel/blob/master/doc/ast/spec.md" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>找到。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>function square(n) {
  return n * n;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p><a href="http://astexplorer.net/" target="_blank" rel="noopener noreferrer">AST Explorer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以让你对 AST 节点有一个更好的感性认识。 <a href="http://astexplorer.net/#/Z1exs6BWMq" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是上述代码的一个示例链接。</p></blockquote> <p>这个程序可以被表示成如下的一棵树：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- FunctionDeclaration:
  - id:
    - Identifier:
      - name: square
  - params [1]
    - Identifier
      - name: n
  - body:
    - BlockStatement
      - body [1]
        - ReturnStatement
          - argument
            - BinaryExpression
              - operator: *
              - left
                - Identifier
                  - name: n
              - right
                - Identifier
                  - name: n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>或是如下所示的 JavaScript Object（对象）：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  type: &quot;FunctionDeclaration&quot;,
  id: {
    type: &quot;Identifier&quot;,
    name: &quot;square&quot;
  },
  params: [{
    type: &quot;Identifier&quot;,
    name: &quot;n&quot;
  }],
  body: {
    type: &quot;BlockStatement&quot;,
    body: [{
      type: &quot;ReturnStatement&quot;,
      argument: {
        type: &quot;BinaryExpression&quot;,
        operator: &quot;*&quot;,
        left: {
          type: &quot;Identifier&quot;,
          name: &quot;n&quot;
        },
        right: {
          type: &quot;Identifier&quot;,
          name: &quot;n&quot;
        }
      }
    }]
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>你会留意到 AST 的每一层都拥有相同的结构：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  type: &quot;FunctionDeclaration&quot;,
  id: {...},
  params: [...],
  body: {...}
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>{
  type: &quot;Identifier&quot;,
  name: ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>{
  type: &quot;BinaryExpression&quot;,
  operator: ...,
  left: {...},
  right: {...}
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>注意：出于简化的目的移除了某些属性</p></blockquote> <p>这样的每一层结构也被叫做<strong>节点（Node）</strong>。一个AST可以由单一的节点或是成百上千个节点构成。它们组合在一些可以描述用于静态分析的程序语法。</p> <p>每一个节点都有如下所示的接口（Interface）：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>interface Node {
  type: string;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>字符串形式的<code>type</code>字段表示节点的类型（如：<code>&quot;FunctionDeclaration&quot;</code>，<code>&quot;Identifier&quot;</code>，<code>&quot;BinaryExpression&quot;</code>）。每一种类型的节点定义了一些附加属性用来进一步描述该节点类型。</p> <p>Babel还为每个节点额外生成了一些属性，用于描述该节点在原始代码中的位置。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  type: ...,
  start: 0,
  end: 38,
  loc: {
    start: {
      line: 1,
      column: 0
    },
    end: {
      line: 3,
      column: 1
    }
  },
  ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>每一个节点都会有<code>start</code>，<code>end</code>，<code>loc</code>这几个属性。</p> <h3 id="二、babel-的处理步骤"><a href="#二、babel-的处理步骤" aria-hidden="true" class="header-anchor">#</a> 二、Babel 的处理步骤</h3> <p>Babel的三个主要处理步骤分别是：<strong>解析(parse)</strong>，<strong>转换(transform)</strong>，<strong>生成(generate)</strong>。</p> <h4 id="_2-1-解析"><a href="#_2-1-解析" aria-hidden="true" class="header-anchor">#</a> 2.1 解析</h4> <p>将代码解析成抽象语法树(AST)，每个js引擎(比如Chrome浏览器中的V8引擎)都有自己的AST解析器，而Babel是通过<a href="https://github.com/babel/babylon" target="_blank" rel="noopener noreferrer">Babylon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>实现的。在解析过程中有两个阶段：<strong>词法分析</strong>和<strong>语法分析</strong>，词法分析阶段把字符串形式的代码转换为<strong>令牌</strong>(tokens)流，令牌类似于AST中节点；而语法分析阶段则会把一个令牌流转换成AST的形式，同时这个阶段会把令牌中的信息转换成AST的表述结构。</p> <p><strong>词法分析</strong></p> <p>词法分析阶段把字符串形式的代码转换为<strong>令牌</strong>流。</p> <p>你可以把令牌看作是一个扁平的语法片段数组：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>n * n;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>[
  { type: { ... }, value: &quot;n&quot;, start: 0, end: 1, loc: { ... } },
  { type: { ... }, value: &quot;*&quot;, start: 2, end: 3, loc: { ... } },
  { type: { ... }, value: &quot;n&quot;, start: 4, end: 5, loc: { ... } },
  ...
]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>每一个<code>type</code>有一组属性来描述该令牌：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  type: {
    label: 'name',
    keyword: undefined,
    beforeExpr: false,
    startsExpr: true,
    rightAssociative: false,
    isLoop: false,
    isAssign: false,
    prefix: false,
    postfix: false,
    binop: null,
    updateContext: null
  },
  ...
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>和AST节点一样它们也有<code>start</code>、<code>end</code>、<code>loc</code>属性。</p> <p><strong>语法分析</strong></p> <p>语法分析阶段会把一个令牌流转换成AST的形式。这个阶段会使用令牌中的信息把它们转换成一个AST的表述结构，这样更易于后续的操作。</p> <h4 id="_2-2-转换"><a href="#_2-2-转换" aria-hidden="true" class="header-anchor">#</a> 2.2 转换</h4> <p>转换步骤接收AST并对其进行遍历，在此过程中对节点进行添加、更新及移除等操作。这是Babel或是其他编译器中最复杂的过程同时也是插件将要介入工作的部分。</p> <h4 id="_2-3-生成"><a href="#_2-3-生成" aria-hidden="true" class="header-anchor">#</a> 2.3 生成</h4> <p>代码生成步骤把最终（经过一系列转换之后）的AST转换成字符串形式的代码，同时还会创建源码映射。</p> <p>代码生成其实很简单：深度优先遍历整个 AST，然后构建可以表示转换后代码的字符串。</p> <p>为了了解Babel在遍历时处理AST的具体过程，我们还需要了解下面几个重要知识点。</p> <h4 id="_2-4-visitor"><a href="#_2-4-visitor" aria-hidden="true" class="header-anchor">#</a> 2.4 Visitor</h4> <p>当Babel处理一个节点时，是以访问者的形式获取节点信息，并进行相关操作，这种方式是通过一个visitor对象来完成的，在visitor对象中定义了对于各种节点的访问函数，这样就可以针对不同的节点做出不同的处理。我们编写的Babel插件其实也是通过定义一个实例化visitor对象处理一系列的AST节点来完成我们圣代的修改操作。举个例子：</p> <p>我们想要处理代码中用来加载模块的import命令语句</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import { Ajax } from '../lib/utils';
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么我们的Babel插件就需要定义这样的一个visitor对象：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>visitor: {
            Program: {
                enter(path, state) {
                    console.log('start processing this module...');
                },
                exit(path, state) {
                    console.log('end processing this module!');
                }
            },
    	    ImportDeclaration (path, state) {
            	console.log('processing ImportDeclaration...');
            	// do something
            }
	}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>当把这个插件用于遍历中时，每当处理到一个import语句，即ImportDeclaration节点时，都会自动调用ImportDeclaration()方法，这个方法中定义了处理import语句具体操作。</p> <h4 id="_2-5-path"><a href="#_2-5-path" aria-hidden="true" class="header-anchor">#</a> 2.5 Path</h4> <p>从上面的visitor对象中，可以看到每次访问节点方法时，都会传入一个path参数，这个path参数中包含了节点的信息以及节点和所在的位置，以供对特定节点进行操作。具体来说Path 是表示两个节点之间连接的对象。这个对象不仅包含了当前节点的信息，也有当前节点的父节点的信息，同时也包含了添加、更新、移动和删除节点有关的其他很多方法。具体地，Path对象包含的属性和方法主要如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>── 属性      
  - node   当前节点
  - parent  父节点
  - parentPath 父path
  - scope   作用域
  - context  上下文
  - ...
── 方法
  - get   当前节点
  - findParent  向父节点搜寻节点
  - getSibling 获取兄弟节点
  - replaceWith  用AST节点替换该节点
  - replaceWithMultiple 用多个AST节点替换该节点
  - insertBefore  在节点前插入节点
  - insertAfter 在节点后插入节点
  - remove   删除节点
  - ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_2-6-state"><a href="#_2-6-state" aria-hidden="true" class="header-anchor">#</a> 2.6 State</h4> <p>状态是抽象语法树 AST 转换的敌人，状态管理会不断牵扯我们的精力，而且几乎所有你对状态的假设，总是会有一些未考虑到的语法最终证明你的假设是错误的。</p> <h4 id="_2-7-scopes-作用域"><a href="#_2-7-scopes-作用域" aria-hidden="true" class="header-anchor">#</a> 2.7 Scopes(作用域)</h4> <p>在 JavaScript 中，每当你创建了一个引用，不管是通过变量（variable）、函数（function）、类型（class）、参数（params）、模块导入（import）还是标签（label）等，它都属于当前作用域。</p> <h3 id="三、babel使用方法"><a href="#三、babel使用方法" aria-hidden="true" class="header-anchor">#</a> 三、Babel使用方法</h3> <ul><li>使用方法</li> <li>插件</li> <li>配置文件</li> <li>preset</li> <li>执行顺序</li> <li>插件和 preset 的配置项</li> <li>env (重点)</li></ul> <h4 id="_3-1-使用方法"><a href="#_3-1-使用方法" aria-hidden="true" class="header-anchor">#</a> 3.1 使用方法</h4> <p>总共存在三种方法：</p> <ul><li>使用单体文件(standalone script)</li> <li>命令行(cli)</li> <li>构建工具的插件(webpack的babel-loader,rollup的rollup-plugin-babel)。</li></ul> <p>其中后面两种比较常见。第二种多见于package.json中的<code>scripts</code>段落中的某条命令；第三种就直接集成到构建工具中。</p> <p>这三种方式只有入口不同而已，调用的 babel 内核，处理方式都是一样的，所以我们先不纠结入口的问题。</p> <h4 id="_3-2-插件"><a href="#_3-2-插件" aria-hidden="true" class="header-anchor">#</a> 3.2 插件</h4> <p>babel本身不具有任何转化功能，它把转化的功能都分解到一个个plugin里面。因此当我们不配置任何插件时，经过babel的代码和输入是相同的。</p> <p>插件总共分为两种：</p> <ul><li>当我们添加<strong>语法插件</strong>之后，在解析这一步就使得babel能够解析更多的语法。（顺带一提，babel内部使用的解析类库叫做babylon，并非babel自行开发）</li></ul> <p>举个简单的例子，当我们定义或者调用方法时，最后一个参数之后是不允许增加逗号的，如<code>callFoo(param1, param2,)</code>就是非法的。如果源码是这种写法，经过 babel 之后就会提示语法错误。</p> <p>但最近的 JS 提案中已经允许了这种新的写法(让代码 diff 更加清晰)。为了避免 babel 报错，就需要增加语法插件<code>babel-plugin-syntax-trailing-function-commas</code></p> <ul><li>当我们添加<strong>转译插件</strong>之后，在转换这一步把源码转换并输出。这也是我们使用babel最本质的需求。</li></ul> <p>比起语法插件，转译插件其实更好理解，比如箭头函数<code>(a) =&gt; a</code>就会转化为<code>function (a) {return a}</code>。完成这个工作的插件叫做<code>babel-plugin-transform-es2015-arrow-functions</code>。</p> <p>同一类语法可能同时存在语法插件版本和转译插件版本。如果我们使用了转译插件，就不用再使用语法插件了。</p> <h4 id="_3-3-配置文件"><a href="#_3-3-配置文件" aria-hidden="true" class="header-anchor">#</a> 3.3 配置文件</h4> <p>既然插件是babel的根本，那如何使用呢？总共分为2个步骤：</p> <ol><li>将插件的名字增加到配置文件中(根目录下创建 .babelrc 或者 package.json 的<code>babel</code>里面，格式相同)</li> <li>使用<code>npm install babel-plugin-xxx</code>进行安装</li></ol> <h4 id="_3-4-preset"><a href="#_3-4-preset" aria-hidden="true" class="header-anchor">#</a> 3.4 preset</h4> <p>preset 分为以下几种：</p> <ol><li>官方内容，目前包括env,react, flow, minify 等。这里最重要的是 env，后面会详细介绍。</li> <li>stage-x，这里面包含的都是当年最新规范的草案，每年更新。
<ul><li>Stage 0 - 稻草人：只是一个想法，经过TC39成员提出即可。</li> <li>Stage 1 - 提案：初步尝试。</li> <li>Stage 2 - 初稿：完成初步规范。</li> <li>Stage 3 - 候选：完成规范和浏览器初步实现。</li> <li>Stage 4 - 完成：将被添加到下一年度发布。
例如<code>syntax-dynamic-import</code>就是stage-2的内容，<code>transform-object-rest-spread</code>就是stage-3的内容。</li></ul></li></ol> <p>此外，低一级的stage会包含所有高级stage的内容，例如 stage-1 会包含 stage-2, stage-3 的所有内容。</p> <p>stage-4 在下一年更新会直接放到 env 中，所以没有单独的 stage-4 可供使用。</p> <ol start="3"><li>es201x,latest</li></ol> <p>这些是已经纳入到标准规范的语法。例如 es2015 包含 <code>arrow-functions</code>，es2017 包含 <code>syntax-trailing-function-commas</code>。但因为 env 的出现，使得 es2016 和 es2017 都已经废弃。所以我们经常可以看到 es2015 被单独列出来，但极少看到其他两个。</p> <p>latest 是 env 的雏形，它是一个每年更新的 preset，目的是包含所有 es201x。但也是因为更加灵活的 env 的出现，已经废弃。</p> <h4 id="_3-5-执行顺序"><a href="#_3-5-执行顺序" aria-hidden="true" class="header-anchor">#</a> 3.5 执行顺序</h4> <p>很简单的几条原则：</p> <ul><li>Plugin 会运行在 Preset 之前。</li> <li>Plugin 会从前到后顺序执行。</li> <li>Preset 的顺序则<strong>刚好相反</strong>(从后向前)。</li></ul> <p>preset的逆向顺序主要是为了保证向后兼容，因为大多数用户的编写顺序是<code>['es2015', 'stage-0']</code>。这样必须先执行<code>stage-0</code>才能确保babel不报错。因此我们编排preset的时候，也要注意顺序，<strong>其实只要按照规范的时间顺序列出即可</strong>。</p> <h4 id="_3-6-插件和-preset-的配置项"><a href="#_3-6-插件和-preset-的配置项" aria-hidden="true" class="header-anchor">#</a> 3.6 插件和 preset 的配置项</h4> <p>简略情况下，插件和 preset 只要列出字符串格式的名字即可。但如果某个 preset 或者插件需要一些配置项(或者说参数)，就需要把自己先变成数组。第一个元素依然是字符串，表示自己的名字；第二个元素是一个对象，即配置对象。</p> <p>最需要配置的当属 env，如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;presets&quot;: [
    // 带了配置项，自己变成数组
    [
        // 第一个元素依然是名字
        &quot;env&quot;,
        // 第二个元素是对象，列出配置项
        {
          &quot;module&quot;: false
        }
    ],

    // 不带配置项，直接列出名字
    &quot;stage-2&quot;
]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-7-env-重点"><a href="#_3-7-env-重点" aria-hidden="true" class="header-anchor">#</a> 3.7 env (重点)</h4> <p>因为env最为常用也最重要，所以我们必须重点关注。</p> <p>env的核心目的是通过配置得知目标环境的特点，然后只做必要的转换。例如目标浏览器支持es2015，那么es2015这个preset其实是不需要的，于是代码就可以小一点(一般转化后的代码总是更长)，构建时间也可以缩短一些。</p> <p>如果不写任何任何配置项，env等价于latest，也等价于 es2015 + es2016 + es2017 三个相加(不包含 stage-x 中的插件)。env 包含的插件列表维护在<a href="https://github.com/babel/babel-preset-env/blob/master/data/plugin-features.js" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>下面列出几种比较常用的配置方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;presets&quot;:[
        {
            &quot;env&quot;:{
                &quot;targets&quot;:[&quot;last 2 versions&quot;, &quot;safari &gt;= 7&quot;]
            }
        }
    ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如上配置将考虑所有浏览器的最新2个版本(safari大于等于7.0的版本)的特性，将必要的代码进行转换。而这些版本已有的功能就不进行转化了。这里的语法可以参考<a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener noreferrer">browserslist<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;presets&quot;: [
    [&quot;env&quot;, {
      &quot;targets&quot;: {
        &quot;node&quot;: &quot;6.10&quot;
      }
    }]
  ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如上配置将目标设置为nodejs，并且支持6.10及鸡皮疙瘩版本。也可以使用<code>node: 'current'</code>来支持最新稳定版本。例如箭头函数在nodejs6及以上将不被转化，但如果nodejs 0.12就会被转化了。</p> <p>另外一个有用的配置项是<code>modules</code>。它的取值可以是<code>amd</code>, <code>umd</code>, <code>systemjs</code>, <code>commonjs</code> 和 <code>false</code>。这可以让 babel 以特定的模块化格式来输出代码。如果选择<code>false</code> 就不进行模块化处理。</p> <h3 id="四、其他配套工具"><a href="#四、其他配套工具" aria-hidden="true" class="header-anchor">#</a> 四、其他配套工具</h3> <ul><li>babel-cli</li> <li>babel-node</li> <li>babel-register</li> <li>babel-polyfill</li> <li>babel-runtime 和 babel-plugin-transform-runtime</li> <li>babel-loader</li> <li>babylon</li> <li>babel-traverse</li> <li>babel-types</li></ul> <h4 id="_4-1-babel-cli"><a href="#_4-1-babel-cli" aria-hidden="true" class="header-anchor">#</a> 4.1 babel-cli</h4> <p>顾名思义，cli就是命令行工具。安装了<code>babel-cli</code>就能够在命令行中使用<code>babel</code>命令来编译文件。</p> <p>在开发npm package时经常会使用如下模式：</p> <ul><li>把<code>babel-cli</code>安装为<code>devDependencies</code></li> <li>在package.json中添加<code>scripts</code>(比如<code>prepublish</code>)，使用<code>babel</code>命令编译文件</li> <li><code>npm puhlish</code></li></ul> <p>这样既可以使用较新规范的JS语法编写源码，同时又能支持旧版环境。因为项目可能不太大，用不到构建工具(webpack或者rollup)，于是在发布之前用<code>babel-cli</code>进行处理。</p> <h4 id="_4-2-babel-node"><a href="#_4-2-babel-node" aria-hidden="true" class="header-anchor">#</a> 4.2 babel-node</h4> <p><code>babel-node</code>是<code>babel-cli</code>的一部分，它不需要单独安装。</p> <p>它的作用是在node环境中，直接运行es2015的代码，而不需要额外进行转码。例如我们有一个js文件以es2015的语法进行编写进行编写(如使用了箭头函数)。我们可以直接使用<code>babel-node es2015.js</code>进行执行，而不用再进行转码了。</p> <p>可以说：<code>babel-node</code> = <code>babel-polyfill</code> + <code>babel-register</code>。</p> <h4 id="_4-3-babel-register"><a href="#_4-3-babel-register" aria-hidden="true" class="header-anchor">#</a> 4.3 babel-register</h4> <p>babel-register模块必写<code>require</code>命令，为它加上一个钩子。此后，每当使用<code>require</code>加载<code>.js</code>、<code>.jsx</code>、<code>.es</code>和<code>.es6</code>后缀名的文件，就会先用babel进行转码。</p> <p>使用时，必须首先加载<code>require('babel-register')</code>。</p> <p>需要注意的是，babel-register只会对<code>require</code>命令加载的文件转码，而<strong>不会对当前文件转码</strong>。</p> <p>另外，由于它是实时转码，所以<strong>只适合在开发环境使用</strong>。</p> <h4 id="_4-4-babel-polyfill"><a href="#_4-4-babel-polyfill" aria-hidden="true" class="header-anchor">#</a> 4.4 babel-polyfill</h4> <p>babel 默认只转换 js 语法，而不转换新的 API，比如 Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise 等全局对象，以及一些定义在全局对象上的方法(比如<code>Object.assign</code>)都不会转码。</p> <p>举例来说，es2015在Array对象上新增了<code>Array.from</code>方法。babel就不会转码这个方法。如果想让这个方法运行，必须使用<code>babel-polyfill</code>。(内部集成了<code>core-js</code>和<code>regenerator</code>)</p> <p>使用时，在所有代码运行之前增加<code>require('babel-polyfill')</code>。或者更常规的操作是在<code>webpack.config.js</code>中将<code>babel-polyfill</code>作为第一个entry。因此必须把<code>babel-polyfill</code>作为<code>dependencies</code>而不是<code>devDependencies</code></p> <p><code>babel-polyfill</code>主要有两个缺点：</p> <ul><li>使用<code>babel-polyfill</code>会导致打出来的包非常大，因为<code>babel-polyfill</code>是一个整体，把所有方法都加到原型链上。比如我们只使用了<code>Array.from</code>，但它把<code>Object.defineProperty</code>也给加上了，这就是一种浪费了。这个问题可以通过单独<code>core-js</code>的某个类库来解决，<code>core-js</code>都是分开的。</li> <li>``</li></ul> <p>因此在实际使用中，如果我们无法忍受这两个缺点(尤其是第二个)，通常我们会倾向于使用<code>babel-plugin-transform-runtime</code>。</p> <p>但如果代码中包含高版本 js 中类型的实例方法 (例如<code>[1,2,3].includes(1)</code>)，这还是要使用 polyfill。</p> <h4 id="_4-5-babel-runtime-和-babel-plugin-transform-runtime"><a href="#_4-5-babel-runtime-和-babel-plugin-transform-runtime" aria-hidden="true" class="header-anchor">#</a> 4.5 babel-runtime 和 babel-plugin-transform-runtime</h4> <p>我们时常在项目中看到.babelrc中使用<code>babel-plugin-transform-runtime</code>，而<code>package.json</code>中的<code>dependencies</code>(注意不是<code>devDependencies</code>)又包含了<code>babel-runtime</code>，那这两个是不是成套使用的呢？他们又起什么作用呢？</p> <p>先说<code>babel-plugin-transform-runtime</code>。</p> <p>babel会转换js语法，之前已经提过了。以<code>async/await</code>举例，如果不使用这个plugin(即默认情况)，转换后的代码大概是：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// babel 添加一个方法，把 async 转化为 generator
function _asyncToGenerator(fn) { return function () {....}} // 很长很长一段

// 具体使用处
var _ref = _asyncToGenerator(function* (arg1, arg2) {
  yield (0, something)(arg1, arg2);
});

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_4-6-babel-loader"><a href="#_4-6-babel-loader" aria-hidden="true" class="header-anchor">#</a> 4.6 babel-loader</h4> <p>前面提过 babel 的三种使用方法，并且已经介绍过了 babel-cli。但一些大型的项目都会有构建工具 (如 webpack 或 rollup) 来进行代码构建和压缩 (uglify)。理论上来说，我们也可以对压缩后的代码进行 babel 处理，但那会非常慢。因此如果在 uglify 之前就加入 babel 处理，岂不完美？</p> <p>所以就有了 babel 插入到构建工具内部这样的需求。以(我还算熟悉的) webpack 为例，webpack 有 loader 的概念，因此就出现了 babel-loader。</p> <p>和<code>babel-cli</code>一样，<code>babel-loader</code>也会读取 .babelrc 或者 package.json 中的<code>babel</code>段作为自己的配置，之后的内核处理也是相同。唯一比<code>babel-cli</code>复杂的是，它需要和 webpack 交互，因此需要在 webpack 这边进行配置。比较常见的如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /(node_modules|bower_components)/,
      loader: 'babel-loader'
    }
  ]
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果想在这里传入 babel 的配置项，也可以把改成：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// loader: 'babel-loader' 改成如下：
use: {
  loader: 'babel-loader',
  options: {
    // 配置项在这里
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这里的配置项优先级是最高的。但我认为放到单独的配置文件中更加清晰合理，可读性强一些。</p> <h4 id="_4-7-babylon"><a href="#_4-7-babylon" aria-hidden="true" class="header-anchor">#</a> 4.7 Babylon</h4> <p>&quot;&quot;可以说Babylon定义了把代码解析成AST的一套规范。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import * as babylon from &quot;babylon&quot;;
const code = `function square(n) {
  return n * n;
}`;

babylon.parse(code);
// Node {
//   type: &quot;File&quot;,
//   start: 0,
//   end: 38,
//   loc: SourceLocation {...},
//   program: Node {...},
//   comments: [],
//   tokens: [...]
// }

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_4-8-babel-traverse"><a href="#_4-8-babel-traverse" aria-hidden="true" class="header-anchor">#</a> 4.8 babel-traverse</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>import * as babylon from &quot;babylon&quot;;
import traverse from &quot;babel-traverse&quot;;

const code = `function square(n) {
  return n * n;
}`;

const ast = babylon.parse(code);

traverse(ast, {
  enter(path) {
    if (
      path.node.type === &quot;Identifier&quot; &amp;&amp;
      path.node.name === &quot;n&quot;
    ) {
      path.node.name = &quot;x&quot;;
    }
  }
});

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_4-9-babel-types"><a href="#_4-9-babel-types" aria-hidden="true" class="header-anchor">#</a> 4.9 babel-types</h4> <h4 id="小结"><a href="#小结" aria-hidden="true" class="header-anchor">#</a> 小结</h4> <table><thead><tr><th>名称</th> <th>作用</th> <th>备注</th></tr></thead> <tbody><tr><td>babel-cli</td> <td>允许命令行使用babel命令转译文件</td> <td></td></tr> <tr><td>babel-node</td> <td>允许命令行使用babel-node直接转译+执行node文件</td> <td>随<code>babel-cli</code>一同安装 <code>babel-node</code>=<code>babel-polyfill</code>+<code>babel-register</code></td></tr> <tr><td>babel-register</td> <td>改写<code>require</code>命令，为其加载的文件进行转码，不对当前文件转码</td> <td>只适用于开发环境</td></tr> <tr><td>babel-polyfill</td> <td>为所有 API 增加兼容方法</td> <td>需要在所有代码之前<code>require</code>，且体积比较大</td></tr> <tr><td>babel-plugin-transform-runtime &amp; babel-runtime</td> <td>把帮助类方法从每次使用前定义改为统一 <code>require</code>，精简代码</td> <td><code>babel-runtime</code>需要安装为依赖，而不是开发依赖</td></tr> <tr><td>babel-loader</td> <td>使用 webpack 时作为一个 loader 在代码混淆之前进行代码转换</td> <td></td></tr></tbody></table> <h3 id="五、babel插件实践"><a href="#五、babel插件实践" aria-hidden="true" class="header-anchor">#</a> 五、Babel插件实践</h3> <h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://juejin.im/post/5c19c5e0e51d4502a232c1c6" target="_blank" rel="noopener noreferrer">一口(很长的)气了解 babel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5c21b584e51d4548ac6f6c99" target="_blank" rel="noopener noreferrer">深入Babel，这一篇就够了<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s/XSzQ5nkLI369CDhMZtF-MQ" target="_blank" rel="noopener noreferrer">前端中的编译原理 - 从零打造一个实用的 Babel 插件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s/HdIvS75nJ0JFStoNPIl7Iw" target="_blank" rel="noopener noreferrer">前端工程师需要了解的 Babel 知识<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5d94bfbf5188256db95589be" target="_blank" rel="noopener noreferrer">深入浅出 Babel 上篇：架构和原理 + 实战<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5da12397e51d4578364f6ffa" target="_blank" rel="noopener noreferrer">深入浅出 Babel 下篇：既生 Plugin 何生 Macros<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md" target="_blank" rel="noopener noreferrer">Babel 插件手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/frontend9/fe9-library/issues/154" target="_blank" rel="noopener noreferrer">Babel 插件原理的理解与深入<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="联系作者"><a href="#联系作者" aria-hidden="true" class="header-anchor">#</a> 联系作者</h2> <div align="center"><p>
        平凡世界，贵在坚持。
    </p> <img src="/about/contact.png"></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">2018-4-21 17:38:25</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tool/webpack-basic.html" class="prev">webpack配置</a></span> <span class="next"><a href="/tool/webpack-plugin.html">webpack插件</a>→
    </span></p></div> </main></div><div class="global-ui"><!----><!----><div></div></div></div>
    <script src="/assets/js/app.564818ec.js" defer></script><script src="/assets/js/2.67134772.js" defer></script><script src="/assets/js/215.64810e28.js" defer></script><script src="/assets/js/3.65dbdf4c.js" defer></script>
  </body>
</html>
