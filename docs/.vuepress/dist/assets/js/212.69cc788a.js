(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{433:function(s,e,n){"use strict";n.r(e);var a=n(13),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"keep-alive-学习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#keep-alive-学习"}},[s._v("#")]),s._v(" keep-alive 学习")]),s._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("h2",{attrs:{id:"内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内容"}},[s._v("#")]),s._v(" 内容")]),s._v(" "),n("ul",[n("li",[s._v("用法")]),s._v(" "),n("li",[s._v("实现原理")]),s._v(" "),n("li",[s._v("缓存策略")])]),s._v(" "),n("h3",{attrs:{id:"一、用法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、用法"}},[s._v("#")]),s._v(" 一、用法")]),s._v(" "),n("p",[s._v("官方文档中"),n("code",[s._v("keep-alive")]),s._v("的用法。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<keep-alive>\n  <component :is="view"></component>\n</keep-alive>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"_1-1-props"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-props"}},[s._v("#")]),s._v(" 1.1 props")]),s._v(" "),n("ul",[n("li",[s._v("includes：只有名称匹配的组件才会被缓存")]),s._v(" "),n("li",[s._v("excludes：任何名称匹配的组件都不会被缓存")]),s._v(" "),n("li",[s._v("max：最多可以缓存多少组件实例")])]),s._v(" "),n("p",[n("code",[s._v("include")]),s._v("和"),n("code",[s._v("exlude")]),s._v("属性允许组件有条件地缓存。二者都可以用逗号分隔字符串，正则表达式或一个数组来表示：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('\x3c!-- 逗号分隔字符串 --\x3e\n<keep-alive include="a,b">\n  <component :is="view"></component>\n</keep-alive>\n\n\x3c!-- 正则表达式 (使用 `v-bind`) --\x3e\n<keep-alive :include="/a|b/">\n  <component :is="view"></component>\n</keep-alive>\n\n\x3c!-- 数组 (使用 `v-bind`) --\x3e\n<keep-alive :include="[\'a\', \'b\']">\n  <component :is="view"></component>\n</keep-alive>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h4",{attrs:{id:"_1-2-用法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-用法"}},[s._v("#")]),s._v(" 1.2 用法")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("keep-alive")]),s._v(" 包裹动态组件时，会缓存不活动的组件实例，而不是销毁他们。")]),s._v(" "),n("li",[s._v("当组件在"),n("code",[s._v("kepp-alive")]),s._v("内被切换，它的"),n("code",[s._v("activated")]),s._v("和"),n("code",[s._v("deactivated")]),s._v("两个生命周期钩子函数将会被执行。")])]),s._v(" "),n("h3",{attrs:{id:"二、原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、原理"}},[s._v("#")]),s._v(" 二、原理")]),s._v(" "),n("h4",{attrs:{id:"_2-1-源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-源码"}},[s._v("#")]),s._v(" 2.1 源码")]),s._v(" "),n("p",[n("code",[s._v("<keep-alive>")]),s._v("组件的定义位于源码的"),n("code",[s._v("src/core/components/keep-alive.js")]),s._v("文件中，如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const patternTypes: Array<Function> = [String, RegExp, Array]\n\nexport default {\n  name: 'keep-alive',\n  abstract: true,\n\n  props: {\n    include: patternTypes,\n    exclude: patternTypes,\n    max: [String, Number]\n  },\n\n  created () {\n    this.cache = Object.create(null)\n    this.keys = []\n  },\n\n  destroyed () {\n    for (const key in this.cache) {\n      pruneCacheEntry(this.cache, key, this.keys)\n    }\n  },\n\n  mounted () {\n    this.$watch('include', val => {\n      pruneCache(this, name => matches(val, name))\n    })\n    this.$watch('exclude', val => {\n      pruneCache(this, name => !matches(val, name))\n    })\n  },\n\n  render () {\n    const slot = this.$slots.default\n    const vnode = getFirstComponentChild(slot)\n    const componentOptions  = vnode && vnode.componentOptions\n    if (componentOptions) {\n      // check pattern\n      const name = getComponentName(componentOptions)\n      const { include, exclude } = this\n      if ((include && (!name || !matches(include, name))) || (exclude && name && matches(exclude, name))) {\n        return vnode\n      }\n\n      const { cache, keys } = this\n      const key = vnode.key == null\n        ? componentOptions.Ctor.cid + (componentOptions.tag ? `::${componentOptions.tag}` : '')\n        : vnode.key\n      if (cache[key]) {\n        vnode.componentInstance = cache[key].componentInstance\n        remove(keys, key)\n        keys.push(key)\n      } else {\n        cache[key] = vnode\n        keys.push(key)\n        if (this.max && keys.length > parseInt(this.max)) {\n          pruneCacheEntry(cache, keys[0], keys, this._vnode)\n        }\n      }\n\n      vnode.data.keepAlive = true\n    }\n    return vnode || (slot && slot[0])\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br")])]),n("p",[s._v("组件内没有常规的"),n("code",[s._v("<template></template>")]),s._v("标签，取而代之的"),n("code",[s._v("render")]),s._v("函数，所以它不是一个常规的模板组件，而是一个函数式组件。执行"),n("code",[s._v("<keep-alive>")]),s._v("组件渲染的时候，就会执行这个"),n("code",[s._v("render")]),s._v("函数。")]),s._v(" "),n("h4",{attrs:{id:"_2-2-props"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-props"}},[s._v("#")]),s._v(" 2.2 props")]),s._v(" "),n("p",[s._v("在"),n("code",[s._v("props")]),s._v("选项内接收传进来的三个属性："),n("code",[s._v("include")]),s._v("、"),n("code",[s._v("exclude")]),s._v("和"),n("code",[s._v("max")]),s._v("。如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("props: {\n    include: [String, RegExp, Array],\n    exclude: [String, RegExp, Array],\n    max: [String, Number]\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("code",[s._v("include")]),s._v("表示只有匹配到的组件被缓存，而"),n("code",[s._v("exclude")]),s._v("表示任何匹配")]),s._v(" "),n("h4",{attrs:{id:"_2-3-created"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-created"}},[s._v("#")]),s._v(" 2.3 created")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("created () {\n    this.cache = Object.create(null)\n    this.keys = []\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"_2-4-destroyed"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-destroyed"}},[s._v("#")]),s._v(" 2.4 destroyed")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("destroyed () {\n    for (const key in this.cache) {\n        pruneCacheEntry(this.cache, key, this.keys)\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"_2-5-mounted"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-mounted"}},[s._v("#")]),s._v(" 2.5 mounted")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("this.$watch('include', val => {\n    pruneCache(this, name => matches(val, name))\n})\nthis.$watch('exclude', val => {\n    pruneCache(this, name => !matches(val, name))\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"_2-6-render"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-render"}},[s._v("#")]),s._v(" 2.6 render")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"三、缓存策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、缓存策略"}},[s._v("#")]),s._v(" 三、缓存策略")]),s._v(" "),n("h3",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://juejin.im/post/5e8b3085f265da47c15cb8bb",target:"_blank",rel:"noopener noreferrer"}},[s._v("前端进阶算法 3：从浏览器缓存淘汰策略和 Vue 的 keep-alive 学习 LRU 算法"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5e859fe1e51d4546f27fe2bf",target:"_blank",rel:"noopener noreferrer"}},[s._v("keep-alive 的实现原理及 LRU 缓存策略"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"联系作者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#联系作者"}},[s._v("#")]),s._v(" 联系作者")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("p",[s._v("\n        平凡世界，贵在坚持。\n    ")]),s._v(" "),n("img",{attrs:{src:s.$withBase("/about/contact.png")}})])])}),[],!1,null,null,null);e.default=t.exports}}]);