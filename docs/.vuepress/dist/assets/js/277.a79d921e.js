(window.webpackJsonp=window.webpackJsonp||[]).push([[277],{502:function(a,s,e){"use strict";e.r(s);var n=e(4),t=Object(n.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"webpack-插件及自定义插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webpack-插件及自定义插件","aria-hidden":"true"}},[a._v("#")]),a._v(" webpack 插件及自定义插件")]),a._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[a._v("#")]),a._v(" 前言")]),a._v(" "),e("p",[a._v("本人平时学习及收集内容，欢迎参入一起讨论。")]),a._v(" "),e("h2",{attrs:{id:"内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内容","aria-hidden":"true"}},[a._v("#")]),a._v(" 内容")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E4%B8%80%E3%80%81%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8F%92%E4%BB%B6"}},[a._v("常用的插件")])]),a._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BA%8C%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6"}},[a._v("自定义插件")])])]),a._v(" "),e("h3",{attrs:{id:"一、常用的插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、常用的插件","aria-hidden":"true"}},[a._v("#")]),a._v(" 一、常用的插件")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("CommonsChunkPlugin")]),a._v(" 创建一个公用的 "),e("code",[a._v("chunk")]),a._v("，常用于将第三方 "),e("code",[a._v("lib")]),a._v(" 抽取成公用 js，例如")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("entry:{\n    vendor:['jquery','other-lib'],\n    app:'./entry'\n}\n\nnew CommonsChunkPlugin({\n    name:'vendor',\n    filename:'vendor.js',\n    minChunks:infinity\n})\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("ul",[e("li",[e("code",[a._v("define-plugin")]),a._v("：定义环境变量")]),a._v(" "),e("li",[e("code",[a._v("html-webpack-plugin")]),a._v("：简化 html 文件创建")]),a._v(" "),e("li",[e("code",[a._v("uglifyjs-webpack-plugin")]),a._v("：通过"),e("code",[a._v("UglifyES")]),a._v("压缩"),e("code",[a._v("ES6")]),a._v("代码")]),a._v(" "),e("li",[e("code",[a._v("webpack-parallel-uglify-plugin")]),a._v("：多核压缩，提高压缩速度")]),a._v(" "),e("li",[e("code",[a._v("webpack-bundle-analyzer")]),a._v("：可以视化 webpack 输出文件的体积")]),a._v(" "),e("li",[e("code",[a._v("mini-css-extract-plugin")]),a._v("：CSS 提取到单独的文件中，支持按需加载 -"),e("code",[a._v("HotMouleReplacementPlugin")]),a._v(" 启用 "),e("code",[a._v("module")]),a._v("热替换")])]),a._v(" "),e("h3",{attrs:{id:"二、自定义插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、自定义插件","aria-hidden":"true"}},[a._v("#")]),a._v(" 二、自定义插件")]),a._v(" "),e("ul",[e("li",[a._v("webpack 插件组成")]),a._v(" "),e("li",[a._v("Webpack 插件基本架构")]),a._v(" "),e("li",[a._v("插件触发时机")]),a._v(" "),e("li",[a._v("插件运行机制")]),a._v(" "),e("li",[a._v("写一个自定义插件")])]),a._v(" "),e("h4",{attrs:{id:"_2-1-webpack-插件组成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-webpack-插件组成","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.1 webpack 插件组成")]),a._v(" "),e("p",[a._v("构成如下：")]),a._v(" "),e("ul",[e("li",[a._v("一个具名 JavaScript 函数")]),a._v(" "),e("li",[a._v("在它的原型上定义 apply 方法")]),a._v(" "),e("li",[a._v("指定一个触及到 webpack 本身的事件钩子")]),a._v(" "),e("li",[a._v("操作 Webpack 内部的实例特定数据")]),a._v(" "),e("li",[a._v("在实现功能后调用 Webpack 提供的 callback")])]),a._v(" "),e("h4",{attrs:{id:"_2-2-webpack-插件基本架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-webpack-插件基本架构","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.2 Webpack 插件基本架构")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("class HelloWorldPlugin {\n  apply(compiler) {\n    compiler.hooks.done.tap('Hello World Plugin', (\n      stats /* 在 hook 被触及时，会将 stats 作为参数传入。*/\n    ) => {\n      console.log('Hello World!');\n    });\n  }\n}\nmodule.exports = HelloWorldPlugin;\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br")])]),e("p",[a._v("使用插件")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("// webpack.config.js\nvar HelloWorldPlugin = require('hello-world');\n\nmodule.exports = {\n  // ... 这里是其他配置 ...\n  plugins: [new HelloWorldPlugin({ options: true })]\n};\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("h4",{attrs:{id:"_2-3-插件触发时机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-插件触发时机","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.3 插件触发时机")]),a._v(" "),e("p",[a._v("插件触发时机，其实是选择插件触发的 compiler 钩子。Webpack 提供钩子有很多，这里简单介绍几个（完整具体可参考文档《"),e("a",{attrs:{href:"https://webpack.js.org/api/compiler-hooks/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Compiler Hooks"),e("OutboundLink")],1),a._v("》）：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("entryOption")]),a._v("：在 webpack 选项中的"),e("code",[a._v("entry")]),a._v("配置项处理过之后，执行插件。")]),a._v(" "),e("li",[e("code",[a._v("afterPlugins")]),a._v("：设置完初始插件之后，执行插件。")]),a._v(" "),e("li",[e("code",[a._v("compilation")]),a._v("：编译创建之后，生成文件之前，执行插件。")]),a._v(" "),e("li",[e("code",[a._v("emit")]),a._v("：生成资源到"),e("code",[a._v("output")]),a._v("目录之前")]),a._v(" "),e("li",[e("code",[a._v("done")]),a._v("：编译完成")])]),a._v(" "),e("p",[a._v("在"),e("code",[a._v("compiler.hooks")]),a._v("下指定"),e("strong",[a._v("事件钩子函数")]),a._v("，便会触发钩子时，执行回调函数。Webpack 提供三种触发钩子的方法：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("tap")]),a._v("：以"),e("strong",[a._v("同步方式")]),a._v("触发钩子")]),a._v(" "),e("li",[e("code",[a._v("tapAsync")]),a._v("：以"),e("strong",[a._v("异步方式")]),a._v("触发钩子")]),a._v(" "),e("li",[e("code",[a._v("tapPromise")]),a._v("：以"),e("strong",[a._v("异步方式")]),a._v("触发钩子，返回 Promise")])]),a._v(" "),e("h4",{attrs:{id:"_2-4-插件运行机制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-插件运行机制","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.4 插件运行机制")]),a._v(" "),e("p",[e("img",{attrs:{src:"webpack-plguin.jpeg",alt:"images"}})]),a._v(" "),e("h4",{attrs:{id:"_2-5-写一个自定义插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-写一个自定义插件","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.5 写一个自定义插件")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('创建一个名称为SetScriptTimestampPlugin.js\n\nclass SetScriptTimestampPlugin{\n    apply(compiler){\n        compiler.hooks.compilation.tap(\'SetScriptTimestampPlugin\',\n        (compilation, callback) => {\n            // 插件逻辑 调用compilation提供的plugin方法\n        compilation.plugin(\n          "html-webpack-plugin-before-html-processing",\n          function(htmlPluginData, callback) {\n            // 读取并修改 script 上 src 列表\n            let jsScr = htmlPluginData.assets.js[0];\n            htmlPluginData.assets.js = [];\n            let result = `\n                <script>\n                    let scriptDOM = document.createElement("script");\n                    let jsScr = "./${jsScr}";\n                    scriptDOM.src = jsScr + "?" + new Date().getTime();\n                    document.body.appendChild(scriptDOM)\n                <\/script>\n            `;\n            let resultHTML = htmlPluginData.html.replace(\n              "\x3c!--SetScriptTimestampPlugin inset script--\x3e", result\n            );\n            // 返回修改后的结果\n            htmlPluginData.html = resultHTML;\n          }\n        );\n        })\n    }\n}\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br"),e("span",{staticClass:"line-number"},[a._v("26")]),e("br"),e("span",{staticClass:"line-number"},[a._v("27")]),e("br"),e("span",{staticClass:"line-number"},[a._v("28")]),e("br"),e("span",{staticClass:"line-number"},[a._v("29")]),e("br"),e("span",{staticClass:"line-number"},[a._v("30")]),e("br"),e("span",{staticClass:"line-number"},[a._v("31")]),e("br")])]),e("p",[a._v("使用插件")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('const SetScriptTimestampPlugin = require("./SetScriptTimestampPlugin.js");\nmodule.exports = {\n  plugins: [\n    new SetScriptTimestampPlugin()\n  ]\n}\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("h3",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://mp.weixin.qq.com/s/LTAlkoyS3C2yiLkFriu-Cw",target:"_blank",rel:"noopener noreferrer"}},[a._v("【Webpack】513- Webpack 插件开发如此简单！"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/jerryOnlyZRJ/webpack-loader/blob/master/docs/webpack-plugin.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("编写自定义 webpack plugin"),e("OutboundLink")],1)])]),a._v(" "),e("h2",{attrs:{id:"联系作者"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#联系作者","aria-hidden":"true"}},[a._v("#")]),a._v(" 联系作者")]),a._v(" "),e("div",{attrs:{align:"center"}},[e("p",[a._v("\n        平凡世界，贵在坚持。\n    ")]),a._v(" "),e("img",{attrs:{src:a.$withBase("/about/contact.png")}})])])}),[],!1,null,null,null);s.default=t.exports}}]);