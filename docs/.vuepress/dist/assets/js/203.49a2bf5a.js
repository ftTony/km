(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{425:function(e,s,a){"use strict";a.r(s);var t=a(13),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"vue-源码分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-源码分析"}},[e._v("#")]),e._v(" vue 源码分析")]),e._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),a("p",[e._v("本人平时学习及收集内容，欢迎参入一起讨论。")]),e._v(" "),a("h2",{attrs:{id:"内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内容"}},[e._v("#")]),e._v(" 内容")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%80%E3%80%81%E6%BA%90%E7%A0%81%E7%9B%AE%E5%BD%95%E8%AE%BE%E8%AE%A1"}},[e._v("源码目录设计")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%8C%E3%80%81%E5%8F%98%E5%8C%96%E4%BE%A6%E6%B5%8B%E7%AF%87"}},[e._v("变化侦测篇")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B8%89%E3%80%81%E8%99%9A%E6%8B%9F-dom-%E7%AF%87"}},[e._v("虚拟 DOM 篇")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E5%9B%9B%E3%80%81%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E7%AF%87"}},[e._v("模板编译篇")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%94%E3%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AF%87"}},[e._v("生命周期篇")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E5%85%AD%E3%80%81%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"}},[e._v("实例方法")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B8%83%E3%80%81%E5%85%A8%E5%B1%80-api-%E7%AF%87"}},[e._v("全局 API 篇")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E5%85%AB%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8%E7%AF%87"}},[e._v("过滤器篇")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B9%9D%E3%80%81%E6%8C%87%E4%BB%A4%E7%AF%87"}},[e._v("指令篇")])])]),e._v(" "),a("h3",{attrs:{id:"一、源码目录设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、源码目录设计"}},[e._v("#")]),e._v(" 一、源码目录设计")]),e._v(" "),a("p",[e._v("Vue.js 的源码都在 src 目录下，其目录结构如下。")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("├─dist                   # 项目构建后的文件\n├─scripts                # 与项目构建相关的脚本和配置文件\n├─flow                   # flow的类型声明文件\n├─src                    # 项目源代码\n│    ├─complier          # 与模板编译相关的代码\n│    ├─core              # 通用的、与运行平台无关的运行时代码\n│    │  ├─observe        # 实现变化侦测的代码\n│    │  ├─vdom           # 实现virtual dom的代码\n│    │  ├─instance       # Vue.js实例的构造函数和原型方法\n│    │  ├─global-api     # 全局api的代码\n│    │  └─components     # 内置组件的代码\n│    ├─server            # 与服务端渲染相关的代码\n│    ├─platforms         # 特定运行平台的代码，如weex\n│    ├─sfc               # 单文件组件的解析代码\n│    └─shared            # 项目公用的工具代码\n└─test                   # 项目测试代码\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br")])]),a("ul",[a("li",[e._v("compiler")]),e._v(" "),a("li",[e._v("core")]),e._v(" "),a("li",[e._v("platform")]),e._v(" "),a("li",[e._v("server")]),e._v(" "),a("li",[e._v("sfc")]),e._v(" "),a("li",[e._v("shared")])]),e._v(" "),a("h4",{attrs:{id:"_1-1-compiler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-compiler"}},[e._v("#")]),e._v(" 1.1 compiler")]),e._v(" "),a("p",[a("code",[e._v("compiler")]),e._v("目录包含"),a("code",[e._v("Vue.js")]),e._v("所有编译相关的代码。它包括把模板解析成 ast 语法树、ast 语法树优化，代码生成等功能。")]),e._v(" "),a("p",[e._v("编译的工作可以在构建时做（借助"),a("code",[e._v("webpack")]),e._v("、"),a("code",[e._v("vue-loader")]),e._v("等辅助插件）；也可以在运行时做，使用包含构建功能的"),a("code",[e._v("vue.js")]),e._v("。显然，编译是一项耗性能的工作，所以更推荐前者——离线编译。")]),e._v(" "),a("h4",{attrs:{id:"_1-2-core"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-core"}},[e._v("#")]),e._v(" 1.2 core")]),e._v(" "),a("p",[a("code",[e._v("core")]),e._v("目录包含了"),a("code",[e._v("Vue.js")]),e._v("的核心代码，包括内置组件、全局 API 封装，Vue 实例化、观察者、虚拟 DOM、工具函数等等。")]),e._v(" "),a("p",[e._v("这里的代码可谓是 Vue.js 的灵魂，也是我们之后需要重点分析的地方")]),e._v(" "),a("h4",{attrs:{id:"_1-3-platform"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-platform"}},[e._v("#")]),e._v(" 1.3 platform")]),e._v(" "),a("p",[a("code",[e._v("Vue.js")]),e._v("是一个跨平台的"),a("code",[e._v("MVVM")]),e._v("框架，它可以跑在"),a("code",[e._v("web")]),e._v("上，也可以配合"),a("code",[e._v("weex")]),e._v("跑在"),a("code",[e._v("native")]),e._v("客户端上。"),a("code",[e._v("platform")]),e._v("是 "),a("code",[e._v("Vue.js")]),e._v("的入口，2 个目录代表 2 个主要入口，分别打包成运行在"),a("code",[e._v("web")]),e._v("上和"),a("code",[e._v("weex")]),e._v("上的"),a("code",[e._v("Vue.js")]),e._v("。")]),e._v(" "),a("p",[e._v("我们会重点分析"),a("code",[e._v("web")]),e._v("入口打包后的"),a("code",[e._v("Vue.js")]),e._v("，对于"),a("code",[e._v("weex")]),e._v("入口打包的"),a("code",[e._v("Vue.js")]),e._v("，感兴趣的同学可以自行研究。")]),e._v(" "),a("h4",{attrs:{id:"_1-4-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-server"}},[e._v("#")]),e._v(" 1.4 server")]),e._v(" "),a("p",[a("code",[e._v("Vue.js 2.0")]),e._v("支持了服务端渲染，所有服务端渲染相关的逻辑都在这个目录下。注意：这部分代码是跑在服务端的"),a("code",[e._v("Node.js")]),e._v("，不要和跑在浏览器端的"),a("code",[e._v("Vue.js")]),e._v("混为一谈。")]),e._v(" "),a("p",[e._v("服务端渲染主要的工作是把组件渲染为服务器端的"),a("code",[e._v("HTML")]),e._v('字符串，将它们直接发送到浏览器，最后将静态标记"混合"为客户端上完全交互的应用程序。')]),e._v(" "),a("h4",{attrs:{id:"_1-5-sfc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-sfc"}},[e._v("#")]),e._v(" 1.5 sfc")]),e._v(" "),a("p",[e._v("通常我们开发"),a("code",[e._v("Vue.js")]),e._v("都会借助"),a("code",[e._v("webpack")]),e._v("构建， 然后通过"),a("code",[e._v(".vue")]),e._v("单文件来编写组件。")]),e._v(" "),a("p",[e._v("这个目录下的代码逻辑会把"),a("code",[e._v(".vue")]),e._v("文件内容解析成一个"),a("code",[e._v("JavaScript")]),e._v("的对象。")]),e._v(" "),a("h4",{attrs:{id:"_1-6-shared"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-shared"}},[e._v("#")]),e._v(" 1.6 shared")]),e._v(" "),a("p",[a("code",[e._v("Vue.js")]),e._v("会定义一些工具方法，这里定义的工具方法都是会被浏览器端的"),a("code",[e._v("Vue.js")]),e._v("和服务端的"),a("code",[e._v("Vue.js")]),e._v("所共享的。")]),e._v(" "),a("h3",{attrs:{id:"二、变化侦测篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、变化侦测篇"}},[e._v("#")]),e._v(" 二、变化侦测篇")]),e._v(" "),a("ul",[a("li",[e._v("Object 的变化侦测")]),e._v(" "),a("li",[e._v("Array 的变化侦测")]),e._v(" "),a("li",[e._v("变化侦测的 API 实现")])]),e._v(" "),a("h4",{attrs:{id:"_2-1-object-的变化侦测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-object-的变化侦测"}},[e._v("#")]),e._v(" 2.1 Object 的变化侦测")]),e._v(" "),a("p",[a("strong",[e._v("使用 Object 数据变得“可观测”")])]),e._v(" "),a("p",[e._v("数据的每次读和写能够被我们看的见，即我们能够知道数据什么时候被读取了或数据什么时候被改写了，我们将其称为数据变的“可观测”。")]),e._v(" "),a("p",[a("strong",[e._v("什么是依赖收集")])]),e._v(" "),a("p",[e._v("视图里谁用到了这个数据就更新谁，我们换个优雅说法：我们把“谁用到了这个数据”称为“谁依赖了这个数据”，我们给每个数据都建一个依赖数组，谁依赖了这个数据我们就把谁放入这个依赖数组中，那么当这个数据发生变化的时候，我们就去它对应的依赖数据中，把每个依赖都通知一遍，告诉他们：“你们依赖的数据变啦，你们该更新啦！”。这个过程就是依赖收集。")]),e._v(" "),a("p",[a("strong",[e._v("何时收集依赖？何时通知依赖更新？")])]),e._v(" "),a("p",[e._v("在 getter 中收集依赖，在 setter 中通知依赖更新。")]),e._v(" "),a("p",[a("strong",[e._v("把依赖收集到哪里")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("strong",[e._v("依赖到底是谁")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("code",[e._v("Watcher")]),e._v("类的代码实现逻辑：")]),e._v(" "),a("ol",[a("li",[e._v("当实例化"),a("code",[e._v("Watcher")]),e._v("类时，会先执行其构造函数；")]),e._v(" "),a("li",[e._v("在构造函数中调用了"),a("code",[e._v("this.get()")]),e._v("实例方法；")]),e._v(" "),a("li",[e._v("在"),a("code",[e._v("get()")]),e._v("方法中")]),e._v(" "),a("li",[e._v("而当数据变化时，会触发数据的"),a("code",[e._v("setter")]),e._v("，在"),a("code",[e._v("setter")]),e._v("中调用了"),a("code",[e._v("dep.notify()")])])]),e._v(" "),a("h4",{attrs:{id:"_2-2-array-的变化侦测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-array-的变化侦测"}},[e._v("#")]),e._v(" 2.2 Array 的变化侦测")]),e._v(" "),a("p",[e._v("上一节文章中我们介绍了"),a("code",[e._v("Object")]),e._v("数据的变化侦测方式，本节我们来看一下对"),a("code",[e._v("Array")]),e._v("型数据的变化"),a("code",[e._v("Vue")]),e._v("是如何进行侦测的。")]),e._v(" "),a("h4",{attrs:{id:"_2-3-变化侦测的-api-实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-变化侦测的-api-实现"}},[e._v("#")]),e._v(" 2.3 变化侦测的 API 实现")]),e._v(" "),a("h3",{attrs:{id:"三、虚拟-dom-篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、虚拟-dom-篇"}},[e._v("#")]),e._v(" 三、虚拟 DOM 篇")]),e._v(" "),a("ul",[a("li",[e._v("Vue 中的虚拟 DOM")]),e._v(" "),a("li",[e._v("Vue 中的 DOM-Diff")]),e._v(" "),a("li",[e._v("更新子节点")]),e._v(" "),a("li",[e._v("优化更新子节点")])]),e._v(" "),a("h4",{attrs:{id:"_3-1-vue-中的虚拟-dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-vue-中的虚拟-dom"}},[e._v("#")]),e._v(" 3.1 Vue 中的虚拟 DOM")]),e._v(" "),a("p",[e._v("参考"),a("a",{attrs:{href:"https://km.xiaowuzi.info/js/vue-dom.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vue 虚拟 DOM"),a("OutboundLink")],1)]),e._v(" "),a("h4",{attrs:{id:"_3-2-vue-中的-dom-diff"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-vue-中的-dom-diff"}},[e._v("#")]),e._v(" 3.2 Vue 中的 DOM-Diff")]),e._v(" "),a("p",[e._v("参考"),a("a",{attrs:{href:"https://km.xiaowuzi.info/js/vue-diff.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("diff 算法"),a("OutboundLink")],1)]),e._v(" "),a("h4",{attrs:{id:"_3-3-更新子节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-更新子节点"}},[e._v("#")]),e._v(" 3.3 更新子节点")]),e._v(" "),a("h4",{attrs:{id:"_3-4-优化更新子节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-优化更新子节点"}},[e._v("#")]),e._v(" 3.4 优化更新子节点")]),e._v(" "),a("h3",{attrs:{id:"四、模板编译篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、模板编译篇"}},[e._v("#")]),e._v(" 四、模板编译篇")]),e._v(" "),a("ul",[a("li",[e._v("整体运行流程")]),e._v(" "),a("li",[e._v("HTML 解析器")]),e._v(" "),a("li",[e._v("文本解析器")]),e._v(" "),a("li",[e._v("优化阶段")]),e._v(" "),a("li",[e._v("代码生成阶段")])]),e._v(" "),a("p",[e._v("我们知道，在日常开发中，我们把写在"),a("code",[e._v("<template></template>")]),e._v("标签中的类似于原生"),a("code",[e._v("HTML")]),e._v("的内容称之为模板。这时你可能会问了，为什么说是“类似于原生"),a("code",[e._v("HTML")]),e._v("的内容”而不是“就是"),a("code",[e._v("HTML")]),e._v("的内容”？因为我们在开发中，在"),a("code",[e._v("<template></template>")]),e._v("标签中除了写一些原生"),a("code",[e._v("HTML")]),e._v("的标签，我们还会写一些亦是插值，如或者写一些"),a("code",[e._v("Vue")]),e._v("指令，如"),a("code",[e._v("v-on")]),e._v("、"),a("code",[e._v("v-if")]),e._v("等。而这些东西都是在原生"),a("code",[e._v("HTML")]),e._v("语法中不存在的，不被接受的。但事实上我们确实这么写了，也被正确识别了，页面也正常显示了，这又是为什么呢？")]),e._v(" "),a("p",[e._v("这就归功于"),a("code",[e._v("Vue")]),e._v("的模板编译了，"),a("code",[e._v("Vue")]),e._v("会把用户在"),a("code",[e._v("<template></template>")]),e._v("标签中写的类似于原生"),a("code",[e._v("HTML")]),e._v("的内容进行编译，把原生"),a("code",[e._v("HTML")]),e._v("的内容找出来，再把非原生"),a("code",[e._v("HTML")]),e._v("找出来，经过一系列的逻辑处理生成渲染函数，也就是"),a("code",[e._v("render")]),e._v("函数，而"),a("code",[e._v("redner")]),e._v("函数会将模板内容生成对应的"),a("code",[e._v("VNode")]),e._v("，而"),a("code",[e._v("VNode")]),e._v("再经过"),a("code",[e._v("patch")]),e._v("过程从而得到将要渲染的视图中的"),a("code",[e._v("VNode")]),e._v("，最后根据"),a("code",[e._v("VNode")]),e._v("创建真实的"),a("code",[e._v("DOM")]),e._v("节点并插入到视图中，最终完成视图的渲染更新。")]),e._v(" "),a("p",[e._v("而把用户在"),a("code",[e._v("<template></template>")]),e._v("标签中写的类似于原生"),a("code",[e._v("HTML")]),e._v("的内容进行编译，把原生"),a("code",[e._v("HTML")]),e._v("的内容找出来，再把非原生"),a("code",[e._v("HTML")]),e._v("找出来，经过一系列的逻辑处理成渲染函数，也就是"),a("code",[e._v("render")]),e._v("函数的这一段过程称之为模板编译过程。")]),e._v(" "),a("h4",{attrs:{id:"_4-1-整体渲染流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-整体渲染流程"}},[e._v("#")]),e._v(" 4.1 整体渲染流程")]),e._v(" "),a("p",[e._v("所谓渲染流程，就是把用户写的类似原生"),a("code",[e._v("HTML")]),e._v("的模板经过一系列处理最终反应到视图中称之为整个渲染流程。这个流程在上文中其实已经说到了，下面我们以流程图的形式宏观的了解一下，流程图如下：")]),e._v(" "),a("p",[a("img",{attrs:{src:"vue-code01.png",alt:"images"}})]),e._v(" "),a("p",[e._v("从图中我们也可以看到，模板编译过程就是把用户写的模板经过一系列处理最终生成"),a("code",[e._v("render")]),e._v("函数的过程。")]),e._v(" "),a("p",[e._v("将一堆字符串模板解析成抽象语法树"),a("code",[e._v("AST")]),e._v("后，我们就可以对其进行各种操作处理了，处理完后用处理后的"),a("code",[e._v("AST")]),e._v("来生成"),a("code",[e._v("render")]),e._v("函数。其具体流程可大致分为三个阶段：")]),e._v(" "),a("ol",[a("li",[e._v("模板解析阶段：将一堆模板字符串用正则等方式解析成抽象语法树"),a("code",[e._v("AST")]),e._v("；")]),e._v(" "),a("li",[e._v("优化阶段：遍历"),a("code",[e._v("AST")]),e._v("，找出其中的静态节点，并打上标记；")]),e._v(" "),a("li",[e._v("代码生成阶段：将"),a("code",[e._v("AST")]),e._v("转换成渲染函数；")])]),e._v(" "),a("p",[e._v("这三个阶段在源码中分别对应三个模块，下面给出三个模块的源代码在源码中的路径：")]),e._v(" "),a("ol",[a("li",[e._v("模板解析段——解析器——源码路径："),a("code",[e._v("src/compiler/parser/index.js")])]),e._v(" "),a("li",[e._v("优化阶段——优化器——源码路径："),a("code",[e._v("src/compiler/optimizer.js")])]),e._v(" "),a("li",[e._v("代码生成阶段——代码生成器——源码路径："),a("code",[e._v("src/compiler/codegen/index.js")])])]),e._v(" "),a("h4",{attrs:{id:"_4-1-整体运行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-整体运行流程"}},[e._v("#")]),e._v(" 4.1 整体运行流程")]),e._v(" "),a("p",[e._v("在模板解析阶段主要做的工作是把用户在"),a("code",[e._v("<template></template>")]),e._v("标签内写的模板使用正则等方式解析成抽象语法树（"),a("code",[e._v("AST")]),e._v("）。而这一阶段在源码中对应解析器（"),a("code",[e._v("parser")]),e._v("）模块。")]),e._v(" "),a("p",[e._v("解析器，顾名思义，就是把用户所写的模板根据一定的解析规则解析出有效的信息，最后用这些信息形成"),a("code",[e._v("AST")]),e._v("。我们知道在"),a("code",[e._v("<template></template>")]),e._v("模板内，除了有常规的"),a("code",[e._v("HTML")]),e._v("标签外，")]),e._v(" "),a("h4",{attrs:{id:"_4-2-html-解析器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-html-解析器"}},[e._v("#")]),e._v(" 4.2 HTML 解析器")]),e._v(" "),a("p",[a("strong",[e._v("HTML 解析器内部运行流程")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("//  代码位置：/src/complier/parser/index.js\n\n/**\n *  Convert HTML string to AST.\n *  将HTML模板字符串转化为AST\n */\nexport function parse(template,options){\n    // ...\n    parseHTML(template,{\n        warn,\n        expectHTML: options.expectHTML,\n        isUnaryTag: options.isUnaryTag,\n        canBeLeftOpenTag: options.canBeLeftOpenTag,\n        shouldDecodeNewlines: options.shouldDecodeNewlines,\n        shouldDecodeNewlinesForHref: options.shouldDecodeNewlinesForHref,\n        shouldKeepComment: options.comments,\n        // 当解析到开始标签时，调用该函数\n        start(tag,attrs,unary){\n\n        },\n        // 当解析到结束标签时，调用该函数\n        end(){\n\n        },\n        // 当解析到文本时，调用该函数\n        chars(text){\n\n        },\n        // 当解析到注释时，调用该函数\n        comment(text){\n\n        }\n    })\n    return root\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br")])]),a("p",[e._v("从代码中我们可以看到，调用"),a("code",[e._v("parseHTML")]),e._v("函数时为其传入的两个参数分别是：")]),e._v(" "),a("ul",[a("li",[e._v("template 待转换的模板字符串；")]),e._v(" "),a("li",[e._v("options 转换时所需的选项；")])]),e._v(" "),a("p",[a("strong",[e._v("如何解析不同的内容")])]),e._v(" "),a("p",[e._v("要从模板字符串中解析出不同的内容，那")]),e._v(" "),a("h4",{attrs:{id:"_4-3-文本解析器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-文本解析器"}},[e._v("#")]),e._v(" 4.3 文本解析器")]),e._v(" "),a("h4",{attrs:{id:"_4-5-优化阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-优化阶段"}},[e._v("#")]),e._v(" 4.5 优化阶段")]),e._v(" "),a("h4",{attrs:{id:"_4-5-代码生成阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-代码生成阶段"}},[e._v("#")]),e._v(" 4.5 代码生成阶段")]),e._v(" "),a("h3",{attrs:{id:"五、生命周期篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、生命周期篇"}},[e._v("#")]),e._v(" 五、生命周期篇")]),e._v(" "),a("ul",[a("li",[e._v("初始化阶段")]),e._v(" "),a("li",[e._v("模板编译阶段")]),e._v(" "),a("li",[e._v("挂载阶段")]),e._v(" "),a("li",[e._v("销毁阶段")])]),e._v(" "),a("h4",{attrs:{id:"_5-1-初始化阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-初始化阶段"}},[e._v("#")]),e._v(" 5.1 初始化阶段")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("new Vue")])]),e._v(" "),a("li",[a("code",[e._v("initLifecycle")])]),e._v(" "),a("li",[a("code",[e._v("initEvents")])]),e._v(" "),a("li",[a("code",[e._v("initInjections")])]),e._v(" "),a("li",[a("code",[e._v("initState")])])]),e._v(" "),a("p",[a("strong",[e._v("new Vue 都干了什么")])]),e._v(" "),a("p",[e._v("初始化阶段所做的第一件事就是"),a("code",[e._v("new Vue()")]),e._v("创建一个"),a("code",[e._v("Vue")]),e._v("实例，那么"),a("code",[e._v("new Vue()")]),e._v("的内部都干了什么呢？我们知道，"),a("code",[e._v("new")]),e._v("关键字在"),a("code",[e._v("JS")]),e._v("中表示从一个类中实例化出一个对象来，由此可见，"),a("code",[e._v("Vue")]),e._v("实际上是一个类。所以"),a("code",[e._v("new Vue()")]),e._v("实际上是执行了"),a("code",[e._v("Vue")]),e._v("类的构造函数")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("function Vue (options) {\n  if (process.env.NODE_ENV !== 'production' &&\n    !(this instanceof Vue)\n  ) {\n    warn('Vue is a constructor and should be called with the `new` keyword')\n  }\n  this._init(options)\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[a("strong",[e._v("合并属性")])]),e._v(" "),a("p",[e._v("在上文中，"),a("code",[e._v("_init")]),e._v("方法里首先会调用"),a("code",[e._v("mergeOptions")]),e._v("函数来进行属性合并，如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vm.$options = mergeOptions(\n    resolveConstructorOptions(vm.constructor),\n    options || {},\n    vm\n)\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("它实际上就是把 "),a("code",[e._v("resolveConstructorOptions(vm.constructor)")]),e._v(" 的返回值和 "),a("code",[e._v("options")]),e._v(" 做合并，返回"),a("code",[e._v("vm.constructor.options")]),e._v("，相当于"),a("code",[e._v("Vue.options")]),e._v("，那么这个"),a("code",[e._v("Vue.options")]),e._v("又是什么呢，其实在"),a("code",[e._v("initGlobalAPI(Vue)")]),e._v("的时候定义了这个值，代码在"),a("code",[e._v("src/core/global-api/index.js")]),e._v("中：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("export function initGlobalAPI (Vue: GlobalAPI) {\n  // ...\n  Vue.options = Object.create(null)\n  ASSET_TYPES.forEach(type => {\n    Vue.options[type + 's'] = Object.create(null)\n  })\n\n  extend(Vue.options.components, builtInComponents)\n  // ...\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("p",[e._v("首先通过"),a("code",[e._v("Vue.options = Object.create(null)")]),e._v("创建一个空对象，然后遍历"),a("code",[e._v("ASSET_TYPES")]),e._v("，"),a("code",[e._v("ASSET_TYPES")]),e._v("的定义在"),a("code",[e._v("src/shared/contstants.js")]),e._v("中：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("export const ASSET_TYPES = [\n  'component',\n  'directive',\n  'filter'\n]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("上面遍历"),a("code",[e._v("ASSET_TYPES")]),e._v("后代码相当于：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Vue.options.components = {}\nVue.options.directives = {}\nVue.options.filters = {}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("最后通过"),a("code",[e._v("extend(Vue.options.components,builtInCompontents)")]),e._v("把一些内置组件扩展到"),a("code",[e._v("Vue.options.components")]),e._v("上，"),a("code",[e._v("Vue")]),e._v("的内置组件目前有"),a("code",[e._v("<keep-alive>")]),e._v("、"),a("code",[e._v("<transition>")]),e._v("和"),a("code",[e._v("<transition-group>")]),e._v("组件，这也就是为什么我们在其它组件中使用这些组件不需要注册的原因。")]),e._v(" "),a("p",[a("code",[e._v("mergeOptions")]),e._v("这个函数，它的定义在"),a("code",[e._v("src/core/util/options.js")]),e._v("中：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("/**\n * Merge two option objects into a new one.\n * Core utility used in both instantiation and inheritance.\n */\nexport function mergeOptions (\n  parent: Object,\n  child: Object,\n  vm?: Component\n): Object {\n  if (process.env.NODE_ENV !== 'production') {\n    checkComponents(child)\n  }\n\n  if (typeof child === 'function') {\n    child = child.options\n  }\n\n  normalizeProps(child, vm)\n  normalizeInject(child, vm)\n  normalizeDirectives(child)\n\n  // Apply extends and mixins on the child options,\n  // but only if it is a raw options object that isn't\n  // the result of another mergeOptions call.\n  // Only merged options has the _base property.\n  if (!child._base) {\n    if (child.extends) {\n      parent = mergeOptions(parent, child.extends, vm)\n    }\n    if (child.mixins) {\n      for (let i = 0, l = child.mixins.length; i < l; i++) {\n        parent = mergeOptions(parent, child.mixins[i], vm)\n      }\n    }\n  }\n\n  const options = {}\n  let key\n  for (key in parent) {\n    mergeField(key)\n  }\n  for (key in child) {\n    if (!hasOwn(parent, key)) {\n      mergeField(key)\n    }\n  }\n  function mergeField (key) {\n    const strat = strats[key] || defaultStrat\n    options[key] = strat(parent[key], child[key], vm, key)\n  }\n  return options\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br"),a("span",{staticClass:"line-number"},[e._v("41")]),a("br"),a("span",{staticClass:"line-number"},[e._v("42")]),a("br"),a("span",{staticClass:"line-number"},[e._v("43")]),a("br"),a("span",{staticClass:"line-number"},[e._v("44")]),a("br"),a("span",{staticClass:"line-number"},[e._v("45")]),a("br"),a("span",{staticClass:"line-number"},[e._v("46")]),a("br"),a("span",{staticClass:"line-number"},[e._v("47")]),a("br"),a("span",{staticClass:"line-number"},[e._v("48")]),a("br"),a("span",{staticClass:"line-number"},[e._v("49")]),a("br"),a("span",{staticClass:"line-number"},[e._v("50")]),a("br"),a("span",{staticClass:"line-number"},[e._v("51")]),a("br"),a("span",{staticClass:"line-number"},[e._v("52")]),a("br")])]),a("p",[e._v("可以看出，"),a("code",[e._v("mergeOptions")]),e._v("函数的主要功能是把"),a("code",[e._v("parent")]),e._v("和"),a("code",[e._v("child")]),e._v("这两个对象根据一些合并策略，合并成一个新对象并返回。首先递归把"),a("code",[e._v("extends")]),e._v("和"),a("code",[e._v("mixins")]),e._v("合并到"),a("code",[e._v("parent")]),e._v("上")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("生命周期钩子函数的合并策略如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("function mergeHook(parentVal,childVal){\n    return childVal? parentVal ? parentVal.concat(childVal) : Array.isArray(childVal) ? childVal : [childVal] : parentVal\n}\n\nLIFECYCLE_HOOKS.forEach(hook => {\n  strats[hook] = mergeHook\n})\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[e._v("这其中的"),a("code",[e._v("LIFECYCLE_HOOKS")]),e._v("的定义在"),a("code",[e._v("src/shared/constants.js")]),e._v("中：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("export const LIFECYCLE_HOOKS = [\n  'beforeCreate',\n  'created',\n  'beforeMount',\n  'mounted',\n  'beforeUpdate',\n  'updated',\n  'beforeDestroy',\n  'destroyed',\n  'activated',\n  'deactivated',\n  'errorCaptured'\n]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])]),a("p",[a("strong",[e._v("callHook 函数如何触发钩子函数")])]),e._v(" "),a("p",[e._v("关于"),a("code",[e._v("callHook")]),e._v("函数如何触发钩子函数的问题，我们只需看一下该函数的实现源码即可，该函数的源码位于"),a("code",[e._v("src/core/instance/lifecycle.js")]),e._v("中，如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("export function callHook(vm,hook){\n    const handlers = vm.$options[hook]\n    if(handlers){\n        for(let i = 0,j = handlers.length;i<j;i++){\n            try{\n                hanlders[i].call(vm)\n            }catch(e){\n                handleError(e,vm,`${hook} hook`)\n            }\n        }\n    }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("p",[e._v("可以看到，"),a("code",[e._v("callHook")]),e._v("函数逻辑非常简单。首先从实例的"),a("code",[e._v("$options")]),e._v("中获取到需要触发的钩子名称所对应的钩子函数数组"),a("code",[e._v("handlers")]),e._v("，我们说过，每个生命周期钩子名称都对应一个钩子函数数组。然后遍历该数组，将数组中的每个钩子函数都执行一遍。")]),e._v(" "),a("p",[a("strong",[e._v("initLifecycle 函数分析")])]),e._v(" "),a("p",[a("code",[e._v("initLifecycle")]),e._v("函数的定义的位于源码的"),a("code",[e._v("src/core/instance/lifecycle.js")]),e._v("中，其代码如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("strong",[e._v("解析事件")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("strong",[e._v("initInjections 函数分析")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("strong",[e._v("initState 函数分析")])]),e._v(" "),a("p",[e._v("这个函数是用来初始化实例状态的，主要包括"),a("code",[e._v("props")]),e._v("、"),a("code",[e._v("data")]),e._v("、"),a("code",[e._v("methods")]),e._v("、"),a("code",[e._v("computed")]),e._v("、"),a("code",[e._v("watch")]),e._v("，我们把这些选项称为实例的状态选项。也就是说，"),a("code",[e._v("initState")]),e._v("函数就是用来初始化这些状态的。")]),e._v(" "),a("p",[e._v("首先我们先来分析"),a("code",[e._v("initState")]),e._v("函数，该函数的定义位于源码的"),a("code",[e._v("src/core/instance/state.js")]),e._v("中，如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("export function initState (vm: Component) {\n  vm._watchers = []\n  const opts = vm.$options\n  if (opts.props) initProps(vm, opts.props)\n  if (opts.methods) initMethods(vm, opts.methods)\n  if (opts.data) {\n    initData(vm)\n  } else {\n    observe(vm._data = {}, true /* asRootData */)\n  }\n  if (opts.computed) initComputed(vm, opts.computed)\n  if (opts.watch && opts.watch !== nativeWatch) {\n    initWatch(vm, opts.watch)\n  }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br")])]),a("h4",{attrs:{id:"_5-2-模板编译阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-模板编译阶段"}},[e._v("#")]),e._v(" 5.2 模板编译阶段")]),e._v(" "),a("h4",{attrs:{id:"_5-3-挂载阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-挂载阶段"}},[e._v("#")]),e._v(" 5.3 挂载阶段")]),e._v(" "),a("h4",{attrs:{id:"_5-4-销毁阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-销毁阶段"}},[e._v("#")]),e._v(" 5.4 销毁阶段")]),e._v(" "),a("h3",{attrs:{id:"六、实例方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、实例方法"}},[e._v("#")]),e._v(" 六、实例方法")]),e._v(" "),a("ul",[a("li",[e._v("数据相关的方法")]),e._v(" "),a("li",[e._v("事件相关的方法")]),e._v(" "),a("li",[e._v("生命周期相关的方法")])]),e._v(" "),a("h4",{attrs:{id:"_6-1-数据相关的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-数据相关的方法"}},[e._v("#")]),e._v(" 6.1 数据相关的方法")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("vm.$watch")])]),e._v(" "),a("li",[a("code",[e._v("vm.$set")])]),e._v(" "),a("li",[a("code",[e._v("vm.$delete")])])]),e._v(" "),a("h4",{attrs:{id:"_6-2-事件相关的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-事件相关的方法"}},[e._v("#")]),e._v(" 6.2 事件相关的方法")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("vm.$on")])]),e._v(" "),a("li",[a("code",[e._v("vm.$emit")])]),e._v(" "),a("li",[a("code",[e._v("vm.$off")])]),e._v(" "),a("li",[a("code",[e._v("vm.$once")])])]),e._v(" "),a("h4",{attrs:{id:"_6-3-生命周期相关的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-生命周期相关的方法"}},[e._v("#")]),e._v(" 6.3 生命周期相关的方法")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("vm.$mount")])]),e._v(" "),a("li",[a("code",[e._v("vm.$forceUpdate")])]),e._v(" "),a("li",[a("code",[e._v("vm.$nextTick")])]),e._v(" "),a("li",[a("code",[e._v("vm.$destory")])])]),e._v(" "),a("h3",{attrs:{id:"七、全局-api-篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、全局-api-篇"}},[e._v("#")]),e._v(" 七、全局 API 篇")]),e._v(" "),a("h3",{attrs:{id:"八、过滤器篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、过滤器篇"}},[e._v("#")]),e._v(" 八、过滤器篇")]),e._v(" "),a("h3",{attrs:{id:"九、指令篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、指令篇"}},[e._v("#")]),e._v(" 九、指令篇")]),e._v(" "),a("h3",{attrs:{id:"十、总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十、总结"}},[e._v("#")]),e._v(" 十、总结")]),e._v(" "),a("p",[a("img",{attrs:{src:"vue-code.png",alt:"images"}})]),e._v(" "),a("h3",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[e._v("#")]),e._v(" 参考资料")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/muwoo/blogs",target:"_blank",rel:"noopener noreferrer"}},[e._v("vue 源码分析"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"http://hcysun.me/vue-design/art/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vue 技术内幕"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://ustbhuangyi.github.io/vue-analysis/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vue.js 技术揭秘"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/answershuto/learnVue",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vue.js 源码解析"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/dirkhe1051931999/hjBlog/tree/master/blog-vue-sourcecode-study",target:"_blank",rel:"noopener noreferrer"}},[e._v("你想要的 vue 源码分析"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.im/post/5ce5565d6fb9a07ed2244513",target:"_blank",rel:"noopener noreferrer"}},[e._v("学习 Vue 源码的必要知识储备"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://nlrx-wjc.github.io/Learn-Vue-Source-Code/start/",target:"_blank",rel:"noopener noreferrer"}},[e._v("逐行剖析 Vue.js 源码"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"http://hcysun.me/vue-design/zh/",target:"_blank",rel:"noopener noreferrer"}},[e._v("渲染器"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/tugenhua0707/category/1577630.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("深入 Vue 技术栈及源码系列"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"http://www.zhufengpeixun.cn/train/vue-info/source.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vue 原理剖析"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/lihongxun945/myblog/issues/22",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vue2.x 源码解析系列一：我的源码阅读心得"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("《深入清出 Vue.js》")])]),e._v(" "),a("h2",{attrs:{id:"联系作者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联系作者"}},[e._v("#")]),e._v(" 联系作者")]),e._v(" "),a("div",{attrs:{align:"center"}},[a("p",[e._v("\n        平凡世界，贵在坚持。\n    ")]),e._v(" "),a("img",{attrs:{src:e.$withBase("/about/contact.png")}})])])}),[],!1,null,null,null);s.default=n.exports}}]);