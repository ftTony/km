(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{428:function(s,n,e){"use strict";e.r(n);var a=e(13),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"vue-源码分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue-源码分析"}},[s._v("#")]),s._v(" vue 源码分析")]),s._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("本人平时学习及收集内容，欢迎参入一起讨论。")]),s._v(" "),e("h2",{attrs:{id:"内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内容"}},[s._v("#")]),s._v(" 内容")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E4%B8%80%E3%80%81%E6%BA%90%E7%A0%81%E7%9B%AE%E5%BD%95%E8%AE%BE%E8%AE%A1"}},[s._v("源码目录设计")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BA%8C%E3%80%81%E5%8F%98%E5%8C%96%E4%BE%A6%E6%B5%8B%E7%AF%87"}},[s._v("变化侦测篇")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%B8%89%E3%80%81%E8%99%9A%E6%8B%9F-dom-%E7%AF%87"}},[s._v("虚拟 DOM 篇")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%9B%9B%E3%80%81%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E7%AF%87"}},[s._v("模板编译篇")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BA%94%E3%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AF%87"}},[s._v("生命周期篇")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%85%AD%E3%80%81%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"}},[s._v("实例方法")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%B8%83%E3%80%81%E5%85%A8%E5%B1%80-api-%E7%AF%87"}},[s._v("全局 API 篇")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%85%AB%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8%E7%AF%87"}},[s._v("过滤器篇")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%B9%9D%E3%80%81%E6%8C%87%E4%BB%A4%E7%AF%87"}},[s._v("指令篇")])])]),s._v(" "),e("h3",{attrs:{id:"一、源码目录设计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、源码目录设计"}},[s._v("#")]),s._v(" 一、源码目录设计")]),s._v(" "),e("p",[s._v("Vue.js 的源码都在 src 目录下，其目录结构如下。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("├─dist                   # 项目构建后的文件\n├─scripts                # 与项目构建相关的脚本和配置文件\n├─flow                   # flow的类型声明文件\n├─src                    # 项目源代码\n│    ├─complier          # 与模板编译相关的代码\n│    ├─core              # 通用的、与运行平台无关的运行时代码\n│    │  ├─observe        # 实现变化侦测的代码\n│    │  ├─vdom           # 实现virtual dom的代码\n│    │  ├─instance       # Vue.js实例的构造函数和原型方法\n│    │  ├─global-api     # 全局api的代码\n│    │  └─components     # 内置组件的代码\n│    ├─server            # 与服务端渲染相关的代码\n│    ├─platforms         # 特定运行平台的代码，如weex\n│    ├─sfc               # 单文件组件的解析代码\n│    └─shared            # 项目公用的工具代码\n└─test                   # 项目测试代码\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("ul",[e("li",[s._v("compiler")]),s._v(" "),e("li",[s._v("core")]),s._v(" "),e("li",[s._v("platform")]),s._v(" "),e("li",[s._v("server")]),s._v(" "),e("li",[s._v("sfc")]),s._v(" "),e("li",[s._v("shared")])]),s._v(" "),e("h4",{attrs:{id:"_1-1-compiler"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-compiler"}},[s._v("#")]),s._v(" 1.1 compiler")]),s._v(" "),e("p",[e("code",[s._v("compiler")]),s._v("目录包含"),e("code",[s._v("Vue.js")]),s._v("所有编译相关的代码。它包括把模板解析成 ast 语法树、ast 语法树优化，代码生成等功能。")]),s._v(" "),e("p",[s._v("编译的工作可以在构建时做（借助"),e("code",[s._v("webpack")]),s._v("、"),e("code",[s._v("vue-loader")]),s._v("等辅助插件）；也可以在运行时做，使用包含构建功能的"),e("code",[s._v("vue.js")]),s._v("。显然，编译是一项耗性能的工作，所以更推荐前者——离线编译。")]),s._v(" "),e("h4",{attrs:{id:"_1-2-core"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-core"}},[s._v("#")]),s._v(" 1.2 core")]),s._v(" "),e("p",[e("code",[s._v("core")]),s._v("目录包含了"),e("code",[s._v("Vue.js")]),s._v("的核心代码，包括内置组件、全局 API 封装，Vue 实例化、观察者、虚拟 DOM、工具函数等等。")]),s._v(" "),e("p",[s._v("这里的代码可谓是 Vue.js 的灵魂，也是我们之后需要重点分析的地方")]),s._v(" "),e("h4",{attrs:{id:"_1-3-platform"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-platform"}},[s._v("#")]),s._v(" 1.3 platform")]),s._v(" "),e("p",[e("code",[s._v("Vue.js")]),s._v("是一个跨平台的"),e("code",[s._v("MVVM")]),s._v("框架，它可以跑在"),e("code",[s._v("web")]),s._v("上，也可以配合"),e("code",[s._v("weex")]),s._v("跑在"),e("code",[s._v("native")]),s._v("客户端上。"),e("code",[s._v("platform")]),s._v("是 "),e("code",[s._v("Vue.js")]),s._v("的入口，2 个目录代表 2 个主要入口，分别打包成运行在"),e("code",[s._v("web")]),s._v("上和"),e("code",[s._v("weex")]),s._v("上的"),e("code",[s._v("Vue.js")]),s._v("。")]),s._v(" "),e("p",[s._v("我们会重点分析"),e("code",[s._v("web")]),s._v("入口打包后的"),e("code",[s._v("Vue.js")]),s._v("，对于"),e("code",[s._v("weex")]),s._v("入口打包的"),e("code",[s._v("Vue.js")]),s._v("，感兴趣的同学可以自行研究。")]),s._v(" "),e("h4",{attrs:{id:"_1-4-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-server"}},[s._v("#")]),s._v(" 1.4 server")]),s._v(" "),e("p",[e("code",[s._v("Vue.js 2.0")]),s._v("支持了服务端渲染，所有服务端渲染相关的逻辑都在这个目录下。注意：这部分代码是跑在服务端的"),e("code",[s._v("Node.js")]),s._v("，不要和跑在浏览器端的"),e("code",[s._v("Vue.js")]),s._v("混为一谈。")]),s._v(" "),e("p",[s._v("服务端渲染主要的工作是把组件渲染为服务器端的"),e("code",[s._v("HTML")]),s._v('字符串，将它们直接发送到浏览器，最后将静态标记"混合"为客户端上完全交互的应用程序。')]),s._v(" "),e("h4",{attrs:{id:"_1-5-sfc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-sfc"}},[s._v("#")]),s._v(" 1.5 sfc")]),s._v(" "),e("p",[s._v("通常我们开发"),e("code",[s._v("Vue.js")]),s._v("都会借助"),e("code",[s._v("webpack")]),s._v("构建， 然后通过"),e("code",[s._v(".vue")]),s._v("单文件来编写组件。")]),s._v(" "),e("p",[s._v("这个目录下的代码逻辑会把"),e("code",[s._v(".vue")]),s._v("文件内容解析成一个"),e("code",[s._v("JavaScript")]),s._v("的对象。")]),s._v(" "),e("h4",{attrs:{id:"_1-6-shared"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-shared"}},[s._v("#")]),s._v(" 1.6 shared")]),s._v(" "),e("p",[e("code",[s._v("Vue.js")]),s._v("会定义一些工具方法，这里定义的工具方法都是会被浏览器端的"),e("code",[s._v("Vue.js")]),s._v("和服务端的"),e("code",[s._v("Vue.js")]),s._v("所共享的。")]),s._v(" "),e("h3",{attrs:{id:"二、变化侦测篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、变化侦测篇"}},[s._v("#")]),s._v(" 二、变化侦测篇")]),s._v(" "),e("ul",[e("li",[s._v("Object 的变化侦测")]),s._v(" "),e("li",[s._v("Array 的变化侦测")]),s._v(" "),e("li",[s._v("变化侦测的 API 实现")])]),s._v(" "),e("h4",{attrs:{id:"_2-1-object-的变化侦测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-object-的变化侦测"}},[s._v("#")]),s._v(" 2.1 Object 的变化侦测")]),s._v(" "),e("p",[e("strong",[s._v("使用 Object 数据变得“可观测”")])]),s._v(" "),e("p",[s._v("数据的每次读和写能够被我们看的见，即我们能够知道数据什么时候被读取了或数据什么时候被改写了，我们将其称为数据变的“可观测”。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 源码位置：src/core/observer/index.js\n\n/**\n *  Observer类会通过递归的方式把一个对象的所有属性都转化成可观测对象\n */\nexport class Observer {\n  constructor (value: any) {\n    this.value = value\n    this.dep = new Dep()\n    this.vmCount = 0\n    // 给value新增一个__ob__属性，值为该value的Observer实例\n    //\n    def(value, '__ob__', this)\n    if (Array.isArray(value)) {\n      if (hasProto) {\n        protoAugment(value, arrayMethods)\n      } else {\n        copyAugment(value, arrayMethods, arrayKeys)\n      }\n      this.observeArray(value)\n    } else {\n      this.walk(value)\n    }\n  }\n\n  /**\n   * Walk through all properties and convert them into\n   * getter/setters. This method should only be called when\n   * value type is Object.\n   */\n  walk (obj: Object) {\n    const keys = Object.keys(obj)\n    for (let i = 0; i < keys.length; i++) {\n      defineReactive(obj, keys[i])\n    }\n  }\n}\n\n\n/**\n * 使一个对象转化成可观测对象\n * @param { Object } obj 对象\n * @param { String } key 对象的key\n * @param { Any } val 对象的某个key的值\n */\nexport function defineReactive (\n  obj: Object,\n  key: string,\n  val: any,\n  customSetter?: ?Function,\n  shallow?: boolean\n) {\n  const dep = new Dep()\n\n  const property = Object.getOwnPropertyDescriptor(obj, key)\n  if (property && property.configurable === false) {\n    return\n  }\n\n  // cater for pre-defined getter/setters\n  const getter = property && property.get\n  const setter = property && property.set\n  if ((!getter || setter) && arguments.length === 2) {\n    val = obj[key]\n  }\n\n    // 递归调用，判断属性值是否是对象\n  let childOb = !shallow && observe(val)\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter () {\n      const value = getter ? getter.call(obj) : val\n      if (Dep.target) {\n        dep.depend()\n        if (childOb) {\n          childOb.dep.depend()\n          if (Array.isArray(value)) {\n            dependArray(value)\n          }\n        }\n      }\n      return value\n    },\n    set: function reactiveSetter (newVal) {\n      const value = getter ? getter.call(obj) : val\n      /* eslint-disable no-self-compare */\n      if (newVal === value || (newVal !== newVal && value !== value)) {\n        return\n      }\n      /* eslint-enable no-self-compare */\n      if (process.env.NODE_ENV !== 'production' && customSetter) {\n        customSetter()\n      }\n      // #7981: for accessor properties without setter\n      if (getter && !setter) return\n      if (setter) {\n        setter.call(obj, newVal)\n      } else {\n        val = newVal\n      }\n      childOb = !shallow && observe(newVal)\n      dep.notify()\n    }\n  })\n}\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br")])]),e("p",[e("strong",[s._v("什么是依赖收集")])]),s._v(" "),e("p",[s._v("视图里谁用到了这个数据就更新谁，我们换个优雅说法：我们把“谁用到了这个数据”称为“谁依赖了这个数据”，我们给每个数据都建一个依赖数组，谁依赖了这个数据我们就把谁放入这个依赖数组中，那么当这个数据发生变化的时候，我们就去它对应的依赖数据中，把每个依赖都通知一遍，告诉他们：“你们依赖的数据变啦，你们该更新啦！”。这个过程就是依赖收集。")]),s._v(" "),e("p",[e("strong",[s._v("何时收集依赖？何时通知依赖更新？")])]),s._v(" "),e("p",[s._v("在 getter 中收集依赖，在 setter 中通知依赖更新。")]),s._v(" "),e("p",[e("strong",[s._v("把依赖收集到哪里")])]),s._v(" "),e("p",[s._v("我们给每个数据都建一个依赖数组，谁依赖了这个数据我们就把谁放入这个依赖数组中。单单用一个数组来存放依赖的")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export default class Dep {\n  static target: ?Watcher;\n  id: number;\n  subs: Array<Watcher>;\n\n  constructor () {\n    this.id = uid++\n    this.subs = []\n  }\n\n  addSub (sub: Watcher) {\n    this.subs.push(sub)\n  }\n\n  removeSub (sub: Watcher) {\n    remove(this.subs, sub)\n  }\n\n    // 订阅\n  depend () {\n    if (Dep.target) {\n      Dep.target.addDep(this)\n    }\n  }\n    // 通知更新\n  notify () {\n    // 转化成数组\n    const subs = this.subs.slice()\n    if (process.env.NODE_ENV !== 'production' && !config.async) {\n      subs.sort((a, b) => a.id - b.id)\n    }\n    for (let i = 0, l = subs.length; i < l; i++) {\n      subs[i].update()\n    }\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("p",[s._v("有了依赖管理器后，我们就可以在 getter 中收集依赖，在 setter 中通知依赖更新了，代码如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function defineReactive (obj,key,val){\n\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("在上述代码中，我们在"),e("code",[s._v("getter")]),s._v("中调用了"),e("code",[s._v("dep.depend()")]),s._v("方法收集依赖，在"),e("code",[s._v("setter")]),s._v("中调用"),e("code",[s._v("dep.notify()")]),s._v("方法通知所有依赖更新。")]),s._v(" "),e("p",[e("strong",[s._v("依赖到底是谁")])]),s._v(" "),e("p",[s._v("上面我们明白了什么是依赖？何时收集依赖？以及收集的依赖存放到何处？那么我们收集的依赖到底是谁？")]),s._v(" "),e("p",[s._v("虽然我们一直在说“谁用到了这个数据谁”")]),s._v(" "),e("p",[e("code",[s._v("Watcher")]),s._v("类的具体实现如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export default class Watcher {\n  constructor (vm,expOrFn,cb) {\n    this.vm = vm;\n    this.cb = cb;\n    this.getter = parsePath(expOrFn)\n    this.value = this.get()\n  }\n  get () {\n    window.target = this;\n    const vm = this.vm\n    let value = this.getter.call(vm, vm)\n    window.target = undefined;\n    return value\n  }\n  update () {\n    const oldValue = this.value\n    this.value = this.get()\n    this.cb.call(this.vm, this.value, oldValue)\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[e("code",[s._v("Watcher")]),s._v("类的代码实现逻辑：")]),s._v(" "),e("ol",[e("li",[s._v("当实例化"),e("code",[s._v("Watcher")]),s._v("类时，会先执行其构造函数；")]),s._v(" "),e("li",[s._v("在构造函数中调用了"),e("code",[s._v("this.get()")]),s._v("实例方法；")]),s._v(" "),e("li",[s._v("在"),e("code",[s._v("get()")]),s._v("方法中，首先通过"),e("code",[s._v("window.target = this")]),s._v("把实例自身赋给了全局的一个唯一对象"),e("code",[s._v("window.target")]),s._v("上，然后通过"),e("code",[s._v("let value = this.getter.call(vm,vm)")]),s._v("获取一下被依赖的数据，获取被依赖数据的目的是触发该数据上面的"),e("code",[s._v("getter")]),s._v("，上文我们说过，在"),e("code",[s._v("getter")]),s._v("里会调用"),e("code",[s._v("dep.depend()")]),s._v("收集依赖，而在"),e("code",[s._v("dep.depend()")]),s._v("中取到挂载"),e("code",[s._v("window.target")]),s._v("上的值并将其存入依赖数组中，在"),e("code",[s._v("get()")]),s._v("方法最后将"),e("code",[s._v("window.target")]),s._v("释放掉。")]),s._v(" "),e("li",[s._v("而当数据变化时，会触发数据的"),e("code",[s._v("setter")]),s._v("，在"),e("code",[s._v("setter")]),s._v("中调用了"),e("code",[s._v("dep.notify()")]),s._v("方法，在"),e("code",[s._v("dep.notify()")]),s._v("方法中，遍历所有依赖(即 watcher 实例)，执行依赖的"),e("code",[s._v("update()")]),s._v("方法，也就是"),e("code",[s._v("Watcher")]),s._v("类中的"),e("code",[s._v("update()")]),s._v("实例方法，在"),e("code",[s._v("update()")]),s._v("方法中调用数据变化的更新回调函数，从而更新视图")])]),s._v(" "),e("h4",{attrs:{id:"_2-2-array-的变化侦测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-array-的变化侦测"}},[s._v("#")]),s._v(" 2.2 Array 的变化侦测")]),s._v(" "),e("p",[s._v("上一节文章中我们介绍了"),e("code",[s._v("Object")]),s._v("数据的变化侦测方式，本节我们来看一下对"),e("code",[s._v("Array")]),s._v("型数据的变化"),e("code",[s._v("Vue")]),s._v("是如何进行侦测的。")]),s._v(" "),e("h4",{attrs:{id:"_2-3-变化侦测的-api-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-变化侦测的-api-实现"}},[s._v("#")]),s._v(" 2.3 变化侦测的 API 实现")]),s._v(" "),e("h3",{attrs:{id:"三、虚拟-dom-篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、虚拟-dom-篇"}},[s._v("#")]),s._v(" 三、虚拟 DOM 篇")]),s._v(" "),e("ul",[e("li",[s._v("Vue 中的虚拟 DOM")]),s._v(" "),e("li",[s._v("Vue 中的 DOM-Diff")]),s._v(" "),e("li",[s._v("更新子节点")]),s._v(" "),e("li",[s._v("优化更新子节点")])]),s._v(" "),e("h4",{attrs:{id:"_3-1-vue-中的虚拟-dom"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-vue-中的虚拟-dom"}},[s._v("#")]),s._v(" 3.1 Vue 中的虚拟 DOM")]),s._v(" "),e("p",[s._v("参考"),e("a",{attrs:{href:"https://km.xiaowuzi.info/js/vue-dom.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue 虚拟 DOM"),e("OutboundLink")],1)]),s._v(" "),e("h4",{attrs:{id:"_3-2-vue-中的-dom-diff"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-vue-中的-dom-diff"}},[s._v("#")]),s._v(" 3.2 Vue 中的 DOM-Diff")]),s._v(" "),e("p",[s._v("参考"),e("a",{attrs:{href:"https://km.xiaowuzi.info/js/vue-diff.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("diff 算法"),e("OutboundLink")],1)]),s._v(" "),e("h4",{attrs:{id:"_3-3-更新子节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-更新子节点"}},[s._v("#")]),s._v(" 3.3 更新子节点")]),s._v(" "),e("h4",{attrs:{id:"_3-4-优化更新子节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-优化更新子节点"}},[s._v("#")]),s._v(" 3.4 优化更新子节点")]),s._v(" "),e("h3",{attrs:{id:"四、模板编译篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、模板编译篇"}},[s._v("#")]),s._v(" 四、模板编译篇")]),s._v(" "),e("ul",[e("li",[s._v("整体运行流程")]),s._v(" "),e("li",[s._v("HTML 解析器")]),s._v(" "),e("li",[s._v("文本解析器")]),s._v(" "),e("li",[s._v("优化阶段")]),s._v(" "),e("li",[s._v("代码生成阶段")])]),s._v(" "),e("p",[s._v("我们知道，在日常开发中，我们把写在"),e("code",[s._v("<template></template>")]),s._v("标签中的类似于原生"),e("code",[s._v("HTML")]),s._v("的内容称之为模板。这时你可能会问了，为什么说是“类似于原生"),e("code",[s._v("HTML")]),s._v("的内容”而不是“就是"),e("code",[s._v("HTML")]),s._v("的内容”？因为我们在开发中，在"),e("code",[s._v("<template></template>")]),s._v("标签中除了写一些原生"),e("code",[s._v("HTML")]),s._v("的标签，我们还会写一些亦是插值，如或者写一些"),e("code",[s._v("Vue")]),s._v("指令，如"),e("code",[s._v("v-on")]),s._v("、"),e("code",[s._v("v-if")]),s._v("等。而这些东西都是在原生"),e("code",[s._v("HTML")]),s._v("语法中不存在的，不被接受的。但事实上我们确实这么写了，也被正确识别了，页面也正常显示了，这又是为什么呢？")]),s._v(" "),e("p",[s._v("这就归功于"),e("code",[s._v("Vue")]),s._v("的模板编译了，"),e("code",[s._v("Vue")]),s._v("会把用户在"),e("code",[s._v("<template></template>")]),s._v("标签中写的类似于原生"),e("code",[s._v("HTML")]),s._v("的内容进行编译，把原生"),e("code",[s._v("HTML")]),s._v("的内容找出来，再把非原生"),e("code",[s._v("HTML")]),s._v("找出来，经过一系列的逻辑处理生成渲染函数，也就是"),e("code",[s._v("render")]),s._v("函数，而"),e("code",[s._v("redner")]),s._v("函数会将模板内容生成对应的"),e("code",[s._v("VNode")]),s._v("，而"),e("code",[s._v("VNode")]),s._v("再经过"),e("code",[s._v("patch")]),s._v("过程从而得到将要渲染的视图中的"),e("code",[s._v("VNode")]),s._v("，最后根据"),e("code",[s._v("VNode")]),s._v("创建真实的"),e("code",[s._v("DOM")]),s._v("节点并插入到视图中，最终完成视图的渲染更新。")]),s._v(" "),e("p",[s._v("而把用户在"),e("code",[s._v("<template></template>")]),s._v("标签中写的类似于原生"),e("code",[s._v("HTML")]),s._v("的内容进行编译，把原生"),e("code",[s._v("HTML")]),s._v("的内容找出来，再把非原生"),e("code",[s._v("HTML")]),s._v("找出来，经过一系列的逻辑处理成渲染函数，也就是"),e("code",[s._v("render")]),s._v("函数的这一段过程称之为模板编译过程。")]),s._v(" "),e("h4",{attrs:{id:"_4-1-整体渲染流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-整体渲染流程"}},[s._v("#")]),s._v(" 4.1 整体渲染流程")]),s._v(" "),e("p",[s._v("所谓渲染流程，就是把用户写的类似原生"),e("code",[s._v("HTML")]),s._v("的模板经过一系列处理最终反应到视图中称之为整个渲染流程。这个流程在上文中其实已经说到了，下面我们以流程图的形式宏观的了解一下，流程图如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:"vue-code01.png",alt:"images"}})]),s._v(" "),e("p",[s._v("从图中我们也可以看到，模板编译过程就是把用户写的模板经过一系列处理最终生成"),e("code",[s._v("render")]),s._v("函数的过程。")]),s._v(" "),e("p",[s._v("将一堆字符串模板解析成抽象语法树"),e("code",[s._v("AST")]),s._v("后，我们就可以对其进行各种操作处理了，处理完后用处理后的"),e("code",[s._v("AST")]),s._v("来生成"),e("code",[s._v("render")]),s._v("函数。其具体流程可大致分为三个阶段：")]),s._v(" "),e("ol",[e("li",[s._v("模板解析阶段：将一堆模板字符串用正则等方式解析成抽象语法树"),e("code",[s._v("AST")]),s._v("；")]),s._v(" "),e("li",[s._v("优化阶段：遍历"),e("code",[s._v("AST")]),s._v("，找出其中的静态节点，并打上标记；")]),s._v(" "),e("li",[s._v("代码生成阶段：将"),e("code",[s._v("AST")]),s._v("转换成渲染函数；")])]),s._v(" "),e("p",[s._v("这三个阶段在源码中分别对应三个模块，下面给出三个模块的源代码在源码中的路径：")]),s._v(" "),e("ol",[e("li",[s._v("模板解析段——解析器——源码路径："),e("code",[s._v("src/compiler/parser/index.js")])]),s._v(" "),e("li",[s._v("优化阶段——优化器——源码路径："),e("code",[s._v("src/compiler/optimizer.js")])]),s._v(" "),e("li",[s._v("代码生成阶段——代码生成器——源码路径："),e("code",[s._v("src/compiler/codegen/index.js")])])]),s._v(" "),e("h4",{attrs:{id:"_4-1-整体运行流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-整体运行流程"}},[s._v("#")]),s._v(" 4.1 整体运行流程")]),s._v(" "),e("p",[s._v("在模板解析阶段主要做的工作是把用户在"),e("code",[s._v("<template></template>")]),s._v("标签内写的模板使用正则等方式解析成抽象语法树（"),e("code",[s._v("AST")]),s._v("）。而这一阶段在源码中对应解析器（"),e("code",[s._v("parser")]),s._v("）模块。")]),s._v(" "),e("p",[s._v("解析器，顾名思义，就是把用户所写的模板根据一定的解析规则解析出有效的信息，最后用这些信息形成"),e("code",[s._v("AST")]),s._v("。我们知道在"),e("code",[s._v("<template></template>")]),s._v("模板内，除了有常规的"),e("code",[s._v("HTML")]),s._v("标签外，")]),s._v(" "),e("h4",{attrs:{id:"_4-2-html-解析器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-html-解析器"}},[s._v("#")]),s._v(" 4.2 HTML 解析器")]),s._v(" "),e("p",[e("strong",[s._v("HTML 解析器内部运行流程")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//  代码位置：/src/complier/parser/index.js\n\n/**\n *  Convert HTML string to AST.\n *  将HTML模板字符串转化为AST\n */\nexport function parse(template,options){\n    // ...\n    parseHTML(template,{\n        warn,\n        expectHTML: options.expectHTML,\n        isUnaryTag: options.isUnaryTag,\n        canBeLeftOpenTag: options.canBeLeftOpenTag,\n        shouldDecodeNewlines: options.shouldDecodeNewlines,\n        shouldDecodeNewlinesForHref: options.shouldDecodeNewlinesForHref,\n        shouldKeepComment: options.comments,\n        // 当解析到开始标签时，调用该函数\n        start(tag,attrs,unary){\n\n        },\n        // 当解析到结束标签时，调用该函数\n        end(){\n\n        },\n        // 当解析到文本时，调用该函数\n        chars(text){\n\n        },\n        // 当解析到注释时，调用该函数\n        comment(text){\n\n        }\n    })\n    return root\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br")])]),e("p",[s._v("从代码中我们可以看到，调用"),e("code",[s._v("parseHTML")]),s._v("函数时为其传入的两个参数分别是：")]),s._v(" "),e("ul",[e("li",[s._v("template 待转换的模板字符串；")]),s._v(" "),e("li",[s._v("options 转换时所需的选项；")])]),s._v(" "),e("p",[e("strong",[s._v("如何解析不同的内容")])]),s._v(" "),e("p",[s._v("要从模板字符串中解析出不同的内容，那")]),s._v(" "),e("h4",{attrs:{id:"_4-3-文本解析器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-文本解析器"}},[s._v("#")]),s._v(" 4.3 文本解析器")]),s._v(" "),e("h4",{attrs:{id:"_4-5-优化阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-优化阶段"}},[s._v("#")]),s._v(" 4.5 优化阶段")]),s._v(" "),e("h4",{attrs:{id:"_4-5-代码生成阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-代码生成阶段"}},[s._v("#")]),s._v(" 4.5 代码生成阶段")]),s._v(" "),e("h3",{attrs:{id:"五、生命周期篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、生命周期篇"}},[s._v("#")]),s._v(" 五、生命周期篇")]),s._v(" "),e("ul",[e("li",[s._v("初始化阶段")]),s._v(" "),e("li",[s._v("模板编译阶段")]),s._v(" "),e("li",[s._v("挂载阶段")]),s._v(" "),e("li",[s._v("销毁阶段")])]),s._v(" "),e("h4",{attrs:{id:"_5-1-初始化阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-初始化阶段"}},[s._v("#")]),s._v(" 5.1 初始化阶段")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("new Vue")])]),s._v(" "),e("li",[e("code",[s._v("initLifecycle")])]),s._v(" "),e("li",[e("code",[s._v("initEvents")])]),s._v(" "),e("li",[e("code",[s._v("initInjections")])]),s._v(" "),e("li",[e("code",[s._v("initState")])])]),s._v(" "),e("p",[e("strong",[s._v("new Vue 都干了什么")])]),s._v(" "),e("p",[s._v("初始化阶段所做的第一件事就是"),e("code",[s._v("new Vue()")]),s._v("创建一个"),e("code",[s._v("Vue")]),s._v("实例，那么"),e("code",[s._v("new Vue()")]),s._v("的内部都干了什么呢？我们知道，"),e("code",[s._v("new")]),s._v("关键字在"),e("code",[s._v("JS")]),s._v("中表示从一个类中实例化出一个对象来，由此可见，"),e("code",[s._v("Vue")]),s._v("实际上是一个类。所以"),e("code",[s._v("new Vue()")]),s._v("实际上是执行了"),e("code",[s._v("Vue")]),s._v("类的构造函数")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function Vue (options) {\n  if (process.env.NODE_ENV !== 'production' &&\n    !(this instanceof Vue)\n  ) {\n    warn('Vue is a constructor and should be called with the `new` keyword')\n  }\n  this._init(options)\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("合并属性")])]),s._v(" "),e("p",[s._v("在上文中，"),e("code",[s._v("_init")]),s._v("方法里首先会调用"),e("code",[s._v("mergeOptions")]),s._v("函数来进行属性合并，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vm.$options = mergeOptions(\n    resolveConstructorOptions(vm.constructor),\n    options || {},\n    vm\n)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("它实际上就是把 "),e("code",[s._v("resolveConstructorOptions(vm.constructor)")]),s._v(" 的返回值和 "),e("code",[s._v("options")]),s._v(" 做合并，返回"),e("code",[s._v("vm.constructor.options")]),s._v("，相当于"),e("code",[s._v("Vue.options")]),s._v("，那么这个"),e("code",[s._v("Vue.options")]),s._v("又是什么呢，其实在"),e("code",[s._v("initGlobalAPI(Vue)")]),s._v("的时候定义了这个值，代码在"),e("code",[s._v("src/core/global-api/index.js")]),s._v("中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export function initGlobalAPI (Vue: GlobalAPI) {\n  // ...\n  Vue.options = Object.create(null)\n  ASSET_TYPES.forEach(type => {\n    Vue.options[type + 's'] = Object.create(null)\n  })\n\n  extend(Vue.options.components, builtInComponents)\n  // ...\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("首先通过"),e("code",[s._v("Vue.options = Object.create(null)")]),s._v("创建一个空对象，然后遍历"),e("code",[s._v("ASSET_TYPES")]),s._v("，"),e("code",[s._v("ASSET_TYPES")]),s._v("的定义在"),e("code",[s._v("src/shared/contstants.js")]),s._v("中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export const ASSET_TYPES = [\n  'component',\n  'directive',\n  'filter'\n]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("上面遍历"),e("code",[s._v("ASSET_TYPES")]),s._v("后代码相当于：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Vue.options.components = {}\nVue.options.directives = {}\nVue.options.filters = {}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("最后通过"),e("code",[s._v("extend(Vue.options.components,builtInCompontents)")]),s._v("把一些内置组件扩展到"),e("code",[s._v("Vue.options.components")]),s._v("上，"),e("code",[s._v("Vue")]),s._v("的内置组件目前有"),e("code",[s._v("<keep-alive>")]),s._v("、"),e("code",[s._v("<transition>")]),s._v("和"),e("code",[s._v("<transition-group>")]),s._v("组件，这也就是为什么我们在其它组件中使用这些组件不需要注册的原因。")]),s._v(" "),e("p",[e("code",[s._v("mergeOptions")]),s._v("这个函数，它的定义在"),e("code",[s._v("src/core/util/options.js")]),s._v("中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n * Merge two option objects into a new one.\n * Core utility used in both instantiation and inheritance.\n */\nexport function mergeOptions (\n  parent: Object,\n  child: Object,\n  vm?: Component\n): Object {\n  if (process.env.NODE_ENV !== 'production') {\n    checkComponents(child)\n  }\n\n  if (typeof child === 'function') {\n    child = child.options\n  }\n\n  normalizeProps(child, vm)\n  normalizeInject(child, vm)\n  normalizeDirectives(child)\n\n  // Apply extends and mixins on the child options,\n  // but only if it is a raw options object that isn't\n  // the result of another mergeOptions call.\n  // Only merged options has the _base property.\n  if (!child._base) {\n    if (child.extends) {\n      parent = mergeOptions(parent, child.extends, vm)\n    }\n    if (child.mixins) {\n      for (let i = 0, l = child.mixins.length; i < l; i++) {\n        parent = mergeOptions(parent, child.mixins[i], vm)\n      }\n    }\n  }\n\n  const options = {}\n  let key\n  for (key in parent) {\n    mergeField(key)\n  }\n  for (key in child) {\n    if (!hasOwn(parent, key)) {\n      mergeField(key)\n    }\n  }\n  function mergeField (key) {\n    const strat = strats[key] || defaultStrat\n    options[key] = strat(parent[key], child[key], vm, key)\n  }\n  return options\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br")])]),e("p",[s._v("可以看出，"),e("code",[s._v("mergeOptions")]),s._v("函数的主要功能是把"),e("code",[s._v("parent")]),s._v("和"),e("code",[s._v("child")]),s._v("这两个对象根据一些合并策略，合并成一个新对象并返回。首先递归把"),e("code",[s._v("extends")]),s._v("和"),e("code",[s._v("mixins")]),s._v("合并到"),e("code",[s._v("parent")]),s._v("上")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("生命周期钩子函数的合并策略如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function mergeHook(parentVal,childVal){\n    return childVal? parentVal ? parentVal.concat(childVal) : Array.isArray(childVal) ? childVal : [childVal] : parentVal\n}\n\nLIFECYCLE_HOOKS.forEach(hook => {\n  strats[hook] = mergeHook\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("这其中的"),e("code",[s._v("LIFECYCLE_HOOKS")]),s._v("的定义在"),e("code",[s._v("src/shared/constants.js")]),s._v("中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export const LIFECYCLE_HOOKS = [\n  'beforeCreate',\n  'created',\n  'beforeMount',\n  'mounted',\n  'beforeUpdate',\n  'updated',\n  'beforeDestroy',\n  'destroyed',\n  'activated',\n  'deactivated',\n  'errorCaptured'\n]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[e("strong",[s._v("callHook 函数如何触发钩子函数")])]),s._v(" "),e("p",[s._v("关于"),e("code",[s._v("callHook")]),s._v("函数如何触发钩子函数的问题，我们只需看一下该函数的实现源码即可，该函数的源码位于"),e("code",[s._v("src/core/instance/lifecycle.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export function callHook(vm,hook){\n    const handlers = vm.$options[hook]\n    if(handlers){\n        for(let i = 0,j = handlers.length;i<j;i++){\n            try{\n                hanlders[i].call(vm)\n            }catch(e){\n                handleError(e,vm,`${hook} hook`)\n            }\n        }\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("可以看到，"),e("code",[s._v("callHook")]),s._v("函数逻辑非常简单。首先从实例的"),e("code",[s._v("$options")]),s._v("中获取到需要触发的钩子名称所对应的钩子函数数组"),e("code",[s._v("handlers")]),s._v("，我们说过，每个生命周期钩子名称都对应一个钩子函数数组。然后遍历该数组，将数组中的每个钩子函数都执行一遍。")]),s._v(" "),e("p",[e("strong",[s._v("initLifecycle 函数分析")])]),s._v(" "),e("p",[e("code",[s._v("initLifecycle")]),s._v("函数的定义的位于源码的"),e("code",[s._v("src/core/instance/lifecycle.js")]),s._v("中，其代码如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export function initLifecycle (vm: Component) {\n  const options = vm.$options\n\n  // locate first non-abstract parent\n  let parent = options.parent\n  if (parent && !options.abstract) {\n    while (parent.$options.abstract && parent.$parent) {\n      parent = parent.$parent\n    }\n    parent.$children.push(vm)\n  }\n\n  vm.$parent = parent\n  vm.$root = parent ? parent.$root : vm\n\n  vm.$children = []\n  vm.$refs = {}\n\n  vm._watcher = null\n  vm._inactive = null\n  vm._directInactive = false\n  vm._isMounted = false\n  vm._isDestroyed = false\n  vm._isBeingDestroyed = false\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[e("strong",[s._v("解析事件")])]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("Vue")]),s._v("中，当我们在父组件中使用子组件时可以给子组件上注册一些事件，这些事件包括使用"),e("code",[s._v("v-on")]),s._v("或"),e("code",[s._v("@")]),s._v("注册的自定义事件，也包括注册的浏览器原生事件，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<child @select="selectHandler" \t@click.native="clickHandler"></child>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("上面代码，首先要从解析事件开始说起，当遇到开始标签的时候，除了会解析开始标签，还会调用"),e("code",[s._v("processAttrs")]),s._v("方法解析标签中的属性，"),e("code",[s._v("processAttrs")]),s._v("方法位于源码的"),e("code",[s._v("src/compiler/parser/index.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function processAttrs (el) {\n  const list = el.attrsList\n  let i, l, name, rawName, value, modifiers, syncGen, isDynamic\n  for (i = 0, l = list.length; i < l; i++) {\n    name = rawName = list[i].name\n    value = list[i].value\n    if (dirRE.test(name)) {\n      // mark element as dynamic\n      el.hasBindings = true\n      // modifiers\n      modifiers = parseModifiers(name.replace(dirRE, ''))\n      // support .foo shorthand syntax for the .prop modifier\n      if (process.env.VBIND_PROP_SHORTHAND && propBindRE.test(name)) {\n        (modifiers || (modifiers = {})).prop = true\n        name = `.` + name.slice(1).replace(modifierRE, '')\n      } else if (modifiers) {\n        name = name.replace(modifierRE, '')\n      }\n      if (bindRE.test(name)) { // v-bind\n        name = name.replace(bindRE, '')\n        value = parseFilters(value)\n        isDynamic = dynamicArgRE.test(name)\n        if (isDynamic) {\n          name = name.slice(1, -1)\n        }\n        if (\n          process.env.NODE_ENV !== 'production' &&\n          value.trim().length === 0\n        ) {\n          warn(\n            `The value for a v-bind expression cannot be empty. Found in \"v-bind:${name}\"`\n          )\n        }\n        if (modifiers) {\n          if (modifiers.prop && !isDynamic) {\n            name = camelize(name)\n            if (name === 'innerHtml') name = 'innerHTML'\n          }\n          if (modifiers.camel && !isDynamic) {\n            name = camelize(name)\n          }\n          if (modifiers.sync) {\n            syncGen = genAssignmentCode(value, `$event`)\n            if (!isDynamic) {\n              addHandler(\n                el,\n                `update:${camelize(name)}`,\n                syncGen,\n                null,\n                false,\n                warn,\n                list[i]\n              )\n              if (hyphenate(name) !== camelize(name)) {\n                addHandler(\n                  el,\n                  `update:${hyphenate(name)}`,\n                  syncGen,\n                  null,\n                  false,\n                  warn,\n                  list[i]\n                )\n              }\n            } else {\n              // handler w/ dynamic event name\n              addHandler(\n                el,\n                `\"update:\"+(${name})`,\n                syncGen,\n                null,\n                false,\n                warn,\n                list[i],\n                true // dynamic\n              )\n            }\n          }\n        }\n        if ((modifiers && modifiers.prop) || (\n          !el.component && platformMustUseProp(el.tag, el.attrsMap.type, name)\n        )) {\n          addProp(el, name, value, list[i], isDynamic)\n        } else {\n          addAttr(el, name, value, list[i], isDynamic)\n        }\n      } else if (onRE.test(name)) { // v-on\n        name = name.replace(onRE, '')\n        isDynamic = dynamicArgRE.test(name)\n        if (isDynamic) {\n          name = name.slice(1, -1)\n        }\n        addHandler(el, name, value, modifiers, false, warn, list[i], isDynamic)\n      } else { // normal directives\n        name = name.replace(dirRE, '')\n        // parse arg\n        const argMatch = name.match(argRE)\n        let arg = argMatch && argMatch[1]\n        isDynamic = false\n        if (arg) {\n          name = name.slice(0, -(arg.length + 1))\n          if (dynamicArgRE.test(arg)) {\n            arg = arg.slice(1, -1)\n            isDynamic = true\n          }\n        }\n        addDirective(el, name, rawName, value, arg, isDynamic, modifiers, list[i])\n        if (process.env.NODE_ENV !== 'production' && name === 'model') {\n          checkForAliasModel(el, value)\n        }\n      }\n    } else {\n      // literal attribute\n      if (process.env.NODE_ENV !== 'production') {\n        const res = parseText(value, delimiters)\n        if (res) {\n          warn(\n            `${name}=\"${value}\": ` +\n            'Interpolation inside attributes has been removed. ' +\n            'Use v-bind or the colon shorthand instead. For example, ' +\n            'instead of <div id=\"{{ val }}\">, use <div :id=\"val\">.',\n            list[i]\n          )\n        }\n      }\n      addAttr(el, name, JSON.stringify(value), list[i])\n      // #6887 firefox doesn't update muted state if set via attribute\n      // even immediately after element creation\n      if (!el.component &&\n          name === 'muted' &&\n          platformMustUseProp(el.tag, el.attrsMap.type, name)) {\n        addProp(el, name, 'true', list[i])\n      }\n    }\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br")])]),e("p",[e("strong",[s._v("initEvents 函数分析")])]),s._v(" "),e("p",[s._v("了解了以上过程之后，开始分析"),e("code",[s._v("initEvents")]),s._v("函数，该函数位于源码的"),e("code",[s._v("src/instance/events.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export function initEvents (vm: Component) {\n  vm._events = Object.create(null)\n  vm._hasHookEvent = false\n  // init parent attached events\n  const listeners = vm.$options._parentListeners\n  if (listeners) {\n    updateComponentListeners(vm, listeners)\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[e("strong",[s._v("initInjections 函数分析")])]),s._v(" "),e("p",[s._v("从函数名字上来看，该函数是用来初始化实例中的"),e("code",[s._v("inject")]),s._v("选项的。说到"),e("code",[s._v("inject")]),s._v("选项，那必然离不开"),e("code",[s._v("provide")]),s._v("选项，这两个选项都是成对出现的，它们的作用是：鸡毛一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在起上下游关系成立的时间始终生效。")]),s._v(" "),e("p",[e("code",[s._v("provide")]),s._v("选项应该是一个对象或返回一个对象的函数。该对象包含可注入其子孙的属性。在该对象中你可以使用 ES 2015 Symbols 作为 key，但是只在原生支持"),e("code",[s._v("Symbol")]),s._v("和"),e("code",[s._v("Reflect.ownKeys")]),s._v("的环境下可工作。")]),s._v(" "),e("p",[e("code",[s._v("inject")]),s._v("选项应该是：")]),s._v(" "),e("ul",[e("li",[s._v("一个字符串数组或")]),s._v(" "),e("li",[s._v("一个对象，对象的 key 是本地的绑定名，value 是：\n"),e("ul",[e("li",[s._v("在可用的注入")])])])]),s._v(" "),e("p",[e("code",[s._v("initInjections")]),s._v("函数的具体原理，该函数定义在位于源码的``中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export function initInjections (vm: Component) {\n  const result = resolveInject(vm.$options.inject, vm)\n  if (result) {\n    toggleObserving(false)\n    Object.keys(result).forEach(key => {\n      /* istanbul ignore else */\n      if (process.env.NODE_ENV !== 'production') {\n        defineReactive(vm, key, result[key], () => {\n          warn(\n            `Avoid mutating an injected value directly since the changes will be ` +\n            `overwritten whenever the provided component re-renders. ` +\n            `injection being mutated: \"${key}\"`,\n            vm\n          )\n        })\n      } else {\n        defineReactive(vm, key, result[key])\n      }\n    })\n    toggleObserving(true)\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("p",[e("strong",[s._v("initState 函数分析")])]),s._v(" "),e("p",[s._v("这个函数是用来初始化实例状态的，主要包括"),e("code",[s._v("props")]),s._v("、"),e("code",[s._v("data")]),s._v("、"),e("code",[s._v("methods")]),s._v("、"),e("code",[s._v("computed")]),s._v("、"),e("code",[s._v("watch")]),s._v("，我们把这些选项称为实例的状态选项。也就是说，"),e("code",[s._v("initState")]),s._v("函数就是用来初始化这些状态的。")]),s._v(" "),e("p",[s._v("首先我们先来分析"),e("code",[s._v("initState")]),s._v("函数，该函数的定义位于源码的"),e("code",[s._v("src/core/instance/state.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export function initState (vm: Component) {\n  vm._watchers = []\n  const opts = vm.$options\n  if (opts.props) initProps(vm, opts.props)\n  if (opts.methods) initMethods(vm, opts.methods)\n  if (opts.data) {\n    initData(vm)\n  } else {\n    observe(vm._data = {}, true /* asRootData */)\n  }\n  if (opts.computed) initComputed(vm, opts.computed)\n  if (opts.watch && opts.watch !== nativeWatch) {\n    initWatch(vm, opts.watch)\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("首先，给实例上新增了一个属性"),e("code",[s._v("_watchers")]),s._v("，用来存储当前实例中所有的"),e("code",[s._v("watcher")]),s._v("实例，无论是使用"),e("code",[s._v("vm.$watch")]),s._v("注册的"),e("code",[s._v("watcher")]),s._v("实例还是使用"),e("code",[s._v("watch")]),s._v("选项注册的"),e("code",[s._v("watcher")]),s._v("实例，都会被保存到该属性中。")]),s._v(" "),e("p",[e("code",[s._v("initProps")]),s._v("函数的定义位于源码的"),e("code",[s._v("src/core/instance/state.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function initProps (vm: Component, propsOptions: Object) {\n  const propsData = vm.$options.propsData || {}\n  const props = vm._props = {}\n  // cache prop keys so that future props updates can iterate using Array\n  // instead of dynamic object key enumeration.\n  const keys = vm.$options._propKeys = []\n  const isRoot = !vm.$parent\n  // root instance props should be converted\n  if (!isRoot) {\n    toggleObserving(false)\n  }\n  for (const key in propsOptions) {\n    keys.push(key)\n    const value = validateProp(key, propsOptions, propsData, vm)\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== 'production') {\n      const hyphenatedKey = hyphenate(key)\n      if (isReservedAttribute(hyphenatedKey) ||\n          config.isReservedAttr(hyphenatedKey)) {\n        warn(\n          `\"${hyphenatedKey}\" is a reserved attribute and cannot be used as component prop.`,\n          vm\n        )\n      }\n      defineReactive(props, key, value, () => {\n        if (!isRoot && !isUpdatingChildComponent) {\n          warn(\n            `Avoid mutating a prop directly since the value will be ` +\n            `overwritten whenever the parent component re-renders. ` +\n            `Instead, use a data or computed property based on the prop's ` +\n            `value. Prop being mutated: \"${key}\"`,\n            vm\n          )\n        }\n      })\n    } else {\n      defineReactive(props, key, value)\n    }\n    // static props are already proxied on the component's prototype\n    // during Vue.extend(). We only need to proxy props defined at\n    // instantiation here.\n    if (!(key in vm)) {\n      proxy(vm, `_props`, key)\n    }\n  }\n  toggleObserving(true)\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br")])]),e("p",[s._v("可以看到，该函数接收两个参数：当前"),e("code",[s._v("Vue")]),s._v("实例和当前实例规范化后的"),e("code",[s._v("props")]),s._v("选项。")]),s._v(" "),e("p",[s._v("在函数内部首先定义了 4 个变量，分别是：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const propsData = vm.$options.propsData || {}\nconst props = vm._props = {}\nconst keys = vm.$options._propKeys = []\nconst isRoot = !vm.$parent\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("propsData：父组件传入的真实"),e("code",[s._v("props")]),s._v("数据。")]),s._v(" "),e("li",[s._v("props：指向"),e("code",[s._v("vm._props")]),s._v("指针，所有设置到")]),s._v(" "),e("li",[s._v("keys：指向"),e("code",[s._v("vm.$options._propKeys")]),s._v("的指针，缓存")]),s._v(" "),e("li",[s._v("isRoot：当前组件是否为根组件。")])]),s._v(" "),e("p",[s._v("初始化"),e("code",[s._v("methods")]),s._v("相较而言就比较简单了，它的初始函数定义位于源码的"),e("code",[s._v("src/core/instance/state.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('function initMethods (vm: Component, methods: Object) {\n  const props = vm.$options.props\n  for (const key in methods) {\n    if (process.env.NODE_ENV !== \'production\') {\n      if (typeof methods[key] !== \'function\') {\n        warn(\n          `Method "${key}" has type "${typeof methods[key]}" in the component definition. ` +\n          `Did you reference the function correctly?`,\n          vm\n        )\n      }\n      if (props && hasOwn(props, key)) {\n        warn(\n          `Method "${key}" has already been defined as a prop.`,\n          vm\n        )\n      }\n      if ((key in vm) && isReserved(key)) {\n        warn(\n          `Method "${key}" conflicts with an existing Vue instance method. ` +\n          `Avoid defining component methods that start with _ or $.`\n        )\n      }\n    }\n    vm[key] = typeof methods[key] !== \'function\' ? noop : bind(methods[key], vm)\n  }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("p",[s._v("初始化"),e("code",[s._v("data")]),s._v("也比较简单，它的初始化函数定义位于源码的"),e("code",[s._v("src/core/instance/state.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export function initState (vm: Component) {\n  vm._watchers = []\n  const opts = vm.$options\n  if (opts.props) initProps(vm, opts.props)\n  if (opts.methods) initMethods(vm, opts.methods)\n  if (opts.data) {\n    initData(vm)\n  } else {\n    observe(vm._data = {}, true /* asRootData */)\n  }\n  if (opts.computed) initComputed(vm, opts.computed)\n  if (opts.watch && opts.watch !== nativeWatch) {\n    initWatch(vm, opts.watch)\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("初始化"),e("code",[s._v("initComputed")]),s._v("的内部原理是怎样的。"),e("code",[s._v("initComputed")]),s._v("函数的定义位于源码的"),e("code",[s._v("src/core/instance/state.js")]),s._v("中，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function initComputed (vm: Component, computed: Object) {\n  // $flow-disable-line\n  const watchers = vm._computedWatchers = Object.create(null)\n  // computed properties are just getters during SSR\n  const isSSR = isServerRendering()\n\n  for (const key in computed) {\n    const userDef = computed[key]\n    const getter = typeof userDef === 'function' ? userDef : userDef.get\n    if (process.env.NODE_ENV !== 'production' && getter == null) {\n      warn(\n        `Getter is missing for computed property \"${key}\".`,\n        vm\n      )\n    }\n\n    if (!isSSR) {\n      // create internal watcher for the computed property.\n      watchers[key] = new Watcher(\n        vm,\n        getter || noop,\n        noop,\n        computedWatcherOptions\n      )\n    }\n\n    // component-defined computed properties are already defined on the\n    // component prototype. We only need to define computed properties defined\n    // at instantiation here.\n    if (!(key in vm)) {\n      defineComputed(vm, key, userDef)\n    } else if (process.env.NODE_ENV !== 'production') {\n      if (key in vm.$data) {\n        warn(`The computed property \"${key}\" is already defined in data.`, vm)\n      } else if (vm.$options.props && key in vm.$options.props) {\n        warn(`The computed property \"${key}\" is already defined as a prop.`, vm)\n      }\n    }\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br")])]),e("p",[s._v("初始化"),e("code",[s._v("watch")]),s._v("选项，在日常开发中"),e("code",[s._v("watch")]),s._v("选项也经常会使用到，它可以用来侦听某个已有的数据，当该数据发生变化时执行对应的回调函数。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function initWatch (vm: Component, watch: Object) {\n  for (const key in watch) {\n    const handler = watch[key]\n    if (Array.isArray(handler)) {\n      for (let i = 0; i < handler.length; i++) {\n        createWatcher(vm, key, handler[i])\n      }\n    } else {\n      createWatcher(vm, key, handler)\n    }\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h4",{attrs:{id:"_5-2-模板编译阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-模板编译阶段"}},[s._v("#")]),s._v(" 5.2 模板编译阶段")]),s._v(" "),e("h4",{attrs:{id:"_5-3-挂载阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-挂载阶段"}},[s._v("#")]),s._v(" 5.3 挂载阶段")]),s._v(" "),e("h4",{attrs:{id:"_5-4-销毁阶段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-销毁阶段"}},[s._v("#")]),s._v(" 5.4 销毁阶段")]),s._v(" "),e("h3",{attrs:{id:"六、实例方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六、实例方法"}},[s._v("#")]),s._v(" 六、实例方法")]),s._v(" "),e("ul",[e("li",[s._v("数据相关的方法")]),s._v(" "),e("li",[s._v("事件相关的方法")]),s._v(" "),e("li",[s._v("生命周期相关的方法")])]),s._v(" "),e("h4",{attrs:{id:"_6-1-数据相关的方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-数据相关的方法"}},[s._v("#")]),s._v(" 6.1 数据相关的方法")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("vm.$watch")])]),s._v(" "),e("li",[e("code",[s._v("vm.$set")])]),s._v(" "),e("li",[e("code",[s._v("vm.$delete")])])]),s._v(" "),e("h4",{attrs:{id:"_6-2-事件相关的方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-事件相关的方法"}},[s._v("#")]),s._v(" 6.2 事件相关的方法")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("vm.$on")])]),s._v(" "),e("li",[e("code",[s._v("vm.$emit")])]),s._v(" "),e("li",[e("code",[s._v("vm.$off")])]),s._v(" "),e("li",[e("code",[s._v("vm.$once")])])]),s._v(" "),e("h4",{attrs:{id:"_6-3-生命周期相关的方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-生命周期相关的方法"}},[s._v("#")]),s._v(" 6.3 生命周期相关的方法")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("vm.$mount")])]),s._v(" "),e("li",[e("code",[s._v("vm.$forceUpdate")])]),s._v(" "),e("li",[e("code",[s._v("vm.$nextTick")])]),s._v(" "),e("li",[e("code",[s._v("vm.$destory")])])]),s._v(" "),e("h3",{attrs:{id:"七、全局-api-篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七、全局-api-篇"}},[s._v("#")]),s._v(" 七、全局 API 篇")]),s._v(" "),e("h3",{attrs:{id:"八、过滤器篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#八、过滤器篇"}},[s._v("#")]),s._v(" 八、过滤器篇")]),s._v(" "),e("h3",{attrs:{id:"九、指令篇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#九、指令篇"}},[s._v("#")]),s._v(" 九、指令篇")]),s._v(" "),e("h3",{attrs:{id:"十、总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#十、总结"}},[s._v("#")]),s._v(" 十、总结")]),s._v(" "),e("p",[e("img",{attrs:{src:"vue-code.png",alt:"images"}})]),s._v(" "),e("h3",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/muwoo/blogs",target:"_blank",rel:"noopener noreferrer"}},[s._v("vue 源码分析"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"http://hcysun.me/vue-design/art/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue 技术内幕"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://ustbhuangyi.github.io/vue-analysis/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue.js 技术揭秘"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/answershuto/learnVue",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue.js 源码解析"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/dirkhe1051931999/hjBlog/tree/master/blog-vue-sourcecode-study",target:"_blank",rel:"noopener noreferrer"}},[s._v("你想要的 vue 源码分析"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://juejin.im/post/5ce5565d6fb9a07ed2244513",target:"_blank",rel:"noopener noreferrer"}},[s._v("学习 Vue 源码的必要知识储备"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://nlrx-wjc.github.io/Learn-Vue-Source-Code/start/",target:"_blank",rel:"noopener noreferrer"}},[s._v("逐行剖析 Vue.js 源码"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"http://hcysun.me/vue-design/zh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("渲染器"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://www.cnblogs.com/tugenhua0707/category/1577630.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("深入 Vue 技术栈及源码系列"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"http://www.zhufengpeixun.cn/train/vue-info/source.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue 原理剖析"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/lihongxun945/myblog/issues/22",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vue2.x 源码解析系列一：我的源码阅读心得"),e("OutboundLink")],1)]),s._v(" "),e("li",[s._v("《深入清出 Vue.js》")])]),s._v(" "),e("h2",{attrs:{id:"联系作者"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#联系作者"}},[s._v("#")]),s._v(" 联系作者")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("p",[s._v("\n        平凡世界，贵在坚持。\n    ")]),s._v(" "),e("img",{attrs:{src:s.$withBase("/about/contact.png")}})])])}),[],!1,null,null,null);n.default=t.exports}}]);