(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{423:function(e,s,n){"use strict";n.r(s);var a=n(13),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"虚拟-dom-解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#虚拟-dom-解析"}},[e._v("#")]),e._v(" 虚拟 DOM 解析")]),e._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),n("p",[e._v("本人平时学习及收集内容，欢迎参入一起讨论。")]),e._v(" "),n("h2",{attrs:{id:"内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内容"}},[e._v("#")]),e._v(" 内容")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E4%B8%80%E3%80%81%E8%99%9A%E6%8B%9F-DOM-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"}},[e._v("虚拟 DOM 的优缺点")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BA%8C%E3%80%81%E8%99%9A%E6%8B%9F-DOM-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"}},[e._v("虚拟 DOM 的实现原理")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%89%E3%80%81%60JS%60%E5%AF%B9%E8%B1%A1%E6%A8%A1%E6%8B%9F%60DOM%60%E6%A0%91"}},[n("code",[e._v("JS")]),e._v("对象模拟"),n("code",[e._v("DOM")]),e._v("树")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E5%9B%9B%E3%80%81diff-%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0"}},[e._v("diff 算法实现")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BA%94%E3%80%81pach-%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"}},[e._v("pach 方法实现")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E5%85%AD%E3%80%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"}},[e._v("源码分析")])])]),e._v(" "),n("h3",{attrs:{id:"一、虚拟-dom-的优缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、虚拟-dom-的优缺点"}},[e._v("#")]),e._v(" 一、虚拟 DOM 的优缺点")]),e._v(" "),n("ul",[n("li",[e._v("优点")]),e._v(" "),n("li",[e._v("缺点")])]),e._v(" "),n("h4",{attrs:{id:"优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[e._v("#")]),e._v(" 优点")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("保证性能下限")]),e._v("：框架的虚拟 DOM 需要甜酸任何上层 API 可能产生的操作，它的一些 DOM 操作的实现必须是普适的，所以它的性能并不是最优的；但是比起粗暴的 DOM 操作性能要好很多，因此框架的虚拟 DOM 至少可以保证在你不需要手动优化的情况下，依然可以提供还不错的性能，即保证性能的下限；")]),e._v(" "),n("li",[n("strong",[e._v("无需手动操作 DOM")]),e._v("：我们不再需要手动去操作 DOM，只需要写好 View-Model 的代码逻辑，框架会根据虚拟 DOM 和数据双向绑定，帮我们以可预期的方式更新视图，极大提高我们的开发效率；")]),e._v(" "),n("li",[n("strong",[e._v("跨平台")]),e._v("：虚拟 DOM 本质上是 JavaScript 对象，而 DOM 与平台强相关，相比之下虚拟 DOM 可以进行更方便地跨平台操作，例如服务器渲染、weex 开发等等。")])]),e._v(" "),n("h4",{attrs:{id:"缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[e._v("#")]),e._v(" 缺点")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("无法进行极致优化")]),e._v("：虽然虽然虚拟 DOM+合理的优化，足以应对绝大部分应用的性能需求，但在一些性能要求极高的应用中虚拟 DOM 无法进行针对性的极致优化。")])]),e._v(" "),n("h3",{attrs:{id:"二、虚拟-dom-的实现原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、虚拟-dom-的实现原理"}},[e._v("#")]),e._v(" 二、虚拟 DOM 的实现原理")]),e._v(" "),n("p",[e._v("虚拟 DOM 的实现原理主要包括以下 3 部分：")]),e._v(" "),n("ul",[n("li",[e._v("用 JavaScript 对象模拟真实 DOM 树，对真实 DOM 进行抽象；")]),e._v(" "),n("li",[e._v("diff 算法 — 比较两棵虚拟 DOM 树的差异；")]),e._v(" "),n("li",[e._v("pach 算法 — 将两个虚拟 DOM 对象的差异应用到真正的 DOM 树。")])]),e._v(" "),n("h3",{attrs:{id:"三、js对象模拟dom树"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、js对象模拟dom树"}},[e._v("#")]),e._v(" 三、"),n("code",[e._v("JS")]),e._v("对象模拟"),n("code",[e._v("DOM")]),e._v("树")]),e._v(" "),n("p",[e._v("用 JavaScript 来表示一个 DOM 节点是很简单的事情，你只需要记录它的节点类型、属性，还有子节点：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function Element(tagName,props,children){\n    if(!(this instanceof Element)){\n        if(!_.isArray(children) && children !=null){\n            children = _.slice(arguments,2).filter(_.truthy)\n        }\n        return new Element(tagName,props,children)\n    }\n\n    if(_.isArray(props)){\n        children = props\n        props = {}\n    }\n\n    this.tagName = tagName\n    this.props = props || {}\n    this.chilren = children || []\n    this.key = props ? props.key: 666\n\n    var count = 0\n\n    _.each(this.children,function(child,i){\n        if(child instanceof Element){\n            count += child.count\n        }else{\n            children[i] = '' +child\n        }\n        count++\n    })\n\n    this.count = count\n}\n\nElement.prototype.render = function(){\n    var el = document.createElement(this.tagName)\n    var props = this.props\n\n    for(var propName in props){\n        var propValue = props[propName]\n        _.setAttr(el,propName,propValue)\n    }\n\n    _.each(this.children,function(child){\n        var childEl = (child instanceof Element)?child.render():document.createTextNode(child)\n        el.appendChild(childEl)\n    })\n\n    return el\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br"),n("span",{staticClass:"line-number"},[e._v("32")]),n("br"),n("span",{staticClass:"line-number"},[e._v("33")]),n("br"),n("span",{staticClass:"line-number"},[e._v("34")]),n("br"),n("span",{staticClass:"line-number"},[e._v("35")]),n("br"),n("span",{staticClass:"line-number"},[e._v("36")]),n("br"),n("span",{staticClass:"line-number"},[e._v("37")]),n("br"),n("span",{staticClass:"line-number"},[e._v("38")]),n("br"),n("span",{staticClass:"line-number"},[e._v("39")]),n("br"),n("span",{staticClass:"line-number"},[e._v("40")]),n("br"),n("span",{staticClass:"line-number"},[e._v("41")]),n("br"),n("span",{staticClass:"line-number"},[e._v("42")]),n("br"),n("span",{staticClass:"line-number"},[e._v("43")]),n("br"),n("span",{staticClass:"line-number"},[e._v("44")]),n("br"),n("span",{staticClass:"line-number"},[e._v("45")]),n("br"),n("span",{staticClass:"line-number"},[e._v("46")]),n("br"),n("span",{staticClass:"line-number"},[e._v("47")]),n("br"),n("span",{staticClass:"line-number"},[e._v("48")]),n("br")])]),n("h3",{attrs:{id:"四、diff-算法实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、diff-算法实现"}},[e._v("#")]),e._v(" 四、diff 算法实现")]),e._v(" "),n("ul",[n("li",[e._v("深度优先遍历，记录差异")]),e._v(" "),n("li",[e._v("差异类型")]),e._v(" "),n("li",[e._v("列表对比算法")])]),e._v(" "),n("p",[n("code",[e._v("diff")]),e._v("算法用来比较两棵"),n("code",[e._v("Virtual DOM")]),e._v("树的差异，如果需要两棵树的完全比较，那么"),n("code",[e._v("diff")]),e._v("算法的时间复杂为"),n("code",[e._v("O(n^3)")]),e._v("。但是前端当中，你很少会跨越层级地移动"),n("code",[e._v("DOM")]),e._v("元素，所以"),n("code",[e._v("Virtual DOM")]),e._v("只会对同一个层级的元素进行对比，如下图所示，")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function diff(oldTree,newTree){\n    var index= 0\n    var patches = {}\n    dfsWalk(oldTree,newTree,index,patches)\n    return patches\n}\n\nfunction dfsWalk(){\n    var currentPatch = []\n    if(typeof (oldNode) === 'string' && typeof (newNode) === 'string'){\n\n    }else if(newNode!==null && oldNode.tagName === newNode.tagName){\n\n    }else if(newNode!==null){\n\n    }\n\n    if(currentPatch.length){\n        patches[index] = currentPatch\n    }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br")])]),n("h3",{attrs:{id:"_4-2-差异类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-差异类型"}},[e._v("#")]),e._v(" 4.2 差异类型")]),e._v(" "),n("p",[n("code",[e._v("DOM")]),e._v(" 操作导致的差异类型包括以下几种：")]),e._v(" "),n("ul",[n("li",[e._v("节点替换：节点改变了，例如将上面的"),n("code",[e._v("div")]),e._v("换成"),n("code",[e._v("h1")]),e._v("；")]),e._v(" "),n("li",[e._v("顺序互换：移动、删除、新增子节点，例如上面"),n("code",[e._v("div")]),e._v("的子节点，把"),n("code",[e._v("p")]),e._v("和"),n("code",[e._v("ul")]),e._v("顺序互换；")]),e._v(" "),n("li",[e._v("属性更改：修改了节点的属性，例如把上面"),n("code",[e._v("li")]),e._v("的"),n("code",[e._v("class")]),e._v("样式类删除；")]),e._v(" "),n("li",[e._v("文本改变：改变文本节点的文本内容，例如将上面"),n("code",[e._v("p")]),e._v("节点的文本内容理性为"),n("code",[e._v("Real DOM")]),e._v("；")])]),e._v(" "),n("p",[e._v("以上描述的几种差异类型在代码中定义如下所示：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("var REPLACE = 0 // 替换原先的节点\nvar REORDER = 1 // 重新排序\nvar PROPS = 2 // 修改了节点的属性\nvar TEXT = 3 // 文本内容改变\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h4",{attrs:{id:"_4-3-差异类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-差异类型"}},[e._v("#")]),e._v(" 4.3 差异类型")]),e._v(" "),n("h3",{attrs:{id:"五、pach-方法实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、pach-方法实现"}},[e._v("#")]),e._v(" 五、pach 方法实现")]),e._v(" "),n("ul",[n("li",[e._v("深度优先遍历"),n("code",[e._v("DOM")]),e._v("树")]),e._v(" "),n("li",[e._v("对原有"),n("code",[e._v("DOM")]),e._v("树进行"),n("code",[e._v("DOM")]),e._v("操作")]),e._v(" "),n("li",[e._v("DOM 结构改变")])]),e._v(" "),n("h4",{attrs:{id:"_5-1-深度优先遍历-dom-树"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-深度优先遍历-dom-树"}},[e._v("#")]),e._v(" 5.1 深度优先遍历 DOM 树")]),e._v(" "),n("p",[e._v("所构建的"),n("code",[e._v("JavaScript")]),e._v("对象树和"),n("code",[e._v("render")]),e._v("出来真正的"),n("code",[e._v("DOM")]),e._v("树的信息、结构是一样的。所以我们可以对那棵"),n("code",[e._v("DOM")]),e._v("树也进行深度优先的遍历，遍历的时候从上一个步骤生成的"),n("code",[e._v("patches")]),e._v("对象中找出当前遍历的节点差异")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function patch(node,patches){\n    var walker = {index: 0}\n    dfsWalk(node,walker,patches)\n}\n\nfunction dfsWalk(node,walker,patches){\n    // 从patches拿出当前节点的差异\n    var currentPatches = patches[walker.index]\n\n    var len = node.childNodes ? node.childNodes.length:0\n\n    // 深度遍历子节点\n    for(var i = 0; i< len;i++){\n        var child = node.childNodes[i]\n        walker.index++\n        dfsWalk(child,walker,patches)\n    }\n    // 对当前节点进行DOM操作\n    if(currentPatches){\n        applyPatches(node,currentPatches)\n    }\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br")])]),n("h4",{attrs:{id:"_5-2-对原有-dom-树进行-dom-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-对原有-dom-树进行-dom-操作"}},[e._v("#")]),e._v(" 5.2 对原有 DOM 树进行 DOM 操作")]),e._v(" "),n("p",[e._v("applyPathes,根据不同类型的差异对当前节点进行 DOM 操作：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function applyPatches (node, currentPatches) {\n  currentPatches.forEach(function (currentPatch) {\n    switch (currentPatch.type) {\n      case REPLACE:\n        node.parentNode.replaceChild(currentPatch.node.render(), node)\n        break\n      case REORDER:\n        reorderChildren(node, currentPatch.moves)\n        break\n      case PROPS:\n        setProps(node, currentPatch.props)\n        break\n      case TEXT:\n        node.textContent = currentPatch.content\n        break\n      default:\n        throw new Error('Unknown patch type ' + currentPatch.type)\n    }\n  })\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br")])]),n("h4",{attrs:{id:"_5-3-dom-结构改变"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-dom-结构改变"}},[e._v("#")]),e._v(" 5.3 DOM 结构改变")]),e._v(" "),n("p",[e._v("通过将上一步骤得到的两个"),n("code",[e._v("DOM")]),e._v("对象之间的差异，应用到第一个（原先）"),n("code",[e._v("DOM")]),e._v("结构中，我们看到"),n("code",[e._v("DOM")]),e._v("结构进行了预期的变化，如下图所示：")]),e._v(" "),n("h3",{attrs:{id:"六、源码分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、源码分析"}},[e._v("#")]),e._v(" 六、源码分析")]),e._v(" "),n("h4",{attrs:{id:"_6-1-vmode模拟dom树"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-vmode模拟dom树"}},[e._v("#")]),e._v(" 6.1 "),n("code",[e._v("VMode")]),e._v("模拟"),n("code",[e._v("DOM")]),e._v("树")]),e._v(" "),n("p",[e._v("在"),n("code",[e._v("Vue.js")]),e._v("中，"),n("code",[e._v("Virtual DOM")]),e._v("是用"),n("code",[e._v("VNode")]),e._v("这个"),n("code",[e._v("Class")]),e._v("去描述，它定义在"),n("code",[e._v("src/core/vdom/vnode.js")]),e._v("中，从以下代码块中可以看到"),n("code",[e._v("Vue.js")]),e._v("中的"),n("code",[e._v("Virtual DOM")]),e._v("的定义较为复杂一些，因为它这里包含了很多"),n("code",[e._v("Vue.js")]),e._v("的特性。实际上"),n("code",[e._v("Vue.js")]),e._v("中"),n("code",[e._v("Virtual DOM")]),e._v("是借鉴了一个开源库"),n("a",{attrs:{href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"}},[e._v("snabbdom"),n("OutboundLink")],1),e._v("的实现，然后加入了一些"),n("code",[e._v("Vue.js")]),e._v("的一些特性。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("这里有几个核心的属性")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("tag")]),e._v("属性即这个"),n("code",[e._v("vnode")]),e._v("的标签属性")]),e._v(" "),n("li",[n("code",[e._v("data")]),e._v("属性包含了最后渲染成真实"),n("code",[e._v("dom")]),e._v("节点后，节点上的"),n("code",[e._v("class")]),e._v("，"),n("code",[e._v("attribute")]),e._v("，"),n("code",[e._v("style")]),e._v("以及绑定的事件")])]),e._v(" "),n("p",[n("strong",[e._v("源码创建 VNode 过程")])]),e._v(" "),n("p",[e._v("我们在实例化一个"),n("code",[e._v("vue")]),e._v("实例，也即"),n("code",[e._v("new Vue()")]),e._v("时，实际上是执行"),n("code",[e._v("src/core/instance/index.js")]),e._v("中定义的"),n("code",[e._v("Function")]),e._v("函数。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("function Vue(options){\n    if(process.env.NODE_ENV !=='production' && !(this instanceof Vue)){\n         warn('Vue is a constructor and should be called with the `new` keyword')\n    }\n    this._init(options)\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("通过查看"),n("code",[e._v("Vue")]),e._v("的"),n("code",[e._v("function")]),e._v("，我们知道"),n("code",[e._v("Vue")]),e._v("只能通过"),n("code",[e._v("new")]),e._v("关键字初始化，然后调用"),n("code",[e._v("this._init")]),e._v("方法，该方法在"),n("code",[e._v("src/core/instance/init.js")]),e._v("中定义。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[n("strong",[e._v("Vue 实例挂载")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const mount = Vue.prototype.$mount\nVue.prototype.$mount = function(el,hydrating){\n    el = el && query(el)\n    // 省略一系列初始化以及逻辑判断代码\n    return mount.call(this, el, hydrating)\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[n("strong",[e._v("创建虚拟 Node")])]),e._v(" "),n("p",[n("code",[e._v("Vue")]),e._v("的"),n("code",[e._v("_render")]),e._v("方法是实例的一个私有方法，它用来把实例")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Vue.prototype._rendre = function(){\n\n}\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("h4",{attrs:{id:"_6-2-diff-过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-diff-过程"}},[e._v("#")]),e._v(" 6.2 diff 过程")]),e._v(" "),n("p",[n("code",[e._v("Vue.js")]),e._v("源码实例化了一个"),n("code",[e._v("watcher")]),e._v("，这个~被添加到了在模板当中所绑定变量的依赖当中，一旦"),n("code",[e._v("model")]),e._v("中的响应式的数据发生了变化，这些响应式的数据所的"),n("code",[e._v("dep")]),e._v("数组便会调用"),n("code",[e._v("dep.notify()")]),e._v("方法完成所有依赖遍历执行的工作，")]),e._v(" "),n("p",[n("code",[e._v("diff")]),e._v("过程中分了好几种情况，"),n("code",[e._v("oldCh")]),e._v("为"),n("code",[e._v("oldVnode")]),e._v("的子节点，"),n("code",[e._v("ch")]),e._v("为"),n("code",[e._v("Vnode")]),e._v("的子节点：")]),e._v(" "),n("ul",[n("li",[e._v("首先进行文本节点的判断，若")]),e._v(" "),n("li",[e._v("在"),n("code",[e._v("vnode")]),e._v("没有文本节点的情况下，进入子节点的"),n("code",[e._v("diff")]),e._v("；")])]),e._v(" "),n("p",[n("strong",[e._v("子节点"),n("code",[e._v("diff")]),e._v("流程分析")])]),e._v(" "),n("h4",{attrs:{id:"_6-3-patch-过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-patch-过程"}},[e._v("#")]),e._v(" 6.3 patch 过程")]),e._v(" "),n("h3",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[e._v("#")]),e._v(" 参考资料")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/livoras/blog/issues/13",target:"_blank",rel:"noopener noreferrer"}},[e._v("如何实现一个 Virtual DOM 算法"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/EeN7E8uQS4R_JJloPX8fCQ",target:"_blank",rel:"noopener noreferrer"}},[e._v("揭秘 Vue 中的 Virtual Dom"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/oAlVmZ4Hbt2VhOwFEkNEhw",target:"_blank",rel:"noopener noreferrer"}},[e._v("虚拟 DOM 到底是什么？"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5d36cc575188257aea108a74",target:"_blank",rel:"noopener noreferrer"}},[e._v("深入剖析：Vue 核心之虚拟 DOM"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://www.404forest.com/2019/03/07/modern-web-development-tech-analysis-virtual-dom/",target:"_blank",rel:"noopener noreferrer"}},[e._v("现代前端科技解析 —— Virtual DOM #"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/aooy/blog/issues/2",target:"_blank",rel:"noopener noreferrer"}},[e._v("Diff 算法"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/9nB2bfDczNFRpUTiBwup8Q",target:"_blank",rel:"noopener noreferrer"}},[e._v("Virtual Dom 和 Diff 算法"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/81752104",target:"_blank",rel:"noopener noreferrer"}},[e._v("【Vue 原理】Diff - 白话版"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/29450092",target:"_blank",rel:"noopener noreferrer"}},[e._v("VirtualDOM 与 diff(Vue 实现)"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5c8e5e4951882545c109ae9c",target:"_blank",rel:"noopener noreferrer"}},[e._v("让虚拟 DOM 和 DOM-diff 不再成为你的绊脚石"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5e53c9c051882549150ea5d3",target:"_blank",rel:"noopener noreferrer"}},[e._v("虚拟 Dom+Diff--Vue 源码动手写系列"),n("OutboundLink")],1)])]),e._v(" "),n("h2",{attrs:{id:"联系作者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#联系作者"}},[e._v("#")]),e._v(" 联系作者")]),e._v(" "),n("div",{attrs:{align:"center"}},[n("p",[e._v("\n        平凡世界，贵在坚持。\n    ")]),e._v(" "),n("img",{attrs:{src:e.$withBase("/about/contact.png")}})])])}),[],!1,null,null,null);s.default=t.exports}}]);