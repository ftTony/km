(window.webpackJsonp=window.webpackJsonp||[]).push([[268],{491:function(s,e,n){"use strict";n.r(e);var a=n(13),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx-常用配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-常用配置"}},[s._v("#")]),s._v(" nginx 常用配置")]),s._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("p",[s._v("本人平时学习及收集内容，欢迎参入一起讨论。")]),s._v(" "),n("h2",{attrs:{id:"内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内容"}},[s._v("#")]),s._v(" 内容")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E4%B8%80%E3%80%81Ngnix%E4%BB%8B%E7%BB%8D"}},[s._v("Ngnix 介绍")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85"}},[s._v("安装")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%89%E3%80%81Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"}},[s._v("Nginx 基本配置与参数说明")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%9B%9B%E3%80%81Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"}},[s._v("Nginx 负载均衡")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BA%94%E3%80%81Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"}},[s._v("Nginx 反向代理")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AEGzip"}},[s._v("配置 Gzip")])])]),s._v(" "),n("h3",{attrs:{id:"一、ngnix-介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、ngnix-介绍"}},[s._v("#")]),s._v(" 一、Ngnix 介绍")]),s._v(" "),n("p",[s._v("Nginx 是一款轻量级的网页服务器、反向代理器以及电子邮件代理服务器。其将源代码以类 BSD 许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名。类似的 web 服务器有 Apache、IIS。")]),s._v(" "),n("h3",{attrs:{id:"二、安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、安装"}},[s._v("#")]),s._v(" 二、安装")]),s._v(" "),n("h3",{attrs:{id:"_2-1-安装依赖包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装依赖包"}},[s._v("#")]),s._v(" 2.1 安装依赖包")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("//一键安装上面四个依赖\nyum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"_2-2-下载并解压安装包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-下载并解压安装包"}},[s._v("#")]),s._v(" 2.2 下载并解压安装包")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n//创建一个文件夹\ncd /usr/local\nmkdir nginx\ncd nginx\n//下载tar包\nwget http://nginx.org/download/nginx-1.13.7.tar.gz\ntar -xvf nginx-1.13.7.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"_2-3-安装-nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装-nginx"}},[s._v("#")]),s._v(" 2.3 安装 nginx")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("//进入nginx目录\ncd /usr/local/nginx\n//执行命令\n./configure\n//执行make命令\nmake\n//执行make install命令\nmake install\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"_2-4-启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-启动"}},[s._v("#")]),s._v(" 2.4 启动")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/usr/local/nginx/sbin/nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看 nginx 进程是否启动：")]),s._v(" "),n("p",[n("code",[s._v("ps -ef | grep nginx")])]),s._v(" "),n("h4",{attrs:{id:"_2-5-关闭防火墙"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-关闭防火墙"}},[s._v("#")]),s._v(" 2.5 关闭防火墙")]),s._v(" "),n("ul",[n("li",[s._v("centOS6 及以前版本使用命令： "),n("code",[s._v("systemctl stop iptables.service")])]),s._v(" "),n("li",[s._v("centOS7 关闭防火墙命令： "),n("code",[s._v("systemctl stop firewalld.service")])])]),s._v(" "),n("h4",{attrs:{id:"_2-6-启动，关闭，重启，命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-启动，关闭，重启，命令"}},[s._v("#")]),s._v(" 2.6 启动，关闭，重启，命令")]),s._v(" "),n("p",[s._v("进入安装目录中，命令："),n("code",[s._v("cd /usr/local/nginx/sbin")]),s._v("，"),n("code",[s._v("./nginx")]),s._v(" 启动，"),n("code",[s._v("./nginx -s stop")]),s._v(" 关闭，"),n("code",[s._v("./nginx -s reload")]),s._v("重启。")]),s._v(" "),n("h3",{attrs:{id:"三、nginx-基本配置与参数说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、nginx-基本配置与参数说明"}},[s._v("#")]),s._v(" 三、Nginx 基本配置与参数说明")]),s._v(" "),n("p",[s._v("nginx 配置文件主要分为六个区域：main(全局设置)、events(nginx 工作模式)、http(http 设置)、server(主机设置)、location(URL 匹配)、upstream(负载均衡器设置)。")]),s._v(" "),n("h4",{attrs:{id:"_3-1-main-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-main-模块"}},[s._v("#")]),s._v(" 3.1 main 模块")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("user nobody nobody;\nworker_processes 2;\nerror_log /usr/local/var/log/nginx/error.log  notice;\npid        /usr/local/var/run/nginx/nginx.pid;\nworker_rlimit_nofile 1024;\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("user")]),s._v("：来指定 Nginx Worker 进程运行用户以及用户组，默认同 nobody 账号运行。")]),s._v(" "),n("li",[n("code",[s._v("worker_processes")]),s._v("：来指定了 Nginx 要开启的子进程数。每个 Nginx 进程平均耗费 10M~12M 内存。根据经验，一般指定 1 个进程就足够了，如果是多核 CPU，建议指定和 CPU 的数量一样的进程数即可。我这里写 2，那么就会开启 2 个子进程，总共 3 个进程。")]),s._v(" "),n("li",[n("code",[s._v("error_log")]),s._v("：用来定义全局错误日志文件。日志输出级别有 debug、info、notice、warn、error、crit 可供选择，其中，debug 输出日志最为最详细，而 crit 输出日志最少。")]),s._v(" "),n("li",[n("code",[s._v("pid")]),s._v("：用来指定进程 id 的存储文件位置。")]),s._v(" "),n("li",[n("code",[s._v("worker_rlimit_nofile")]),s._v("：用于指定一个 nginx 进程可以打开的最多文件描述符数目，这里是 65535，需要使用命令“ulimit -n 65535”来设置。")])]),s._v(" "),n("h4",{attrs:{id:"_3-2-events-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-events-模块"}},[s._v("#")]),s._v(" 3.2 events 模块")]),s._v(" "),n("p",[s._v("events 模块来用指定 nginx 的工作模式和工作模式及连接数上限，一般是这样：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("events {\n    use kqueue; #mac平台\n    worker_connections  1024;\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("use")]),s._v("：用来指定 Nginx 的工作模式。Nginx 支持的工作模式有 select、poll、kqueue、epoll、rtsig 和/dev/poll。其中 select 和 poll 都是标准的工作模式，kqueue 和 epoll 是高效的工作模式，不同的是 epoll 用在 Linux 平台上，而 kqueue 用在 BSD 系统中，因为 Mac 基于 BSD,所以 Mac 也得用这个模式，对于 Linux 系统，epoll 工作模式是首选。")]),s._v(" "),n("li",[n("code",[s._v("worker_connections")]),s._v("：用于定义"),n("code",[s._v("Nginx")]),s._v("每个进程的最大连接数，即接收前端的最大请求数，默认是"),n("code",[s._v("1024")]),s._v("。最大客户端连接数由"),n("code",[s._v("worker_processes")]),s._v("和"),n("code",[s._v("worker_connections")]),s._v("决定，即"),n("code",[s._v("Max_clients=worker_processes*worker_connections")]),s._v("，在作为反向代理时，"),n("code",[s._v("Max_clients")]),s._v("变为："),n("code",[s._v("Max_clients = worker_processes * worker_connections/4")]),s._v("。进程的最大连接数受 Linux 系统进程的最大打开文件数限制，在执行操作系统命令“ulimit -n 65536”后"),n("code",[s._v("worker_connections")]),s._v("的设置才能生效。")])]),s._v(" "),n("h4",{attrs:{id:"_3-3-http-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-http-模块"}},[s._v("#")]),s._v(" 3.3 http 模块")]),s._v(" "),n("p",[s._v("http 模块可以说是最核心的模块了，它负责 HTTP 服务器相关属性的配置，它里面的 server 和 upstream 子模块，至关重要。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('http{\n    include       mime.types;\n    default_type  application/octet-stream;\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request"\n    \'$status $body_bytes_sent "$http_referer" \'\n    \'"$http_user_agent" "$http_x_forwarded_for"\';\n    access_log  /usr/local/var/log/nginx/access.log  main;\n    sendfile        on;\n    tcp_nopush      on;\n    tcp_nodelay     on;\n    keepalive_timeout  10;\n    #gzip  on;\n    upstream myproject {\n        .....\n    }\n    server {\n        ....\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("下面详细介绍下这段代码中每个配置选项的含义。")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("include")]),s._v("：来用设定文件的"),n("code",[s._v("mime")]),s._v("类型,类型在配置文件目录下的"),n("code",[s._v("mime.type")]),s._v("文件定义，来告诉"),n("code",[s._v("nginx")]),s._v("来识别文件类型。")]),s._v(" "),n("li",[n("code",[s._v("default_type")]),s._v("：设定了默认的类型为二进制流，也就是当文件类型未定义时使用这种方式，例如在没有配置"),n("code",[s._v("asp")]),s._v("的"),n("code",[s._v("locate")]),s._v("环境时，Nginx 是不予解析的，此时，用浏览器访问 asp 文件就会出现下载了。")]),s._v(" "),n("li",[n("code",[s._v("log_format")]),s._v("：用于设置日志的格式，和记录哪些参数，这里设置为"),n("code",[s._v("main")]),s._v("，刚好用于"),n("code",[s._v("access_log")]),s._v("来纪录这种类型。")]),s._v(" "),n("li",[n("code",[s._v("access_log")]),s._v("：用来纪录每次的访问日志的文件地址，后面的"),n("code",[s._v("main")]),s._v("是日志的格式样式，对应于"),n("code",[s._v("log_format")]),s._v("的"),n("code",[s._v("main")]),s._v("。")]),s._v(" "),n("li",[n("code",[s._v("sendfile")]),s._v("：参数用于开启高效文件传输模式。将"),n("code",[s._v("tcp_nopush")]),s._v("和"),n("code",[s._v("tcp_nodelay")]),s._v("两个指令设置为"),n("code",[s._v("on")]),s._v("用于防止网络阻塞。")]),s._v(" "),n("li",[n("code",[s._v("keepalive_timeout")]),s._v("：设置客户端连接保持活动的超时时间。在超过这个时间之后，服务器会关闭该连接。")])]),s._v(" "),n("h4",{attrs:{id:"_3-4-server-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-server-模块"}},[s._v("#")]),s._v(" 3.4 server 模块")]),s._v(" "),n("p",[n("code",[s._v("sever")]),s._v("模块是"),n("code",[s._v("http")]),s._v("的子模块，它用来定一个虚拟主机，我们先讲最基本的配置，这些在后面再讲。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n        listen       8080;\n        server_name  localhost 192.168.12.10 www.yangyi.com;\n        # 全局定义，如果都是这一个目录，这样定义最简单。\n        root   /Users/yangyi/www;\n        index  index.php index.html index.htm;\n        charset utf-8;\n        access_log  usr/local/var/log/host.access.log  main;\n        aerror_log  usr/local/var/log/host.error.log  error;\n        ....\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("server")]),s._v("：标志定义虚拟主机开始。")]),s._v(" "),n("li",[n("code",[s._v("listen")]),s._v("：用于指定虚拟主机的服务端口。")]),s._v(" "),n("li",[n("code",[s._v("server_name")]),s._v("：用来指定 IP 地址或者域名，多个域名之间用空格分开。")]),s._v(" "),n("li",[n("code",[s._v("root")]),s._v("：表示在这整个"),n("code",[s._v("server")]),s._v("虚拟主机内，全部的"),n("code",[s._v("root web")]),s._v("根目录。注意要和"),n("code",[s._v("locate {}")]),s._v("下面定义的区分开来。")]),s._v(" "),n("li",[n("code",[s._v("index")]),s._v("：全局定义访问的默认首页地址。注意要和"),n("code",[s._v("locate {}")]),s._v("下面定义的区分开来。")]),s._v(" "),n("li",[n("code",[s._v("charset")]),s._v("：用于设置网页的默认编码格式。")]),s._v(" "),n("li",[n("code",[s._v("access_log")]),s._v("：用来指定此虚拟主机的访问日志存放路径，最后的"),n("code",[s._v("main")]),s._v("用于指定访问日志的输出格式。")])]),s._v(" "),n("h4",{attrs:{id:"_3-5-location-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-location-模块"}},[s._v("#")]),s._v(" 3.5 location 模块")]),s._v(" "),n("p",[n("code",[s._v("location")]),s._v("模块是 nginx 中用的最多的，也是最重要的模块了，什么负载均衡啊、反向代理啊、虚拟域名啊都与它相关;location 根据它字面意思就知道是来定位的，定位 URL，解析 URL，所以，它也提供了强大的正则匹配功能，也支持条件判断匹配，用户可以通过 location 指令实现 Nginx 对动、静态网页进行过滤处理。像我们的 php 环境搭建就是用到了它。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location / {\n    root   /Users/yangyi/www;\n    index  index.php index.html index.htm;\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("location")]),s._v("： "),n("code",[s._v("/")]),s._v("表示匹配访问根目录。")]),s._v(" "),n("li",[n("code",[s._v("root")]),s._v("：指令用于指定访问根目录时，虚拟主机的 web 目录，这个目录可以是相对路径（相对路径是相对于 nginx 的安装目录）。也可以是绝对路径。")]),s._v(" "),n("li",[n("code",[s._v("index")]),s._v("：用于设定我们只输入域名后访问的默认首页地址，有个先后顺序：index.php index.html index.htm，如果没有开启目录浏览权限，又找不到这些默认首页，就会报 403 错误。")]),s._v(" "),n("li",[n("code",[s._v("location")]),s._v("：还有一种方式就是正则匹配，开启正则匹配这样：location ~。后面加个~。")])]),s._v(" "),n("p",[s._v("下面这个例子是运用正则匹配来链接 php。我们之前搭建环境也是这样做：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location ~ \\.php$ {\n    root           /Users/yangyi/www;\n    fastcgi_pass   127.0.0.1:9000;\n    fastcgi_index  index.php;\n    include        fastcgi.conf;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("code",[s._v("\\.php$")]),s._v("熟悉正则的我们直到，这是匹配.php 结尾的 URL，用来解析 php 文件。里面的 root 也是一样，用来表示虚拟主机的根目录。\nfast_pass 链接的是 php-fpm 的地址，之前我们也搭建过。")]),s._v(" "),n("h3",{attrs:{id:"四、nginx-负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、nginx-负载均衡"}},[s._v("#")]),s._v(" 四、Nginx 负载均衡")]),s._v(" "),n("ul",[n("li",[s._v("轮询（默认），请求过来后，Nginx 随机分配流量到任一服务器")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream backend {\n    server 127.0.0.1:3000;\n    server 127.0.0.1:3001;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("weight=number")]),s._v("设置服务器的权重，默认为 1，权重大的会被优先分配")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream backend {\n    server 127.0.0.1:3000 weight=2;\n    server 127.0.0.1:3001 weight=1;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("backup")]),s._v(" 标记为备份服务器。当主服务器不可用时，将传递与备份服务器的连接。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream backend {\n    server 127.0.0.1:3000 backup;\n    server 127.0.0.1:3001;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("ip_hash")]),s._v(" 保持会话，保证同一客户端始终访问一台服务器。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream backend {\n    ip_hash;\n    server 127.0.0.1:3000 backup;\n    server 127.0.0.1:3001;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("least_conn")]),s._v(" 优先分配最少连接数的服务器，避免服务器超载请求过多。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream backend {\n    least_conn;\n    server 127.0.0.1:3000;\n    server 127.0.0.1:3001;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"五、nginx-反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、nginx-反向代理"}},[s._v("#")]),s._v(" 五、Nginx 反向代理")]),s._v(" "),n("ul",[n("li",[s._v("什么是反向代理")]),s._v(" "),n("li",[s._v("反射代理的作用")]),s._v(" "),n("li",[s._v("反射代理配置")])]),s._v(" "),n("h4",{attrs:{id:"_5-1-什么是反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-什么是反向代理"}},[s._v("#")]),s._v(" 5.1 什么是反向代理")]),s._v(" "),n("p",[s._v("反向代理是指以代理服务器来接受 internet 上的连接请求，然后奖请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就是表现为一个服务器.")]),s._v(" "),n("p",[s._v("代理情况："),n("code",[s._v("client —(send request)—> clinet proxy –(send request)—> server")])]),s._v(" "),n("h4",{attrs:{id:"_5-2-反射代理的作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-反射代理的作用"}},[s._v("#")]),s._v(" 5.2 反射代理的作用")]),s._v(" "),n("p",[s._v("保护网站安全：任何来自 internet 的请求都必须先经过代理器；\n通过配置缓存功能加速 web 请求：可以缓存真实 web 服务器上的某些静态资源，减轻真实 web 服务器的负载压力；")]),s._v(" "),n("p",[s._v("实现负载均衡：充当负载均衡服务器均衡分发请求，平衡集群中各个服务器的负载压力。")]),s._v(" "),n("h4",{attrs:{id:"_5-3-反向代理配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-反向代理配置"}},[s._v("#")]),s._v(" 5.3 反向代理配置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location /api {\n    # 请求host传给后端\n    proxy_set_header Host $http_host;\n    # 请求ip 传给后端\n    proxy_set_header X-Real-IP $remote_addr;\n    # 请求协议传给后端\n    proxy_set_header X-Scheme $scheme;\n    # 路径重写\n    rewrite  /api/(.*)  /$1  break;\n    # 代理服务器\n    proxy_pass http://localhost:9000;\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("拦截路径"),n("code",[s._v("/api")]),s._v(", 可以通过正则匹配。")]),s._v(" "),n("li",[n("code",[s._v("proxy_set_header")]),s._v("允许重新定义或添加字段传递给代理服务器的请求头。")]),s._v(" "),n("li",[n("code",[s._v("$http_host")]),s._v("、"),n("code",[s._v("$remote_addr")]),s._v("、"),n("code",[s._v("$scheme")]),s._v(" 为 Nginx 内置变量。")]),s._v(" "),n("li",[n("code",[s._v("rewrite")]),s._v("根据"),n("code",[s._v("rewrite")]),s._v("后的请求"),n("code",[s._v("URI")]),s._v("，将路径重写，如：接口路径为"),n("code",[s._v("/user")]),s._v(", 我们可以请求"),n("code",[s._v("/api/user")]),s._v("。（为什么需要重写 uri？因为在使用 Nginx 做反向代理的时候，需要匹配到跨域的接口再做转发，为了方便匹配，会人为的在原接口中添加一段路径（或标示， 如例子中的 api），因此需要在匹配之后、转发之前把添加的那段去掉，因此需要 rewrite。）")]),s._v(" "),n("li",[n("code",[s._v("break")]),s._v("继续本次请求后面的处理 ,停止匹配下面的 location。需要注意的是与之类似的 last 执行过程则是停止当前这个请求，并根据 rewrite 匹配的规则重新发起一个请求，从上到下依次匹配 location 后面的规则。")]),s._v(" "),n("li",[n("code",[s._v("proxy_pass")]),s._v("代理服务器。")])]),s._v(" "),n("h3",{attrs:{id:"六、配置-gzip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、配置-gzip"}},[s._v("#")]),s._v(" 六、配置 Gzip")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    # 开启gzip 压缩\n    gzip on;\n    # 设置gzip所需的http协议最低版本 （HTTP/1.1, HTTP/1.0）\n    gzip_http_version 1.1;\n    # 设置压缩级别，压缩级别越高压缩时间越长  （1-9）\n    gzip_comp_level 4;\n    # 设置压缩的最小字节数， 页面Content-Length获取\n    gzip_min_length 1000;\n    # 设置压缩文件的类型  （text/html)\n    gzip_types text/plain application/javascript text/css;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://www.nginx.cn/76.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx 基本配置与参数说明"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://manual.51yip.com/nginx/StandardHTTPModules/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx 标准 HTTP 模块"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5a2600bdf265da432b4aaaba",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx 从入门到实践"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5cae9de95188251ae2324ec3",target:"_blank",rel:"noopener noreferrer"}},[s._v("前端想要了解的 Nginx"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/knowledgesea/p/5175711.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx 配置详解"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/knowledgesea/p/5199046.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx 代理功能与负载均衡详解"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"联系作者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#联系作者"}},[s._v("#")]),s._v(" 联系作者")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("p",[s._v("\n        平凡世界，贵在坚持。\n    ")]),s._v(" "),n("img",{attrs:{src:s.$withBase("/about/contact.png")}})])])}),[],!1,null,null,null);e.default=t.exports}}]);