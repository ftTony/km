(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{391:function(s,e,n){"use strict";n.r(e);var a=n(13),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"promise-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#promise-对象"}},[s._v("#")]),s._v(" Promise 对象")]),s._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("p",[s._v("在异步编程中，Promise 扮演了举足轻重的角色，它解决了 ajax 请求过程中的回调地狱的问题，令代码更具可读性。")]),s._v(" "),n("p",[n("code",[s._v("Promise")]),s._v("对象有以下两处特点：")]),s._v(" "),n("ul",[n("li",[s._v("对象的状态不受外界影响。"),n("code",[s._v("Promise")]),s._v("对象代表一个异步操作，有三种状态："),n("code",[s._v("pending")]),s._v("（进行中）、"),n("code",[s._v("fulfilled")]),s._v("（已成功）和"),n("code",[s._v("rejected")]),s._v("（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是"),n("code",[s._v("Promise")]),s._v("这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。")]),s._v(" "),n("li",[s._v("一旦状态改变，就不会再变，任何时候都可以得到这个结果。"),n("code",[s._v("Promise")]),s._v("对象的状态改变，只有两种可能：从"),n("code",[s._v("pending")]),s._v("变为"),n("code",[s._v("fulfilled")]),s._v("和从"),n("code",[s._v("pending")]),s._v("变为"),n("code",[s._v("rejected")]),s._v("。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果，这时就称为 resolved（已定型）。如果改变已经发生了，你再对"),n("code",[s._v("Promise")]),s._v("对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错误了它，再去监听，是得不到结果的。")])]),s._v(" "),n("h2",{attrs:{id:"内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内容"}},[s._v("#")]),s._v(" 内容")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E4%B8%80%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"}},[s._v("基本用法")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BA%8Cthen"}},[s._v("then()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%89catch"}},[s._v("catch()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%9B%9Bfinally"}},[s._v("finally()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BA%94all"}},[s._v("all()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%85%ADace"}},[s._v("ace()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B8%83resolve"}},[s._v("resolve()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%85%ABreject"}},[s._v("reject()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E4%B9%9Dtry"}},[s._v("try()")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%8D%81%E4%B8%80%E5%BA%94%E7%94%A8"}},[s._v("应用")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%8D%81%E4%B8%80%E9%94%99%E8%AF%AF%E7%94%A8%E6%B3%95%E5%8F%8A%E8%AF%AF%E5%8C%BA"}},[s._v("错误用法及误区")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%8D%81%E4%BA%8Cpromise-%E4%BD%A0%E5%8F%AF%E8%83%BD%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84-6-%E4%BB%B6%E4%BA%8B"}},[s._v("promise 你可能不知道的 6 件事")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#%E5%8D%81%E4%B8%89%E6%89%8B%E5%86%99-promise"}},[s._v("手写 Promise")])]),s._v(" "),n("li",[n("a",{attrs:{href:"##%E5%8D%81%E5%9B%9Bpromise-%E5%87%A0%E9%81%93%E9%9D%A2%E8%AF%95%E9%A2%98"}},[s._v("Promise 几道面试题")])])]),s._v(" "),n("h3",{attrs:{id:"一、基本用法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、基本用法"}},[s._v("#")]),s._v(" 一、基本用法")]),s._v(" "),n("p",[s._v("ES6 规定，"),n("code",[s._v("Promise")]),s._v("对象是一个构造函数，用来生成"),n("code",[s._v("Promise")]),s._v("实例。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise(function(resolve,reject){\n\n    if(/* 异步操作成功*/){\n        resolve(value);\n    }else{\n        reject(error);\n    }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("code",[s._v("Promise")]),s._v(" 构造函数接受一个函数作为参数，该函数的两个参数分别是 "),n("code",[s._v("resolve")]),s._v(" 和 "),n("code",[s._v("reject")]),s._v("。")]),s._v(" "),n("p",[n("code",[s._v("resolve")]),s._v("函数的作用是，将"),n("code",[s._v("Promise")]),s._v("对象的状态从“未完成”变成“成功”（即从 pending 变成 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去；")]),s._v(" "),n("p",[n("code",[s._v("reject")]),s._v("函数的作用是，将"),n("code",[s._v("Promse")]),s._v("对象的状态从“未完成”变为“失败”（即从 pending 变为 rejected），在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。")]),s._v(" "),n("h3",{attrs:{id:"二、then"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、then"}},[s._v("#")]),s._v(" 二、then()")]),s._v(" "),n("p",[n("code",[s._v("then")]),s._v("方法是定义在原型对象"),n("code",[s._v("Promise.prototype")]),s._v("上的。"),n("code",[s._v("then")]),s._v("方法可以接受两个回调函数作为参数。第一个回调函数是"),n("code",[s._v("Promise")]),s._v("对象的状态变为"),n("code",[s._v("resolved")]),s._v("时调用。其中，第二个函数是可选的，不一定要提供。"),n("code",[s._v("then")]),s._v("方法返回的是一个新"),n("code",[s._v("Promise")]),s._v("实例。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('getJSON("/post/1.json")\n.then(post=>getJSON(post.commentURL))\n.then(\n    comments=>console.log("resolved:",comments),\n    err=>console.log("rejected:",err)\n);\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"三、catch"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、catch"}},[s._v("#")]),s._v(" 三、catch()")]),s._v(" "),n("p",[n("code",[s._v("Promise.prototype.catch")]),s._v("方法是"),n("code",[s._v(".then(null, rejection)")]),s._v("的别名，用于指定发生错误时的回调函数。")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#31-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"}},[s._v("基本用法")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#32-promise-%E7%9A%84%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E6%96%B9%E5%BC%8F"}},[s._v("Promise 的异常捕获方式")])])]),s._v(" "),n("h4",{attrs:{id:"_3-1-基本用法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-基本用法"}},[s._v("#")]),s._v(" 3.1 基本用法")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("getJSON('/posts.json').then(function(posts) {\n  // ...\n}).catch(function(error) {\n  // 处理 getJSON 和 前一个回调函数运行时发生的错误\n  console.log('发生错误！', error);\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("上面代码中，"),n("code",[s._v("getJSON")]),s._v("方法返回一个"),n("code",[s._v("Promise")]),s._v("对象，如果该对象状态变为"),n("code",[s._v("resolved")]),s._v("，则会调用"),n("code",[s._v("then")]),s._v("方法指定的回调函数；如果异步操作抛出错误，状态就会变为"),n("code",[s._v("rejected")]),s._v("，就会调用"),n("code",[s._v("catch")]),s._v("方法指定的回调函数，处理这个错误。另外，"),n("code",[s._v("then")]),s._v("方法指定的回调函数，如果运行中抛出错误，也会被"),n("code",[s._v("catch")]),s._v("方法捕获。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var promise = new Promise(function(resolve, reject) {\n  resolve('ok');\n  throw new Error('test');\n});\npromise\n  .then(function(value) { console.log(value) })\n  .catch(function(error) { console.log(error) });\n// ok\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("上面代码中，"),n("code",[s._v("Promise")]),s._v("在"),n("code",[s._v("resolve")]),s._v("语句后面，再抛出错误，不会被捕获，等于没有抛出。因为 "),n("code",[s._v("Promise")]),s._v("的状态一旦改变，就永久保持该状态，不会再变了。")]),s._v(" "),n("h4",{attrs:{id:"_3-2-promise-的异常捕获方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-promise-的异常捕获方式"}},[s._v("#")]),s._v(" 3.2 Promise 的异常捕获方式")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#321-%E5%9C%A8-promise-%E7%9A%84%E6%9E%84%E9%80%A0%E4%BD%93%E5%86%85%E8%BF%9B%E8%A1%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"}},[s._v("在 Promise 的构造体内进行错误处理")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#322-%E9%80%9A%E8%BF%87-promiseprototypecatch-%E6%9D%A5%E8%BF%9B%E8%A1%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"}},[s._v("通过 Promise.prototype.catch 来进行错误处理")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#323-promiseall-%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"}},[s._v("Promise.all 中的异常捕获")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#324-promisetry-%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"}},[s._v("Promise.try 中的异常捕获")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#325-%E5%9C%A8-promise-%E4%B8%AD%E6%97%A0%E6%B3%95%E8%A2%AB%E6%8D%95%E8%8E%B7%E7%9A%84%E9%94%99%E8%AF%AF"}},[s._v("在 Promise 中无法被捕获的错误")])])]),s._v(" "),n("h5",{attrs:{id:"_3-2-1-在-promise-的构造体内进行错误处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-在-promise-的构造体内进行错误处理"}},[s._v("#")]),s._v(" 3.2.1 在 Promise 的构造体内进行错误处理")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var promise = new Promise(function(resolve,reject){\n    try{\n        throw new Error('test');\n    }catch(e){\n        reject(e)\n    }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("在 Promise 的构造体内进行错误处理，类似于我们在 ES5 中的错误处理方式。")]),s._v(" "),n("h5",{attrs:{id:"_3-2-2-通过-promise-prototype-catch-来进行错误处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-通过-promise-prototype-catch-来进行错误处理"}},[s._v("#")]),s._v(" 3.2.2 通过 Promise.prototype.catch 来进行错误处理")]),s._v(" "),n("p",[s._v("生成"),n("strong",[s._v("Promise")]),s._v("实例后，我们可以通过"),n("strong",[s._v("Promise")]),s._v("原型上的 catch 方法来捕获 Promise 实例内部的错误。"),n("code",[s._v("catch")]),s._v("方法返回的还是一个 Promise 对象。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var promise = new Promise(function(resolve,reject){\n    reject(new Error('test'));\n})\n\npromise.catch(function(e){\n    // something to deal with the error\n    console.log(e);\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("此外 catch 方法还可以处理链式调用中的错误，比如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var promise = new Promise(function(resolve,reject){\n    resolve();\n})\npromise.then(function(){\n    // if some error throw\n}).then(function(){\n    // if some error throw\n}).catch(function(e){\n    // something to deal with the error\n    console.log(e)\n})\n\n// Error:test1\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("上述的代码，最后一个 catch 方法可以捕获前面链式调用过程中任何一步 then 方法里面所抛出的错误。catch 方面里面还可以再抛错误，这个错误会被后面的 catch 捕获")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var promise = new Promise(function(resolve,reject){\n    reject(new Error('test1'))\n})\npromise.catch(function(e){\n    console.log(e);\n    throw new Error('test2')\n}).catch(function(e){\n    console.log(e)\n})\n\n// Error:test1\n// Error:test2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h5",{attrs:{id:"_3-2-3-promise-all-中的异常捕获"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-promise-all-中的异常捕获"}},[s._v("#")]),s._v(" 3.2.3 Promise.all 中的异常捕获")]),s._v(" "),n("p",[s._v("如果组成"),n("strong",[s._v("Promise.all")]),s._v("的"),n("strong",[s._v("promise")]),s._v("有自己的错误捕获方法，那么"),n("strong",[s._v("Promise.all")]),s._v("中的 catch 就不能捕获该错误。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var p1= new Promise(function(resolve,reject){\n    reject(new Error('test1'));\n}).catch(function(e){\n    console.log('由p1自身捕获')\n});\n\nvar p2= new Promise(function(resolve,reject){\n    resolve();\n})\nvar p = Promise.all([p1,p2]);\np.then(function(){\n\n}).catch(function(e){\n    // 在此处捕获不到p1中的error\n    console.log(e)\n})\n// 由p1贴身捕获Error:test1\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h5",{attrs:{id:"_3-2-4-promise-try-中的异常捕获"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-promise-try-中的异常捕获"}},[s._v("#")]),s._v(" 3.2.4 Promise.try 中的异常捕获")]),s._v(" "),n("p",[s._v("ES2018 中可以通过"),n("strong",[s._v("Promise.try")]),s._v("来同步处理，可能是异步也可能是同步的函数。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function f(){}\nPromise.try(f);\nconsole.log(2);\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("上述的方法，不管是同步还是异步，都会执行该方法，再输出 2.")]),s._v(" "),n("p",[s._v("在"),n("strong",[s._v("Promise.try")]),s._v("的错误处理中，通过 catch 方法既可以捕获 f 是同步函数情况下的错误，也可以捕获 f 是异步函数下的错误。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function f(){\n\n}\n\nPromise.try(f).then(function(){\n\n}).catch(function(e){\n\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h5",{attrs:{id:"_3-2-5-在-promise-中无法被捕获的错误"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-在-promise-中无法被捕获的错误"}},[s._v("#")]),s._v(" 3.2.5 在 Promise 中无法被捕获的错误")]),s._v(" "),n("p",[s._v("在"),n("strong",[s._v("promise")]),s._v("实例"),n("strong",[s._v("resolve")]),s._v("之后，错误无法被捕获。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var promise = new Promise(function(resolve,reject){\n    resolve();\n    throw new Error('test');    // 该错误无法被捕获\n})\npromise.then(function(){\n//\n}).then(function(e){\n    console.log(e)\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("该错误可以用尾调用 resolve 来避免。")]),s._v(" "),n("p",[s._v("参考资料："),n("a",{attrs:{href:"https://github.com/forthealllight/blog/issues/16",target:"_blank",rel:"noopener noreferrer"}},[s._v("总结一下 ES6/ES7 中 promise、generator 和 async/await 中的异常捕获方法 "),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"四、finally"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、finally"}},[s._v("#")]),s._v(" 四、finally()")]),s._v(" "),n("p",[n("code",[s._v("finally")]),s._v("方法用于指定不管"),n("code",[s._v("Promise")]),s._v("对象最后状态如何，都会执行的操作。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("promise.then(result=>{...}).catch(error=>{...}).finally(()=>{...});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("不管"),n("code",[s._v("promise")]),s._v("最后的状态，在执行完"),n("code",[s._v("then")]),s._v("或"),n("code",[s._v("catch")]),s._v("指定的回调函数以后，都会执行"),n("code",[s._v("finally")]),s._v("方法指定的回调函数。")]),s._v(" "),n("p",[s._v("简单实现 finally")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    Promise.prototype.finally = function(callback){\n        let P = this.contructor;\n        return this.then(\n            value => P.resolve(callback()).then(()=>value),\n            reason => P.resolve(callback()).then(()=>{throw reason})\n        )\n    }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"五、all"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、all"}},[s._v("#")]),s._v(" 五、all()")]),s._v(" "),n("p",[n("code",[s._v("Promise.all")]),s._v("方法用于将多个 Promise 实例，包装成一个新的 Promise 实例。"),n("code",[s._v("Promise.all")]),s._v("方法接受一个数组作为参数，"),n("code",[s._v("p1")]),s._v("、"),n("code",[s._v("p2")]),s._v("、"),n("code",[s._v("p3")]),s._v("都是"),n("code",[s._v("Promise")]),s._v("实例，如果不是就会先调"),n("code",[s._v("Promise.resolve")]),s._v("方法，再进一步处理。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var p = Promise.all([p1,p2,p3]);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("p 的状态由"),n("code",[s._v("p1")]),s._v("、"),n("code",[s._v("p2")]),s._v("、"),n("code",[s._v("p3")]),s._v("决定，分成两种情况。")]),s._v(" "),n("ol",[n("li",[s._v("只有"),n("code",[s._v("p1")]),s._v("、"),n("code",[s._v("p2")]),s._v("、"),n("code",[s._v("p3")]),s._v("的状态都变成"),n("code",[s._v("fulfilled")]),s._v("，"),n("code",[s._v("p")]),s._v("的状态才会变成"),n("code",[s._v("fulfilled")]),s._v("，此时"),n("code",[s._v("p1")]),s._v("、"),n("code",[s._v("p2")]),s._v("、"),n("code",[s._v("p3")]),s._v("返回值组成一个数组，传递给"),n("code",[s._v("p")]),s._v("的回调函数。")]),s._v(" "),n("li",[s._v("只要"),n("code",[s._v("p1")]),s._v("、"),n("code",[s._v("p2")]),s._v("、"),n("code",[s._v("p3")]),s._v("之中有一个被"),n("code",[s._v("rejected")]),s._v("，"),n("code",[s._v("p")]),s._v("的状态就变成"),n("code",[s._v("rejected")]),s._v("，此时第一个被"),n("code",[s._v("reject")]),s._v("的实例的返回值，会传递给"),n("code",[s._v("p")]),s._v("的回调函数。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 生成一个Promise对象的数组\nvar promises = [2, 3, 5, 7, 11, 13].map(function (id) {\n  return getJSON('/post/' + id + \".json\");\n});\n\nPromise.all(promises).then(function (posts) {\n  // ...\n}).catch(function(reason){\n  // ...\n});\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"六、ace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、ace"}},[s._v("#")]),s._v(" 六、ace()")]),s._v(" "),n("p",[n("code",[s._v("Promise.race")]),s._v("方法同样是将多个 Promise 实例，包装成一个新的 Promise 实例。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var p = Promise.race([p1,p2,p3]);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("只要"),n("code",[s._v("p1")]),s._v("、"),n("code",[s._v("p2")]),s._v("、"),n("code",[s._v("p3")]),s._v("之中有一个实例率先改变状态，"),n("code",[s._v("p")]),s._v("的状态就跟着改变。那个率先改变的 Promise 实例的返回值，就传递给"),n("code",[s._v("p")]),s._v("的回调函数。")]),s._v(" "),n("p",[n("code",[s._v("Promise.race")]),s._v("方法的参数与"),n("code",[s._v("Promise.all")]),s._v("方法一样，如果不是"),n("code",[s._v("Promise")]),s._v("实例，就会先调用"),n("code",[s._v("Promise.resolve")]),s._v("方法，将参数转为"),n("code",[s._v("Promise")]),s._v("实例，再进一步处理。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const p = Promise.race([\n  fetch('/resource-that-may-take-a-while'),\n  new Promise(function (resolve, reject) {\n    setTimeout(() => reject(new Error('request timeout')), 5000)\n  })\n]);\np.then(response => console.log(response));\np.catch(error => console.log(error));\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"七、resolve"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#七、resolve"}},[s._v("#")]),s._v(" 七、resolve()")]),s._v(" "),n("p",[s._v("有时需要将现有对象转为 Promise 对象，"),n("code",[s._v("Promise.resolve")]),s._v("方法就赶到这个作用。")]),s._v(" "),n("p",[n("code",[s._v("Promise.resolve")]),s._v("等价于下面的写法。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.resolve('foo')\n//  等价于\nnew Promise(resolve=>resolve('foo'))\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("code",[s._v("resolve")]),s._v("方法的参数分成四种情况")]),s._v(" "),n("ol",[n("li",[s._v("参数是一个 "),n("code",[s._v("Promise")]),s._v("实例")]),s._v(" "),n("li",[s._v("参数是一个"),n("code",[s._v("thenable")]),s._v("对象")]),s._v(" "),n("li",[s._v("参数不是具有"),n("code",[s._v("then")]),s._v("方法的对象，或根本就不是对象")]),s._v(" "),n("li",[s._v("不带有任何参数")])]),s._v(" "),n("h4",{attrs:{id:"_7-1-参数是一个-promise实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-参数是一个-promise实例"}},[s._v("#")]),s._v(" 7.1 参数是一个 "),n("code",[s._v("Promise")]),s._v("实例")]),s._v(" "),n("p",[s._v("如果参数是 Promise 实例，那么"),n("code",[s._v("Promise.resolve")]),s._v("将不做任何修改、原封不动地返回这个实例。")]),s._v(" "),n("h4",{attrs:{id:"_7-2-参数是一个thenable对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-参数是一个thenable对象"}},[s._v("#")]),s._v(" 7.2 参数是一个"),n("code",[s._v("thenable")]),s._v("对象")]),s._v(" "),n("p",[n("code",[s._v("thenable")]),s._v("对象指的是具有"),n("code",[s._v("then")]),s._v("方法的对象，"),n("code",[s._v("Promise.resolve")]),s._v("方法会将这个对象转为 Promise 对象，然后就立即执行"),n("code",[s._v("thenable")]),s._v("对象的"),n("code",[s._v("then")]),s._v("方法。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("let thenable = {\n    then: function(resolve,reject){\n        resolve(42);\n    }\n};\n\nlet p1 = Promise.resolve(thenable);\np1.then(function(value){\n    console.log(value);     // 42\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("code",[s._v("thenable")]),s._v("对象的"),n("code",[s._v("then")]),s._v("方法执行后，对象"),n("code",[s._v("p1")]),s._v("的状态就变为"),n("code",[s._v("resolved")]),s._v("，从而立即执行最后那个"),n("code",[s._v("then")]),s._v("方法指定的回调函数，输出 42。")]),s._v(" "),n("h4",{attrs:{id:"_7-3-参数不是具有then方法的对象，或根本就不是对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-参数不是具有then方法的对象，或根本就不是对象"}},[s._v("#")]),s._v(" 7.3 参数不是具有"),n("code",[s._v("then")]),s._v("方法的对象，或根本就不是对象")]),s._v(" "),n("p",[s._v("如果参数是一个原始值，或者是一个不具有"),n("code",[s._v("then")]),s._v("方法的对象，则"),n("code",[s._v("Promise.resolve")]),s._v("方法返回一个新的 Promise 对象，状态为"),n("code",[s._v("resolved")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var p = Promise.resolve('Hello');\n\np.then(function (s){\n  console.log(s)\n});\n// Hello\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"_7-4-不带有任何参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-不带有任何参数"}},[s._v("#")]),s._v(" 7.4 不带有任何参数")]),s._v(" "),n("p",[n("code",[s._v("Promise.resolve")]),s._v("方法允许调用时不带参数，直接返回一个"),n("code",[s._v("resolved")]),s._v("状态的"),n("code",[s._v("Promise")]),s._v("对象。")]),s._v(" "),n("h3",{attrs:{id:"八、reject"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#八、reject"}},[s._v("#")]),s._v(" 八、reject()")]),s._v(" "),n("p",[n("code",[s._v("reject(reason)")]),s._v("方法也会返回一个新的"),n("code",[s._v("Promise")]),s._v("实例，该实例的状态为"),n("code",[s._v("rejected")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var p = Promise.reject('出错了');\n\n// 等同于\nvar p = new Promise((resolve,reject)=> reject('出错了'))\n\np.then(null,function(s){\n    console.log(s)\n})\n// 出错了\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"九、try"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#九、try"}},[s._v("#")]),s._v(" 九、try()")]),s._v(" "),n("p",[s._v("实际开发中，经常遇到一种情况：不知道或者不想区分，函数"),n("code",[s._v("f")]),s._v("是同步函数还是异步操作，但是想用 Promise 来处理它。因为这样就可以不管"),n("code",[s._v("f")]),s._v("是否饮食异步操作，都用"),n("code",[s._v("then")]),s._v("方法指定下一步流程，用"),n("code",[s._v("catch")]),s._v("方法处理"),n("code",[s._v("f")]),s._v("抛出的错误。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.resolve().then(f)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("上面的写法有一个缺点，就是如果 f 是同步函数，那么它会在本轮事件循环的末尾执行。")]),s._v(" "),n("h3",{attrs:{id:"十、应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十、应用"}},[s._v("#")]),s._v(" 十、应用")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#101-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E7%89%87"}},[s._v("加载图片")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#102-%E9%80%9A%E8%BF%87-promise-%E5%B0%81%E8%A3%85-ajax-%E8%A7%A3%E5%86%B3%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1%E9%97%AE%E9%A2%98"}},[s._v("通过 Promise 封装 ajax 解决回调地狱问题")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#103-generator-%E5%87%BD%E6%95%B0%E4%B8%8E-promise-%E7%9A%84%E7%BB%93%E5%90%88"}},[s._v("Generator 函数与 Promise 的结合")])])]),s._v(" "),n("h4",{attrs:{id:"_10-1-加载图片"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-加载图片"}},[s._v("#")]),s._v(" 10.1 加载图片")]),s._v(" "),n("p",[s._v("我们可以将图片的加载写成一个"),n("code",[s._v("Promise")]),s._v("，一旦加载完成，"),n("code",[s._v("Promise")]),s._v("的状态就发生变化。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const preloadImage = function(path){\n    return new Promise(function(resolve,reject){\n        var image = new Image();\n        image.onload = resolve;\n        image.onerror = reject;\n        image.src = path;\n    });\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"_10-2-通过-promise-封装-ajax-解决回调地狱问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-通过-promise-封装-ajax-解决回调地狱问题"}},[s._v("#")]),s._v(" 10.2 通过 Promise 封装 ajax 解决回调地狱问题")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\nfunction getJSON(url){\n    return new Promise((resolve,reject) => {\n        var XHR = new XMLHttpRequest();\n        XHR.open('GET',url);\n        client.onreadystatechange = handler;\n        client.responseType = 'json';\n        client.setRequestHeader('Accept','application/json');\n        client.send();\n\n        function handler(){\n            if(this.readyState !==4){\n                return;\n            }\n            if(this.status === 200){\n                resolve(this.response);\n            }else{\n                reject(new Error(this.statusText));\n            }\n        };\n    });\n\n    return promise;\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h4",{attrs:{id:"_10-3-generator-函数与-promise-的结合"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-generator-函数与-promise-的结合"}},[s._v("#")]),s._v(" 10.3 Generator 函数与 Promise 的结合")]),s._v(" "),n("p",[s._v("使用"),n("code",[s._v("Generator")]),s._v("函数管理流程，遇到异步操作的时候，通常返回一个"),n("code",[s._v("Promise")]),s._v("对象。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function getFoo(){\n\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"十一、错误用法及误区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十一、错误用法及误区"}},[s._v("#")]),s._v(" 十一、错误用法及误区")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#111-%E5%BD%93%E4%BD%9C%E5%9B%9E%E8%B0%83%E6%9D%A5%E7%94%A8-callback-hell"}},[s._v("当作回调来用 Callback Hell")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#112-%E6%80%8E%E6%A0%B7%E7%94%A8-foreach-%E5%A4%84%E7%90%86-promise"}},[s._v("怎样用 forEach() 处理 promise")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#113-%E6%B2%A1%E6%9C%89%E8%BF%94%E5%9B%9E%E5%80%BC"}},[s._v("没有返回值")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#114-%E6%B2%A1%E6%9C%89-catch"}},[s._v("没有 Catch")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#115-catch%E4%B8%8E-thennull-fn%E5%B9%B6%E4%B8%8D%E5%AE%8C%E5%85%A8%E7%9B%B8%E5%90%8C"}},[s._v("catch()与 then(null, fn)")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#116-%E6%96%AD%E9%93%BE-the-broken-chain"}},[s._v("断链 The Broken Chain")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#117-%E7%A9%BF%E9%80%8F-fall-through"}},[s._v("穿透 Fall Through")])])]),s._v(" "),n("h4",{attrs:{id:"_11-1-当作回调来用-callback-hell"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-当作回调来用-callback-hell"}},[s._v("#")]),s._v(" 11.1 当作回调来用 Callback Hell")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("loadAsync1().then(function(data1){\n    loadAsync2(data1).then(function(data2){\n        loadAsync3(data2).then(okFn,failFn)\n    });\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("Promise 用来解决异步嵌套回调的，这种写法虽然可靠，但违背了 Promise 的设计初衷改成下面的写法，会让结构更加清晰")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("loadAsync1().then(function(data1){\n    return loadAsync2(data1)\n}).then(function(data2){\n    return loadAsync3(data2)\n}).then(okFn,failFn)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"_11-2-怎样用-foreach-处理-promise"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-怎样用-foreach-处理-promise"}},[s._v("#")]),s._v(" 11.2 怎样用 forEach() 处理 promise")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("db.allDocs({include_docs:true}).then(function(result){\n    result.rows.forEach(function(row){\n        db.remove(row.doc);\n    })\n}).then(function(){\n\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("这段代码的问题在于第一个回调函数实际上返回的是"),n("code",[s._v("undefined")]),s._v("，也就意味着第二个函数并不是在所有的"),n("code",[s._v("db.remove()")]),s._v("执行结束之后才执行。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("db.allDocs({include_docs:true}).then(function(result){\n    return Promise.all(result.rows.map(function(row){\n        return db.remove(row.doc);\n    }))\n}).then(function(arrayObject){\n    // All docs have\n})\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("从根本上说，"),n("code",[s._v("Promise.all()")]),s._v("以一个 promise 对象组成的数组为输入，返回另一个 promise 对象。")]),s._v(" "),n("h4",{attrs:{id:"_11-3-没有返回值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-3-没有返回值"}},[s._v("#")]),s._v(" 11.3 没有返回值")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("loadAsync1().then(function(data1){\n    loadAsync2(data1)\n}).then(function(data2){\n    loadAsync3(data2)\n}).then(res=>console.log(res))\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"_11-4-没有-catch"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-4-没有-catch"}},[s._v("#")]),s._v(" 11.4 没有 Catch")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("loadAsync1().then(function(data1){\n\n}).then(function(data2){\n\n}).then(okFn,failFn)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("这里的调用，并没有添加 catch 方法，那么如果中间某个环节发生错误，将不会被捕获，控制台将看不到任何错误，不利于调试查错，所以最好在最后添加 catch 方法用于捕获错误。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("loadAsync1()\n    .then(function(data1){\n        return loadAsync2(data1)\n    })\n    .then(function(data2){\n        return loadAsync3(data2)\n    }).then(okFn,failFn)\n    .catch(err=>console.log(err))\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"_11-5-catch-与-then-null-fn-并不完全相同"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-catch-与-then-null-fn-并不完全相同"}},[s._v("#")]),s._v(" 11.5 "),n("code",[s._v("catch()")]),s._v("与 "),n("code",[s._v("then(null, fn)")]),s._v("并不完全相同")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("somePromise().then(function () {\n  throw new Error('oh noes');\n}).catch(function (err) {\n  // I caught your error! :)\n});\n\nsomePromise().then(function () {\n  throw new Error('oh noes');\n}, function (err) {\n  // I didn't catch your error! :(\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("当使用"),n("code",[s._v("then(resolveHandler,rejectHandler)")]),s._v("，"),n("code",[s._v("rejectHandler")]),s._v("不会捕获在"),n("code",[s._v("resolveHandler")]),s._v("中抛出的错误。")]),s._v(" "),n("h4",{attrs:{id:"_11-6-断链-the-broken-chain"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-6-断链-the-broken-chain"}},[s._v("#")]),s._v(" 11.6 断链 The Broken Chain")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function loadAsyncFnX(){return Promise.resolve(1);}\nfunction doSth(){return 2;}\n\nfunction asyncFn(){\n    var promise = loadAsyncFnx()\n    promise.then(function(){\n            reutrn doSth();\n    })\n    return promise;\n}\n\nasyncFn().then(res=>console.log(res)).catch(err=>console.log(err))      // 1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("从执行结果来看，then 中架设的参数其实并不是 doSth()返回的结果，而是 loadAsyncFnX()返回的结果，catch 到的错误也是 loadAsyncFnX()中的错误，所以 doSth()的结果和错误将不会被后而的 then 中的回调捕获到，形成了断链，因为 then 方法将返回一个新的 Promise 对象，而不是原来的 Promise 对象")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function loadAsyncFnX(){ return Promise.resolve(1); }\nfunction doSth(){ return 2; }\n\nfunction asyncFn(){\n\tvar promise = loadAsyncFnX()\n    return promise.then(function(){\n\t\treturn doSth();\n    })\n}\n\nasyncFn().then(res=>console.log(res)).catch(err=>console.log(err))\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"_11-7-穿透-fall-through"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-7-穿透-fall-through"}},[s._v("#")]),s._v(" 11.7 穿透 Fall Through")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.resolve('foo').then(Promise.resolve('bar')).then(function(result){\n    console.log(result);\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("如果你认为输出的是 bar，那么你就错了。实际上它输出的是 foo！")]),s._v(" "),n("p",[s._v("产生这样的输出是因为你给 then 方法传递了一个非函数的值，代码会这样理解："),n("code",[s._v("then(null)")]),s._v("，因此导致前一个 promise 的结果产生了坠落的效果。")]),s._v(" "),n("p",[s._v("参考资料："),n("a",{attrs:{href:"http://coderlt.coding.me/2016/12/03/promise-in-depth-an-introduction-1/",target:"_blank",rel:"noopener noreferrer"}},[s._v("深入理解 Promise (上)"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"十二、promise-你可能不知道的-6-件事"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十二、promise-你可能不知道的-6-件事"}},[s._v("#")]),s._v(" 十二、promise 你可能不知道的 6 件事")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#121-then%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA-forked-promise%E5%88%86%E5%8F%89%E7%9A%84-promise"}},[n("code",[s._v("then()")]),s._v("返回一个 forked Promise(分叉的 Promise)")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#122-%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E5%BA%94%E8%AF%A5%E4%BC%A0%E9%80%92%E7%BB%93%E6%9E%9C"}},[s._v("回调函数应该传递结果")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#123-%E5%8F%AA%E8%83%BD%E6%8D%95%E8%8E%B7%E6%9D%A5%E8%87%AA%E4%B8%8A%E4%B8%80%E7%BA%A7%E7%9A%84%E5%BC%82%E5%B8%B8"}},[s._v("只能捕获来自上一级的异常")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#124-%E9%94%99%E8%AF%AF%E8%83%BD%E8%A2%AB%E6%81%A2%E5%A4%8D"}},[s._v("错误能被恢复")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#125-promise-%E8%83%BD%E8%A2%AB%E6%9A%82%E5%81%9C"}},[s._v("Promise 能被暂停")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#126-resolved-%E7%8A%B6%E6%80%81%E7%9A%84-promise-%E4%B8%8D%E4%BC%9A%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C"}},[s._v("resolved 状态的 Promise 不会立即执行")])])]),s._v(" "),n("h4",{attrs:{id:"_12-1-then-返回一个-forked-promise-分叉的-promise"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-then-返回一个-forked-promise-分叉的-promise"}},[s._v("#")]),s._v(" 12.1 "),n("code",[s._v("then()")]),s._v("返回一个 forked Promise(分叉的 Promise)")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// Exhitbit A\nvar p = new Promise(/*...*/);\np.then(func1);\np.then(func2);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// Exhitbit B\nvar p = new Promise(/*...*/);\np.then(func1).then(func2);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("如果你认为两段代码等价，那么你可能认为 promise 仅仅就是一维回调函数的数组。然而，这两段代码并不等价。"),n("code",[s._v("p")]),s._v("每次调用"),n("code",[s._v("then()")]),s._v("都会返回一个"),n("code",[s._v("forked promise")]),s._v("。因此，在 A 中，如果"),n("code",[s._v("func1")]),s._v("抛出一个异常，"),n("code",[s._v("func2")]),s._v("依然能执行，而在 B 中，"),n("code",[s._v("func2")]),s._v("不会被执行，因为第一次调用返回了一个新"),n("code",[s._v("promise")]),s._v("，由于"),n("code",[s._v("func1")]),s._v("中抛出异常，这个"),n("code",[s._v("promise")]),s._v("被"),n("code",[s._v("rejected")]),s._v("了，结果"),n("code",[s._v("func2")]),s._v("被跳过不执行了。")]),s._v(" "),n("h4",{attrs:{id:"_12-2-回调函数应该传递结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-回调函数应该传递结果"}},[s._v("#")]),s._v(" 12.2 回调函数应该传递结果")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('var p = new Promise(function(resolve,reject){\n    resolve("hello world");\n})\n\np.then(function(str){\n\n}).then(function(str){\n    console.log(str)\n})\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("第二个"),n("code",[s._v("then()")]),s._v("中的"),n("code",[s._v("console.log")]),s._v("显示的是"),n("code",[s._v("undefined")]),s._v("，因为在 promise 的上下文中，回调函数像普通的回调函数一样传递结果。promise 期望你的回调函数或者返回同一个结果，或者返回其它结果，返回的结果会被传给下一个回调。")]),s._v(" "),n("h4",{attrs:{id:"_12-3-只能捕获来自上一级的异常"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-3-只能捕获来自上一级的异常"}},[s._v("#")]),s._v(" 12.3 只能捕获来自上一级的异常")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("new Promise(function(resolve,reject){\n    resolve('hello world');\n}).then(function(str){\n    throw new Error('uh oh');\n},undefined).then(undefined,function(error){\n    console.log(error);\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// Exhibit B\nnew Promise(function(resolve,reject){\n    resolve('hello world');\n}).then(function(str){\n    throw new Error('uh oh');\n},function(error){\n    console.log(error);\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("在 A 中，当第一个"),n("code",[s._v("then")]),s._v("抛出异常时，第二个"),n("code",[s._v("then")]),s._v("能捕获到该异常，并会弹出"),n("code",[s._v("uh oh")]),s._v("。这符合只捕获来自上一级异常的规则。")]),s._v(" "),n("p",[s._v("在 B 中，正确的回调函数和错误的回调函数在同一级，也就是说，尽管在回调中抛出了异常，但是这个异常不会被捕获。事实上，B 中的错误回调只有在"),n("code",[s._v("promise")]),s._v("被"),n("code",[s._v("rejected")]),s._v("或者"),n("code",[s._v("promise")]),s._v("自身抛出一个异常时才会被执行。")]),s._v(" "),n("h4",{attrs:{id:"_12-4-错误能被恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-4-错误能被恢复"}},[s._v("#")]),s._v(" 12.4 错误能被恢复")]),s._v(" "),n("p",[s._v("在一个错误回调中，如果没有重新抛出错误，promise 会认为你已经恢复了该错误，promise 的状态会转变为"),n("code",[s._v("resolved")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("var p = new Promise(function(resolve,reject){\n    reject(new Error('pebkac'));\n});\n\np.then(\n    undefined,\n    function(error){ }\n)\n .then(\n    function(str){\n        alert('I am saved!');\n    },\n    function(error){\n     alert('Bad computer!');\n    }\n);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h4",{attrs:{id:"_12-5-promise-能被暂停"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-5-promise-能被暂停"}},[s._v("#")]),s._v(" 12.5 Promise 能被暂停")]),s._v(" "),n("p",[s._v("仅仅因为你已经在一个"),n("code",[s._v("then()")]),s._v("函数中执行过代码，并不意味着你不能够暂停 promise 去做其他事情。为了暂停当前的 promise，或者要它等待另一个 promise 完成，只需要简单地在 then() 函数中返回另一个 promise。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('var p = new Promise(/*...*/);\n\np.then(function(str){\n    if(!loggedIn){\n        return new Promise(/*...*/);\n    }\n})\n .then(function(str){\n    alert("Done!");\n });\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("在上面的代码中，直到新的"),n("code",[s._v("promise")]),s._v("的状态是"),n("code",[s._v("resolved")]),s._v("解析后，"),n("code",[s._v("alert")]),s._v("才会显示。如果要在已经存在的异步代码中引入更多的依赖，这是一个很便利的方式。例如，你发现用户会话已经超时了，因此，你可能想要在继续执行后面的代码之前发起第二次登录。")]),s._v(" "),n("h4",{attrs:{id:"_12-6-resolved-状态的-promise-不会立即执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-6-resolved-状态的-promise-不会立即执行"}},[s._v("#")]),s._v(" 12.6 resolved 状态的 Promise 不会立即执行")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("function runme() {\n  var i = 0;\n\n  new Promise(function(resolve) {\n    resolve();\n  })\n  .then(function() {\n    i += 2;\n  });\n  alert(i);\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("你可能会认为弹出 2，因为 promise 已经是 resolved ，then() 会立即执行(同步)。然而，promise 规范要求所有回调都是异步的，因此，alert 执行时 i 的值还没有被修改。")]),s._v(" "),n("p",[s._v("参考资料："),n("a",{attrs:{href:"https://github.com/dwqs/blog/issues/1",target:"_blank",rel:"noopener noreferrer"}},[s._v("关于 Promise：你可能不知道的 6 件事"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"十三、手写-promise"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十三、手写-promise"}},[s._v("#")]),s._v(" 十三、手写 Promise")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const PENDING = 'pending';\nconst FULFILLED = 'fulfilled';\nconst REJECTED = 'rejected';\n\nfunction Promise(excutor){\n    let that = this;        // 缓存当前promise实例对象\n    that.status = PENDING;  // 初始状态\n    that.value = undefined;     // fulfilled状态时 返回的信息\n    that.reason = undefined;    // rejected状态时，拒绝的原因\n    that.onFulfilledCallbacks = []; // 存储fulfilled状态对应的onFulfilled函数\n    that.onRejectedCallbacks = [];      //存储rejected状态对应的onRejected函数\n\n    function resolve(value){    // value成功态时接收的终值\n        if(value instanceof Promise){\n            return value.then(resolve,reject);\n        }\n        //  实践中要确保onFulfilled 和 onRejected方法异步执行，且应该在then方法被调用的那一轮事件循环之后的新执行栈中执行。\n        setTimeout(()=>{\n            //调用resolve回调对应onFulfilled函数\n            if(that.status === PENDING){\n                // 只能由pending状态=> fullfilled状态（避免调用多次resolve reject）\n                that.status = FULFILLED;\n                that.value = value;\n                that.onFulfilledCallbacks.forEach(cb=>cb(that.value));\n            }\n        })\n    }\n    function reject(reason){    // reason失败态时接收的拒因\n        setTimeout(()=>{\n            // 调用reject 回调对应onRejected函数\n            if (that.status === PENDING){\n                // 只能由pending状态 => rejected状态（避免调用多次resolve reject）\n                that.status = REJECTED;\n                that.reason = reason;\n                that.onRejectedCallbacks.forEach(cb=>cb(that.reason));\n            }\n        });\n    }\n\n    // 捕获在excutor执行器中抛出异常\n    // new Promise((resolve,reject)=>{\n        //   throw new Error('error in excutor')\n    // })\n\n    try{\n        excutor(resolve,reject);\n    }catch(e){\n        reject(e);\n    }\n}\n\nfunction resolvePromise(promise2,x,resolve,reject){\n    var then;\n    var thenCalledThrow = false;\n\n    if(promise2 === x){\n        return reject(new TypeError('Chaining cycle detected for promise!'))\n    }\n\n    if( x instanceof Promise){\n        if(x.status === 'pending'){\n            x.then(function(v){\n                resolvePromise(promise2,v,resolve,reject)\n            },reject)\n        }else{\n            x.then(resolve,reject)\n        }\n        return\n    }\n\n    if((x!==null) && ((typeof x=== 'object') || (typeof x === 'function'))){\n        try{\n            then = x.then   // because x.then could be a getter\n            if(typeof then === 'function'){\n                then.call(x,function rs(y){\n                    if(thenCalledOrThrow) return\n                    thenCalledOrThrow = true\n                    reutrn resolvePromise(promise2,y,resolve,reject)\n                },function rj(r){\n                    if(thenCalledOrThrow) return\n                    thenCalledOrThrow = true\n                    return reject(r)\n                })\n            }else{\n                resolve(x)\n            }\n        }catch(e){\n            if(thenCalledOrThrow) return\n            thenCalledOrThrow = true\n            return reject(e)\n        }\n    }else{\n        resolve(x)\n    }\n}\n\nPromise.prototype.then = function(onFulfilled,onRejected){\n    const that = this;\n    let newPromise;\n    // 处理参数默认值  保证参数后续能够继续执行\n    onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : value => value;\n    onRejected = typeof onRejected === 'function' ? onRejected : reason => {\n        throw reason;\n    }\n    if ( that.status === FULFILLED){    //成功态\n        return newPromise = new Promise((resolve,reject) =>{\n            setTimeout(()=>{\n                try{\n                    let x = onFulfilled(that.value);\n                    resolvePromise(newPromise,x,resolve,reject);\n// 新的promise resolve 上一个onFulfilled的返回值\n                }catch(e){\n                    reject(e);  //  捕获前面onFulfilled中抛出的异常 then(onFulfilled, onRejected);\n                }\n            })\n        })\n    }\n\n    if(that.status === REJECTED){   // 失败态\n        return newPromise = new Promise((resolve,reject)=>{\n            setTimeout(()=>{\n                try{\n                    let x = onRejected(that.reason);\n                    resolvePromise(newPromise,x,resolve,reject);\n                }catch(e){\n                    reject(e);\n                }\n            })\n        })\n    }\n\n    if(that.status === PENDING){    // 等待态\n        // 当异步调用resolve/rejected时 将onFulfilled/onRejected收集暂存到集合中\n        return newPromise = new Promise((resolve,reject)=>{\n            that.onFulfilledCallbacks.push((value)=>{\n                try{\n                    let x = onFulfilled(value);\n                    resolvePromise(newPromise,x,resolve,reject);\n                }catch(e){\n                    reject(e);\n                }\n            });\n            that.onRejectedCallbacks.push((reason)=>{\n                try{\n                    let x = onRejected(reason);\n                    reasolvePromise(newPromise,x,resolve,reject);\n                }catch(e){\n                    reject(e);\n                }\n            })\n        })\n    }\n}\n\nPromise.prototype.catch = function(onRejected){\n    return thsi.then(null,onRejected)\n}\n\nPromise.deferred = Promise.defer = function(){\n    var dfd ={}\n    dfd.promise = new Promise(function(resolve,reject){\n        dfd.resolve = resolve\n        dfd.reject = reject\n    })\n    return dfd;\n}\n\nPromise.all = function(promises){\n    return new Promise((resolve,reject){\n        const result = []\n        let cnt = 0\n        for (let i = 0; i < promises.length;++i){\n            promises[i].then(value=>{\n                cnt++\n                result[i]=value\n                if(cnt  === promises.length) resolve(result)\n            },reject)\n        }\n    })\n}\n\nPromise.race = function(promises){\n    return new Promise((resolve,reject)=>{\n        promises[i].then(resolve,reject)\n    })\n}\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br")])]),n("p",[s._v("参考资料：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/xieranmaya/blog/issues/3",target:"_blank",rel:"noopener noreferrer"}},[s._v("手写 promise"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5b2f02cd5188252b937548ab",target:"_blank",rel:"noopener noreferrer"}},[s._v("BAT 前端经典面试问题：史上最最最详细的手写 Promise 教程"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5aa7868b6fb9a028dd4de672",target:"_blank",rel:"noopener noreferrer"}},[s._v("Promise 原理讲解 && 实现一个 Promise 对象 "),n("OutboundLink")],1)])]),s._v(" "),n("h3",{attrs:{id:"十四、promise-几道面试题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十四、promise-几道面试题"}},[s._v("#")]),s._v(" 十四、Promise 几道面试题")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#141-%E9%A2%98%E7%9B%AE%E4%B8%80"}},[s._v("题目一")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#142-%E9%A2%98%E7%9B%AE%E4%BA%8C"}},[s._v("题目二")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#143-%E9%A2%98%E7%9B%AE%E4%B8%89"}},[s._v("题目三")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#144-%E9%A2%98%E7%9B%AE%E5%9B%9B"}},[s._v("题目四")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#145-%E9%A2%98%E7%9B%AE%E4%BA%94"}},[s._v("题目五")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#146-%E9%A2%98%E7%9B%AE%E5%85%AD"}},[s._v("题目六")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#147-%E9%A2%98%E7%9B%AE%E4%B8%83"}},[s._v("题目七")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#148-%E9%A2%98%E7%9B%AE%E5%85%AB"}},[s._v("题目八")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#149-%E9%A2%98%E7%9B%AE%E4%B9%9D"}},[s._v("题目九")])]),s._v(" "),n("li",[n("a",{attrs:{href:"#1410-%E9%A2%98%E7%9B%AE%E5%8D%81"}},[s._v("题目十")])])]),s._v(" "),n("h4",{attrs:{id:"_14-1-题目一"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-1-题目一"}},[s._v("#")]),s._v(" 14.1 题目一")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise((resolve,reject)=>{\n    console.log(1)\n    resolve()\n    console.log(2)\n})\npromise.then(()=>{\n    console.log(3)\n})\nconsole.log(4)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"_14-2-题目二"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-2-题目二"}},[s._v("#")]),s._v(" 14.2 题目二")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise1 = new Promise(resolve,reject)=>{\n    setTimeout(()=>{\n        resolve('success')\n    },1000)\n})\nconst promise2 = promise1.then(()=>{\n    throw new Error('error!!!')\n})\n\nconsole.log('promise1',promise1)\nconsole.log('promise2',promise2)\n\nsetTimeout(()=>{\n    console.log('promise1',promise1)\n    console.log('promise2',promise2)\n},2000)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h4",{attrs:{id:"_14-3-题目三"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-3-题目三"}},[s._v("#")]),s._v(" 14.3 题目三")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise((resolve,reject)=>{\n    resolve('success1')\n    reject('error')\n    resolve('success2')\n})\n\npromise.then((res)=>{\n    console.log('then:',res)\n}).catch((err)=>{\n    console.log('catch:',err)\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"_14-4-题目四"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-4-题目四"}},[s._v("#")]),s._v(" 14.4 题目四")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.resolve(1).then((res)=>{\n    console.log(res)\n    return 2\n}).catch((err)=>{\n    return 3\n}).then((res)=>{\n    console.log(res)\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"_14-5-题目五"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-5-题目五"}},[s._v("#")]),s._v(" 14.5 题目五")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = new Promise((resolve,reject)=>{\n    setTimeout(()=>{\n        console.log('once')\n        resolve('success')\n    },1000)\n})\n\nconst start = Date.now()\npromise.then((res)=>{\n    console.log(res,Date.now()-start)\n})\npromise.then((res)=>{\n    console.log(res,Date.now()-start)\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h4",{attrs:{id:"_14-6-题目六"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-6-题目六"}},[s._v("#")]),s._v(" 14.6 题目六")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.resolve().then(()=>{\n    return new Error('error!!')\n}).then((res)=>{\n    console.log('then:',res)\n}).catch((err)=>[\n    cosnole.log('catch:',err)\n])\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"_14-7-题目七"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-7-题目七"}},[s._v("#")]),s._v(" 14.7 题目七")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const promise = Promise.resolve().then(()=>{\n    return promise\n})\npromise.catch(console.error)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"_14-8-题目八"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-8-题目八"}},[s._v("#")]),s._v(" 14.8 题目八")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.resolve(1).then(2).then(Promise.resolve(3)).then(console.log)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"_14-9-题目九"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-9-题目九"}},[s._v("#")]),s._v(" 14.9 题目九")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Promise.resolve().then(function(res){\n    throw new Error('error')\n},function (e){\n    console.log(e)\n}).catch((e)=>{\n    console.log('fail:',e)\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"_14-10-题目十"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-10-题目十"}},[s._v("#")]),s._v(" 14.10 题目十")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("process.nextTick(()=>{\n    console.log('nextTick')\n})\nPromise.resolve().then(()=>{\n    console.log('then')\n})\nsetImmediate(()=>{\n    console.log('setImmediate')\n})\nconsole.log('end')\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://juejin.im/post/5a04066351882517c416715d",target:"_blank",rel:"noopener noreferrer"}},[s._v("Promise 必知必会（十道题）"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://malcolmyu.github.io/2015/06/12/Promises-A-Plus/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Promise A+ 规范"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://liubin.org/promises-book/",target:"_blank",rel:"noopener noreferrer"}},[s._v("JavaScript Promise 迷你书"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/mvqR4oEq1VcTYB57QqGIvQ",target:"_blank",rel:"noopener noreferrer"}},[s._v("你了解 Promise 吗？"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://mp.weixin.qq.com/s/0DVOqFQYSzCaviSv_3AF-g",target:"_blank",rel:"noopener noreferrer"}},[s._v("promise 是什么？"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/83965949",target:"_blank",rel:"noopener noreferrer"}},[s._v("100 行代码实现 Promises/A+ 规范"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://yjhenan.gitbooks.io/-ecmascript-6/content/docs/promise.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("《ECMAScript 6 入门》 第三版"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://es6.ruanyifeng.com/#docs/promise",target:"_blank",rel:"noopener noreferrer"}},[s._v("ECMAScript 6 入门"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5df83b93f265da33f8652ccc",target:"_blank",rel:"noopener noreferrer"}},[s._v("JS 高级之手写一个 Promise,Generator,async 和 await【近 1W 字】"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5ce40e5ee51d4556be5b39b7",target:"_blank",rel:"noopener noreferrer"}},[s._v("细说 JS 异步发展历程"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5cda1492e51d453a8f348c02",target:"_blank",rel:"noopener noreferrer"}},[s._v("马蹄疾 | 详解 JavaScript 异步机制及发展历程(万字长文)"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5e58c618e51d4526ed66b5cf",target:"_blank",rel:"noopener noreferrer"}},[s._v("【建议星星】要就来 45 道 Promise 面试题一次爽到底(1.1w 字用心整理)"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5e3b9ae26fb9a07ca714a5cc",target:"_blank",rel:"noopener noreferrer"}},[s._v("Promise / async / Generator 实现&原理大解析（附源码）| 9k 字"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("《你不知道的 javascript(中)》")]),s._v(" "),n("li",[s._v("《深入浅出 Node.js》")])]),s._v(" "),n("h2",{attrs:{id:"联系作者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#联系作者"}},[s._v("#")]),s._v(" 联系作者")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("p",[s._v("\n        平凡世界，贵在坚持。\n    ")]),s._v(" "),n("img",{attrs:{src:s.$withBase("/about/contact.png")}})])])}),[],!1,null,null,null);e.default=r.exports}}]);