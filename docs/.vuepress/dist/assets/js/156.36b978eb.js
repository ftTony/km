(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{269:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"koa-基础应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#koa-基础应用","aria-hidden":"true"}},[s._v("#")]),s._v(" koa 基础应用")]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("本人平时学习及收集内容，欢迎参入一起讨论。")]),s._v(" "),a("h2",{attrs:{id:"内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内容","aria-hidden":"true"}},[s._v("#")]),s._v(" 内容")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85-koa"}},[s._v("安装")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%8C%E3%80%81%E8%B7%AF%E7%94%B1"}},[s._v("路由")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B8%89%E3%80%81%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"}},[s._v("请求数据获取")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E5%9B%9B%E3%80%81%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD"}},[s._v("静态资源加载")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%94%E3%80%81cookie-session"}},[s._v("cookie/session")])]),s._v(" "),a("li",[a("a",{attrs:{href:"#%E5%85%AD%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93mysql"}},[s._v("数据库 mysql")])])]),s._v(" "),a("h3",{attrs:{id:"一、安装-koa"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装-koa","aria-hidden":"true"}},[s._v("#")]),s._v(" 一、安装 koa")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install koa --save\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("快速使用")]),s._v(" "),a("li",[s._v("启动 demo")])]),s._v(" "),a("h4",{attrs:{id:"_1-1-快速使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-快速使用","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.1 快速使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\n\napp.use(async (ctx)=>{\n    ctx.body = 'hello koa2'\n})\n\napp.listen(3000)\n\nconsole.log('[demo] start-quick is starting at port 3000')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_1-2-启动-demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-启动-demo","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.2 启动 demo")]),s._v(" "),a("p",[s._v("由于 koa2 是基于 async/await 操作中间件，目前 node.js 7.x 的 harmony 模式下才能使用，所以启动的时的脚本如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node index.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("访问 http:localhost:3000，效果如下")]),s._v(" "),a("p",[a("img",{attrs:{src:"node01.png",alt:"images"}})]),s._v(" "),a("h3",{attrs:{id:"二、路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、路由","aria-hidden":"true"}},[s._v("#")]),s._v(" 二、路由")]),s._v(" "),a("ul",[a("li",[s._v("安装 koa-router 中间件")]),s._v(" "),a("li",[s._v("快速使用 koa-router")])]),s._v(" "),a("h4",{attrs:{id:"_2-1-安装-koa-router-中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装-koa-router-中间件","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.1 安装 koa-router 中间件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install --save koa-router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-2-快速使用-koa-router"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-快速使用-koa-router","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.2 快速使用 koa-router")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst fs = require('fs')\nconst app = new Koa()\n\nconst Router = require('koa-router')\n\nlet home = new Router()\n\n// 子路由1\nhome.get('/', async ( ctx )=>{\n  let html = `\n    <ul>\n      <li><a href=\"/page/helloworld\">/page/helloworld</a></li>\n      <li><a href=\"/page/404\">/page/404</a></li>\n    </ul>\n  `\n  ctx.body = html\n})\n\n// 子路由2\nlet page = new Router()\npage.get('/404', async ( ctx )=>{\n  ctx.body = '404 page!'\n}).get('/helloworld', async ( ctx )=>{\n  ctx.body = 'helloworld page!'\n})\n\n// 装载所有子路由\nlet router = new Router()\nrouter.use('/', home.routes(), home.allowedMethods())\nrouter.use('/page', page.routes(), page.allowedMethods())\n\n// 加载路由中间件\napp.use(router.routes()).use(router.allowedMethods())\n\napp.listen(3000, () => {\n  console.log('[demo] route-use-middleware is starting at port 3000')\n})\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("h3",{attrs:{id:"三、请求数据获取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、请求数据获取","aria-hidden":"true"}},[s._v("#")]),s._v(" 三、请求数据获取")]),s._v(" "),a("ul",[a("li",[s._v("GET 请求数据获取")]),s._v(" "),a("li",[s._v("POST 请求数据获取")])]),s._v(" "),a("h4",{attrs:{id:"_3-1-get-请求数据获取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-get-请求数据获取","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.1 GET 请求数据获取")]),s._v(" "),a("p",[s._v("获取 GET 请求数据有两个路径：")]),s._v(" "),a("ul",[a("li",[s._v("是从上下文中直接获取\n"),a("ul",[a("li",[s._v("请求对象"),a("code",[s._v("ctx.query")]),s._v("，返回如 "),a("code",[s._v("{ a:1, b:2 }")])]),s._v(" "),a("li",[s._v("请求字符串"),a("code",[s._v("ctx.querystring")]),s._v("，返回如 "),a("code",[s._v("a=1&b=2")])])])]),s._v(" "),a("li",[s._v("是从上下文的 "),a("code",[s._v("request")]),s._v(" 对象中获取\n"),a("ul",[a("li",[s._v("请求对象 "),a("code",[s._v("ctx.request.query")]),s._v("，返回如 "),a("code",[s._v("{ a:1, b:2 }")])]),s._v(" "),a("li",[s._v("请求字符串 "),a("code",[s._v("ctx.request.querystring")]),s._v("，返回如 "),a("code",[s._v("a=1&b=2")])])])])]),s._v(" "),a("p",[a("strong",[s._v("例子代码")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\n\napp.use( async ( ctx ) => {\n  let url = ctx.url\n  // 从上下文的request对象中获取\n  let request = ctx.request\n  let req_query = request.query\n  let req_querystring = request.querystring\n\n  // 从上下文中直接获取\n  let ctx_query = ctx.query\n  let ctx_querystring = ctx.querystring\n\n  ctx.body = {\n    url,\n    req_query,\n    req_querystring,\n    ctx_query,\n    ctx_querystring\n  }\n})\n\napp.listen(3000, () => {\n  console.log('[demo] request get is starting at port 3000')\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[a("strong",[s._v("执行程序")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node get.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("执行后程序后，用 chrome 访问 http://localhost:3000/page/user?a=1&b=2 会出现以下情况")]),s._v(" "),a("p",[a("img",{attrs:{src:"node02.png",alt:"images"}})]),s._v(" "),a("h4",{attrs:{id:"_3-2-post-请求数据获取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-post-请求数据获取","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.2 POST 请求数据获取")]),s._v(" "),a("p",[s._v("对于 POST 请求的处理，koa2 没有封装获取参数的方法，可以通过以下方式获取")]),s._v(" "),a("ul",[a("li",[s._v("解析上下文 context 中的原生 node.js 请求对象 req，将 POST 表单数据解析成 query string（例如："),a("code",[s._v("a=1&b=2&c=3")]),s._v("），再将 query string 解析成 JSON 格式（例如："),a("code",[s._v('{"a":"1", "b":"2", "c":"3"}')]),s._v("）")]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("koa-bodyparser")]),s._v("中间件")])]),s._v(" "),a("p",[a("strong",[s._v("解析上下文 context 中的原生 node.js 请求对象 req 相关代码")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\n\napp.use( async ( ctx ) => {\n\n  if ( ctx.url === '/' && ctx.method === 'GET' ) {\n    // 当GET请求时候返回表单页面\n    let html = `\n      <h1>koa2 request post demo</h1>\n      <form method=\"POST\" action=\"/\">\n        <p>userName</p>\n        <input name=\"userName\" /><br/>\n        <p>nickName</p>\n        <input name=\"nickName\" /><br/>\n        <p>email</p>\n        <input name=\"email\" /><br/>\n        <button type=\"submit\">submit</button>\n      </form>\n    `\n    ctx.body = html\n  } else if ( ctx.url === '/' && ctx.method === 'POST' ) {\n    // 当POST请求的时候，解析POST表单里的数据，并显示出来\n    let postData = await parsePostData( ctx )\n    ctx.body = postData\n  } else {\n    // 其他请求显示404\n    ctx.body = '<h1>404！！！ o(╯□╰)o</h1>'\n  }\n})\n\n// 解析上下文里node原生请求的POST参数\nfunction parsePostData( ctx ) {\n  return new Promise((resolve, reject) => {\n    try {\n      let postdata = \"\";\n      ctx.req.addListener('data', (data) => {\n        postdata += data\n      })\n      ctx.req.addListener(\"end\",function(){\n        let parseData = parseQueryStr( postdata )\n        resolve( parseData )\n      })\n    } catch ( err ) {\n      reject(err)\n    }\n  })\n}\n\n// 将POST请求参数字符串解析成JSON\nfunction parseQueryStr( queryStr ) {\n  let queryData = {}\n  let queryStrList = queryStr.split('&')\n  console.log( queryStrList )\n  for (  let [ index, queryStr ] of queryStrList.entries()  ) {\n    let itemList = queryStr.split('=')\n    queryData[ itemList[0] ] = decodeURIComponent(itemList[1])\n  }\n  return queryData\n}\n\napp.listen(3000, () => {\n  console.log('[demo] request post is starting at port 3000')\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br")])]),a("p",[a("strong",[s._v("使用 "),a("code",[s._v("koa-bodyparser")]),s._v("中间件相关代码")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\nconst bodyParser = require('koa-bodyparser')\n\n// 使用ctx.body解析中间件\napp.use(bodyParser())\n\napp.use( async ( ctx ) => {\n\n  if ( ctx.url === '/' && ctx.method === 'GET' ) {\n    // 当GET请求时候返回表单页面\n    let html = `\n      <h1>koa2 request post demo</h1>\n      <form method=\"POST\" action=\"/\">\n        <p>userName</p>\n        <input name=\"userName\" /><br/>\n        <p>nickName</p>\n        <input name=\"nickName\" /><br/>\n        <p>email</p>\n        <input name=\"email\" /><br/>\n        <button type=\"submit\">submit</button>\n      </form>\n    `\n    ctx.body = html\n  } else if ( ctx.url === '/' && ctx.method === 'POST' ) {\n    // 当POST请求的时候，中间件koa-bodyparser解析POST表单里的数据，并显示出来\n    let postData = ctx.request.body\n    ctx.body = postData\n  } else {\n    // 其他请求显示404\n    ctx.body = '<h1>404！！！ o(╯□╰)o</h1>'\n  }\n})\n\napp.listen(3000, () => {\n  console.log('[demo] request post is starting at port 3000')\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[a("strong",[s._v("启动例子")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node post.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("访问页面")])]),s._v(" "),a("p",[a("img",{attrs:{src:"node03.png",alt:"images"}})]),s._v(" "),a("h3",{attrs:{id:"四、静态资源加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、静态资源加载","aria-hidden":"true"}},[s._v("#")]),s._v(" 四、静态资源加载")]),s._v(" "),a("h4",{attrs:{id:"_4-1-安装·koa-static-中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装·koa-static-中间件","aria-hidden":"true"}},[s._v("#")]),s._v(" 4.1 安装·koa-static 中间件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install --save koa-static\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_4-2-使用例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-使用例子","aria-hidden":"true"}},[s._v("#")]),s._v(" 4.2 使用例子")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst path = require('path')\nconst static = require('koa-static')\n\nconst app = new Koa()\n\n// 静态资源目录对于相对入口文件index.js的路径\nconst staticPath = './static'\n\napp.use(static(\n  path.join( __dirname,  staticPath)\n))\n\n\napp.use( async ( ctx ) => {\n  ctx.body = 'hello world'\n})\n\napp.listen(3000, () => {\n  console.log('[demo] static-use-middleware is starting at port 3000')\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"_4-3-效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-效果","aria-hidden":"true"}},[s._v("#")]),s._v(" 4.3 效果")]),s._v(" "),a("p",[s._v("访问http://localhost:3000")]),s._v(" "),a("p",[a("img",{attrs:{src:"node04.png",alt:"images"}})]),s._v(" "),a("p",[s._v("访问http://localhost:3000/index.html")]),s._v(" "),a("p",[a("img",{attrs:{src:"node05.png",alt:"images"}})]),s._v(" "),a("p",[s._v("访问http://localhost:3000/js/index.js")]),s._v(" "),a("p",[a("img",{attrs:{src:"node06.png",alt:"images"}})]),s._v(" "),a("h3",{attrs:{id:"五、cookie-session"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、cookie-session","aria-hidden":"true"}},[s._v("#")]),s._v(" 五、cookie/session")]),s._v(" "),a("ul",[a("li",[s._v("koa 使用 cookie")]),s._v(" "),a("li",[s._v("koa 使用 session")])]),s._v(" "),a("h4",{attrs:{id:"_5-1-koa-使用-cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-koa-使用-cookie","aria-hidden":"true"}},[s._v("#")]),s._v(" 5.1 koa 使用 cookie")]),s._v(" "),a("p",[a("strong",[s._v("使用方法")])]),s._v(" "),a("p",[s._v("koa 提供了从上下文直接读取、写入 cookie 的方法")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ctx.cookies.get(name, [options])")]),s._v("读取上下文请求中的"),a("code",[s._v("cookie")])]),s._v(" "),a("li",[a("code",[s._v("ctx.cookies.set(name, value, [options])")]),s._v("在上下文中写入"),a("code",[s._v("cookie")])])]),s._v(" "),a("p",[a("strong",[s._v("例子代码")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\n\napp.use( async ( ctx ) => {\n\n  if ( ctx.url === '/index' ) {\n    ctx.cookies.set(\n      'cid',\n      'hello world',\n      {\n        domain: 'localhost',  // 写cookie所在的域名\n        path: '/index',       // 写cookie所在的路径\n        maxAge: 10 * 60 * 1000, // cookie有效时长\n        expires: new Date('2017-02-15'),  // cookie失效时间\n        httpOnly: false,  // 是否只用于http请求中获取\n        overwrite: false  // 是否允许重写\n      }\n    )\n    ctx.body = 'cookie is ok'\n  } else {\n    ctx.body = 'hello world'\n  }\n\n})\n\napp.listen(3000, () => {\n  console.log('[demo] cookie is starting at port 3000')\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[a("strong",[s._v("运行例子")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node index.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("访问http://localhost:3000/index")]),s._v(" "),a("p",[a("img",{attrs:{src:"node07.png",alt:"images"}})]),s._v(" "),a("h4",{attrs:{id:"_5-1-koa-使用-session"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-koa-使用-session","aria-hidden":"true"}},[s._v("#")]),s._v(" 5.1 koa 使用 session")]),s._v(" "),a("p",[s._v("koa2 原生功能只提供了 cookie 的操作，但是没有提供 session 操作。session 就只用自己实现或者通过第三方中间件实现。在 koa2 中实现 session 的方案有一下几种")]),s._v(" "),a("ul",[a("li",[s._v("如果 session 数据量很小，可以直接存在内存中")]),s._v(" "),a("li",[s._v("如果 session 数据量很大，则需要存储介质存放 session 数据")])]),s._v(" "),a("p",[a("strong",[s._v("数据库存储方案")])]),s._v(" "),a("ul",[a("li",[s._v("将 session 存放在 mysql 数据库中")]),s._v(" "),a("li",[s._v("需要用到中间件\n"),a("ul",[a("li",[a("code",[s._v("koa-session-minimal")]),s._v(" 适用于 "),a("code",[s._v("koa2")]),s._v(" 的"),a("code",[s._v("session")]),s._v("中间件，提供存储介质的读写接口 。")]),s._v(" "),a("li",[a("code",[s._v("koa-mysql-session")]),s._v(" 为 "),a("code",[s._v("koa-session-minimal")]),s._v("中间件提供 "),a("code",[s._v("MySQL")]),s._v(" 数据库的 "),a("code",[s._v("session")]),s._v(" 数据读写操作。")]),s._v(" "),a("li",[s._v("将 "),a("code",[s._v("sessionId")]),s._v("和对于的数据存到数据库")])])]),s._v(" "),a("li",[s._v("将数据库的存储的 sessionid 存到页面的 cookie 中")]),s._v(" "),a("li",[s._v("根据 cookie 的 sessionid 去获取对于的 session 信息")])]),s._v(" "),a("p",[a("strong",[s._v("例子代码")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst session = require('koa-session-minimal')\nconst MysqlSession = require('koa-mysql-session')\n\nconst app = new Koa()\n\n// 配置存储session信息的mysql\nlet store = new MysqlSession({\n  user: 'root',\n  password: 'abc123',\n  database: 'koa_demo',\n  host: '127.0.0.1',\n})\n\n// 存放sessionId的cookie配置\nlet cookie = {\n  maxAge: '', // cookie有效时长\n  expires: '',  // cookie失效时间\n  path: '', // 写cookie所在的路径\n  domain: '', // 写cookie所在的域名\n  httpOnly: '', // 是否只用于http请求中获取\n  overwrite: '',  // 是否允许重写\n  secure: '',\n  sameSite: '',\n  signed: '',\n\n}\n\n// 使用session中间件\napp.use(session({\n  key: 'SESSION_ID',\n  store: store,\n  cookie: cookie\n}))\n\napp.use( async ( ctx ) => {\n\n  // 设置session\n  if ( ctx.url === '/set' ) {\n    ctx.session = {\n      user_id: Math.random().toString(36).substr(2),\n      count: 0\n    }\n    ctx.body = ctx.session\n  } else if ( ctx.url === '/' ) {\n\n    // 读取session信息\n    ctx.session.count = ctx.session.count + 1\n    ctx.body = ctx.session\n  }\n\n})\n\napp.listen(3000)\nconsole.log('[demo] session is starting at port 3000')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])]),a("p",[a("strong",[s._v("运行例子")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("node index.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("访问连接设置 session")])]),s._v(" "),a("p",[a("code",[s._v("http://localhost:3000/set")])]),s._v(" "),a("p",[a("img",{attrs:{src:"node08.png",alt:"images"}})]),s._v(" "),a("p",[a("strong",[s._v("查看数据库 session 是否存储")])]),s._v(" "),a("p",[a("img",{attrs:{src:"node09.png",alt:"images"}})]),s._v(" "),a("p",[a("strong",[s._v("查看 cookie 中是否种下了 sessionId")])]),s._v(" "),a("p",[a("code",[s._v("http://localhost:3000")])]),s._v(" "),a("p",[a("img",{attrs:{src:"node10.png",alt:"images"}})]),s._v(" "),a("h3",{attrs:{id:"六、数据库-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、数据库-mysql","aria-hidden":"true"}},[s._v("#")]),s._v(" 六、数据库 mysql")]),s._v(" "),a("ul",[a("li",[s._v("安装 node.js 的 mysql 模块")]),s._v(" "),a("li",[s._v("使用模块")])]),s._v(" "),a("h4",{attrs:{id:"_6-1-安装-node-js-的-mysql-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-安装-node-js-的-mysql-模块","aria-hidden":"true"}},[s._v("#")]),s._v(" 6.1 安装 node.js 的 mysql 模块")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install --save mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_6-2-使用模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-使用模块","aria-hidden":"true"}},[s._v("#")]),s._v(" 6.2 使用模块")]),s._v(" "),a("p",[a("strong",[s._v("创建数据库会话")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const mysql      = require('mysql')\nconst connection = mysql.createConnection({\n  host     : '127.0.0.1',   // 数据库地址\n  user     : 'root',    // 数据库用户\n  password : '123456'   // 数据库密码\n  database : 'my_database'  // 选中数据库\n})\n\n// 执行sql脚本对数据库进行读写\nconnection.query('SELECT * FROM my_table',  (error, results, fields) => {\n  if (error) throw error\n  // connected!\n\n  // 结束会话\n  connection.release()\n});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("blockquote",[a("p",[s._v("注意：一个事件就有一个从开始到结束的过程，数据库会话操作执行完后，就需要关闭掉，以免占用连接资源。")])]),s._v(" "),a("p",[a("strong",[s._v("创建数据连接池")])]),s._v(" "),a("p",[s._v("一般情况下操作数据库是很复杂的读写过程，不只是一个会话，如果直接用会话操作，就需要每次会话都要配置连接参数。所以这时候就需要连接池管理会话。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const mysql = require('mysql')\n\n// 创建数据池\nconst pool  = mysql.createPool({\n  host     : '127.0.0.1',   // 数据库地址\n  user     : 'root',    // 数据库用户\n  password : '123456'   // 数据库密码\n  database : 'my_database'  // 选中数据库\n})\n\n// 在数据池中进行会话操作\npool.getConnection(function(err, connection) {\n\n  connection.query('SELECT * FROM my_table',  (error, results, fields) => {\n\n    // 结束会话\n    connection.release();\n\n    // 如果有错误就抛出\n    if (error) throw error;\n  })\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("ul",[a("li",[s._v("《Koa 与 Node.js 开发实战》")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://chenshenhai.github.io/koa2-note/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Koa2 进阶学习笔记"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.im/post/5db7eaf7f265da4cee4d61b9",target:"_blank",rel:"noopener noreferrer"}},[s._v("KOA2 框架原码解析和实现"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"联系作者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联系作者","aria-hidden":"true"}},[s._v("#")]),s._v(" 联系作者")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("p",[s._v("\n        平凡世界，贵在坚持。\n    ")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/about/contact.png")}})]),s._v("\n````\n")])}),[],!1,null,null,null);n.default=t.exports}}]);