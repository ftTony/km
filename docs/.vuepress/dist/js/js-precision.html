<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js 精度丢失问题 | 小武子知识库</title>
    <meta name="description" content="用心，谈技术。大前端">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/hero.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.23dd1510.css" as="style"><link rel="preload" href="/assets/js/app.6529fce5.js" as="script"><link rel="preload" href="/assets/js/2.c7f5c1a5.js" as="script"><link rel="preload" href="/assets/js/179.96e086f4.js" as="script"><link rel="preload" href="/assets/js/3.fb5a4386.js" as="script"><link rel="prefetch" href="/assets/js/10.b5814c7f.js"><link rel="prefetch" href="/assets/js/100.07b34e28.js"><link rel="prefetch" href="/assets/js/101.aaf69df7.js"><link rel="prefetch" href="/assets/js/102.e0d116ca.js"><link rel="prefetch" href="/assets/js/103.fd760c7d.js"><link rel="prefetch" href="/assets/js/104.efa93c50.js"><link rel="prefetch" href="/assets/js/105.a663e2c2.js"><link rel="prefetch" href="/assets/js/106.4de1bc4f.js"><link rel="prefetch" href="/assets/js/107.77f683d6.js"><link rel="prefetch" href="/assets/js/108.7f903918.js"><link rel="prefetch" href="/assets/js/109.ccfb64f0.js"><link rel="prefetch" href="/assets/js/11.9f2146cd.js"><link rel="prefetch" href="/assets/js/110.69baf038.js"><link rel="prefetch" href="/assets/js/111.f4a4ddb2.js"><link rel="prefetch" href="/assets/js/112.7cc79b77.js"><link rel="prefetch" href="/assets/js/113.219ca296.js"><link rel="prefetch" href="/assets/js/114.fc9a0e06.js"><link rel="prefetch" href="/assets/js/115.7d6c279c.js"><link rel="prefetch" href="/assets/js/116.5ffb42f6.js"><link rel="prefetch" href="/assets/js/117.cb0f1c5f.js"><link rel="prefetch" href="/assets/js/118.ba519744.js"><link rel="prefetch" href="/assets/js/119.9a59fe06.js"><link rel="prefetch" href="/assets/js/12.820effe9.js"><link rel="prefetch" href="/assets/js/120.9fa3daef.js"><link rel="prefetch" href="/assets/js/121.97c6d96d.js"><link rel="prefetch" href="/assets/js/122.63e37ecb.js"><link rel="prefetch" href="/assets/js/123.4cb2fe71.js"><link rel="prefetch" href="/assets/js/124.ab7455d2.js"><link rel="prefetch" href="/assets/js/125.68142a09.js"><link rel="prefetch" href="/assets/js/126.8c2dfe44.js"><link rel="prefetch" href="/assets/js/127.14333582.js"><link rel="prefetch" href="/assets/js/128.7f51e2c1.js"><link rel="prefetch" href="/assets/js/129.aea868bf.js"><link rel="prefetch" href="/assets/js/13.5e1c2c3b.js"><link rel="prefetch" href="/assets/js/130.123af649.js"><link rel="prefetch" href="/assets/js/131.ccea812c.js"><link rel="prefetch" href="/assets/js/132.d751e135.js"><link rel="prefetch" href="/assets/js/133.85eba6f7.js"><link rel="prefetch" href="/assets/js/134.2ca56e4c.js"><link rel="prefetch" href="/assets/js/135.3d0dc0de.js"><link rel="prefetch" href="/assets/js/136.979af491.js"><link rel="prefetch" href="/assets/js/137.47fb8830.js"><link rel="prefetch" href="/assets/js/138.8e52235d.js"><link rel="prefetch" href="/assets/js/139.157715d1.js"><link rel="prefetch" href="/assets/js/14.9311ea11.js"><link rel="prefetch" href="/assets/js/140.d3ad7cb2.js"><link rel="prefetch" href="/assets/js/141.1f308aff.js"><link rel="prefetch" href="/assets/js/142.410a0a2f.js"><link rel="prefetch" href="/assets/js/143.b9ddca62.js"><link rel="prefetch" href="/assets/js/144.6aa9cef5.js"><link rel="prefetch" href="/assets/js/145.50280836.js"><link rel="prefetch" href="/assets/js/146.e8175124.js"><link rel="prefetch" href="/assets/js/147.95d88cb4.js"><link rel="prefetch" href="/assets/js/148.4cc7e38b.js"><link rel="prefetch" href="/assets/js/149.cf7f199d.js"><link rel="prefetch" href="/assets/js/15.56696330.js"><link rel="prefetch" href="/assets/js/150.9222b0a8.js"><link rel="prefetch" href="/assets/js/151.4fe1a0c0.js"><link rel="prefetch" href="/assets/js/152.cb96f39e.js"><link rel="prefetch" href="/assets/js/153.5d5a8c16.js"><link rel="prefetch" href="/assets/js/154.c0477e93.js"><link rel="prefetch" href="/assets/js/155.1e80cfba.js"><link rel="prefetch" href="/assets/js/156.457024e7.js"><link rel="prefetch" href="/assets/js/157.5b66f995.js"><link rel="prefetch" href="/assets/js/158.089d43f8.js"><link rel="prefetch" href="/assets/js/159.191db258.js"><link rel="prefetch" href="/assets/js/16.d145010c.js"><link rel="prefetch" href="/assets/js/160.a0d2441b.js"><link rel="prefetch" href="/assets/js/161.4abb103a.js"><link rel="prefetch" href="/assets/js/162.8a3a6bb5.js"><link rel="prefetch" href="/assets/js/163.2009c4c6.js"><link rel="prefetch" href="/assets/js/164.77eeb0bb.js"><link rel="prefetch" href="/assets/js/165.c3756c0f.js"><link rel="prefetch" href="/assets/js/166.c2389187.js"><link rel="prefetch" href="/assets/js/167.1bbe7c19.js"><link rel="prefetch" href="/assets/js/168.4e92d317.js"><link rel="prefetch" href="/assets/js/169.8ad3c148.js"><link rel="prefetch" href="/assets/js/17.3be8dd29.js"><link rel="prefetch" href="/assets/js/170.1382f599.js"><link rel="prefetch" href="/assets/js/171.bbc53d66.js"><link rel="prefetch" href="/assets/js/172.a858ae69.js"><link rel="prefetch" href="/assets/js/173.8b643c10.js"><link rel="prefetch" href="/assets/js/174.1649f58b.js"><link rel="prefetch" href="/assets/js/175.3245210d.js"><link rel="prefetch" href="/assets/js/176.80655d52.js"><link rel="prefetch" href="/assets/js/177.8aedcffb.js"><link rel="prefetch" href="/assets/js/178.3b11456a.js"><link rel="prefetch" href="/assets/js/18.75358bed.js"><link rel="prefetch" href="/assets/js/180.e9ad2c9d.js"><link rel="prefetch" href="/assets/js/181.5c81e8d3.js"><link rel="prefetch" href="/assets/js/182.7173a8d3.js"><link rel="prefetch" href="/assets/js/183.97e6eced.js"><link rel="prefetch" href="/assets/js/184.4d2aca7a.js"><link rel="prefetch" href="/assets/js/185.d4654be0.js"><link rel="prefetch" href="/assets/js/186.185cfaa0.js"><link rel="prefetch" href="/assets/js/187.3c25a8d4.js"><link rel="prefetch" href="/assets/js/188.181c1eca.js"><link rel="prefetch" href="/assets/js/189.55adb9ad.js"><link rel="prefetch" href="/assets/js/19.c3a0caea.js"><link rel="prefetch" href="/assets/js/190.fa691c1b.js"><link rel="prefetch" href="/assets/js/191.094690d2.js"><link rel="prefetch" href="/assets/js/192.2fd414b2.js"><link rel="prefetch" href="/assets/js/193.d14c8a6d.js"><link rel="prefetch" href="/assets/js/194.0b10a433.js"><link rel="prefetch" href="/assets/js/195.2cb299e9.js"><link rel="prefetch" href="/assets/js/196.2ae9dd0c.js"><link rel="prefetch" href="/assets/js/197.79e2b896.js"><link rel="prefetch" href="/assets/js/198.2039d90f.js"><link rel="prefetch" href="/assets/js/199.ca09b6fd.js"><link rel="prefetch" href="/assets/js/20.b5f5c5d6.js"><link rel="prefetch" href="/assets/js/200.f05420b2.js"><link rel="prefetch" href="/assets/js/201.5230a4ec.js"><link rel="prefetch" href="/assets/js/202.d620158e.js"><link rel="prefetch" href="/assets/js/203.bf23fbe6.js"><link rel="prefetch" href="/assets/js/204.f4bc9385.js"><link rel="prefetch" href="/assets/js/205.dd74947a.js"><link rel="prefetch" href="/assets/js/206.58256ccb.js"><link rel="prefetch" href="/assets/js/207.7c394c4b.js"><link rel="prefetch" href="/assets/js/208.165e675c.js"><link rel="prefetch" href="/assets/js/209.29f1e6e6.js"><link rel="prefetch" href="/assets/js/21.859bd6ba.js"><link rel="prefetch" href="/assets/js/210.9d6896e3.js"><link rel="prefetch" href="/assets/js/211.dfc72431.js"><link rel="prefetch" href="/assets/js/212.24d766e5.js"><link rel="prefetch" href="/assets/js/213.86983dd0.js"><link rel="prefetch" href="/assets/js/214.baf577db.js"><link rel="prefetch" href="/assets/js/215.d26d843b.js"><link rel="prefetch" href="/assets/js/216.6efc7e9b.js"><link rel="prefetch" href="/assets/js/217.9c8fde49.js"><link rel="prefetch" href="/assets/js/218.7747069f.js"><link rel="prefetch" href="/assets/js/219.3475b0ba.js"><link rel="prefetch" href="/assets/js/22.de64cfe2.js"><link rel="prefetch" href="/assets/js/220.0b2980a0.js"><link rel="prefetch" href="/assets/js/221.ec8b6a2a.js"><link rel="prefetch" href="/assets/js/222.7451545b.js"><link rel="prefetch" href="/assets/js/223.0e21ea40.js"><link rel="prefetch" href="/assets/js/224.29fdb762.js"><link rel="prefetch" href="/assets/js/225.e45df331.js"><link rel="prefetch" href="/assets/js/226.8573b86f.js"><link rel="prefetch" href="/assets/js/227.9364c175.js"><link rel="prefetch" href="/assets/js/228.f1a9d35b.js"><link rel="prefetch" href="/assets/js/229.3bd2c4d0.js"><link rel="prefetch" href="/assets/js/23.1995213b.js"><link rel="prefetch" href="/assets/js/230.5702c3ba.js"><link rel="prefetch" href="/assets/js/231.ae9b4aa9.js"><link rel="prefetch" href="/assets/js/232.88c63454.js"><link rel="prefetch" href="/assets/js/233.1f971bd6.js"><link rel="prefetch" href="/assets/js/234.c3def89f.js"><link rel="prefetch" href="/assets/js/235.57936a03.js"><link rel="prefetch" href="/assets/js/236.3ab45163.js"><link rel="prefetch" href="/assets/js/237.d9930664.js"><link rel="prefetch" href="/assets/js/238.9927d8e8.js"><link rel="prefetch" href="/assets/js/239.4ce590f1.js"><link rel="prefetch" href="/assets/js/24.108b175d.js"><link rel="prefetch" href="/assets/js/240.21357ab5.js"><link rel="prefetch" href="/assets/js/241.5ec55658.js"><link rel="prefetch" href="/assets/js/242.d81d04dc.js"><link rel="prefetch" href="/assets/js/243.669f6bac.js"><link rel="prefetch" href="/assets/js/244.c99823dc.js"><link rel="prefetch" href="/assets/js/245.11368b72.js"><link rel="prefetch" href="/assets/js/246.5e14de8f.js"><link rel="prefetch" href="/assets/js/247.3fe2de12.js"><link rel="prefetch" href="/assets/js/248.92e5cf87.js"><link rel="prefetch" href="/assets/js/249.304cf918.js"><link rel="prefetch" href="/assets/js/25.cbf779c4.js"><link rel="prefetch" href="/assets/js/250.dcba46f0.js"><link rel="prefetch" href="/assets/js/251.4a0591b2.js"><link rel="prefetch" href="/assets/js/252.42d6a1aa.js"><link rel="prefetch" href="/assets/js/253.79909f77.js"><link rel="prefetch" href="/assets/js/254.9cce8cdd.js"><link rel="prefetch" href="/assets/js/255.f535d15a.js"><link rel="prefetch" href="/assets/js/256.c1a57f7d.js"><link rel="prefetch" href="/assets/js/257.58cef14b.js"><link rel="prefetch" href="/assets/js/258.f5534db1.js"><link rel="prefetch" href="/assets/js/259.79ea6acf.js"><link rel="prefetch" href="/assets/js/26.880cbbd2.js"><link rel="prefetch" href="/assets/js/260.23bb62c9.js"><link rel="prefetch" href="/assets/js/261.034c67ee.js"><link rel="prefetch" href="/assets/js/262.f04bc63e.js"><link rel="prefetch" href="/assets/js/263.53c7c6f2.js"><link rel="prefetch" href="/assets/js/264.0635c1ca.js"><link rel="prefetch" href="/assets/js/265.51042b43.js"><link rel="prefetch" href="/assets/js/266.2c71498a.js"><link rel="prefetch" href="/assets/js/267.edee6b2f.js"><link rel="prefetch" href="/assets/js/268.303a029e.js"><link rel="prefetch" href="/assets/js/269.d13f85e1.js"><link rel="prefetch" href="/assets/js/27.c78b09fb.js"><link rel="prefetch" href="/assets/js/270.81ee6e4f.js"><link rel="prefetch" href="/assets/js/271.0c663ebb.js"><link rel="prefetch" href="/assets/js/272.21513a4d.js"><link rel="prefetch" href="/assets/js/273.16c742b5.js"><link rel="prefetch" href="/assets/js/274.e22e72eb.js"><link rel="prefetch" href="/assets/js/275.dc846af2.js"><link rel="prefetch" href="/assets/js/276.0d87c813.js"><link rel="prefetch" href="/assets/js/277.53134616.js"><link rel="prefetch" href="/assets/js/278.144809d7.js"><link rel="prefetch" href="/assets/js/279.e1198bd0.js"><link rel="prefetch" href="/assets/js/28.f4626012.js"><link rel="prefetch" href="/assets/js/280.13bba484.js"><link rel="prefetch" href="/assets/js/281.f00812f3.js"><link rel="prefetch" href="/assets/js/282.6be4ecc6.js"><link rel="prefetch" href="/assets/js/283.09719bc4.js"><link rel="prefetch" href="/assets/js/284.8f45d002.js"><link rel="prefetch" href="/assets/js/285.6659c74f.js"><link rel="prefetch" href="/assets/js/286.a44ba711.js"><link rel="prefetch" href="/assets/js/287.9d7ba1f4.js"><link rel="prefetch" href="/assets/js/288.9f3e08a7.js"><link rel="prefetch" href="/assets/js/289.5535e1fb.js"><link rel="prefetch" href="/assets/js/29.d24a5d81.js"><link rel="prefetch" href="/assets/js/290.61bb8713.js"><link rel="prefetch" href="/assets/js/30.75635bb7.js"><link rel="prefetch" href="/assets/js/31.2302d1fc.js"><link rel="prefetch" href="/assets/js/32.b4175245.js"><link rel="prefetch" href="/assets/js/33.43a558f0.js"><link rel="prefetch" href="/assets/js/34.99f1ba44.js"><link rel="prefetch" href="/assets/js/35.053cdcb5.js"><link rel="prefetch" href="/assets/js/36.6040feee.js"><link rel="prefetch" href="/assets/js/37.1da5dac0.js"><link rel="prefetch" href="/assets/js/38.7c890385.js"><link rel="prefetch" href="/assets/js/39.250a000e.js"><link rel="prefetch" href="/assets/js/4.36fa8720.js"><link rel="prefetch" href="/assets/js/40.6a2a49d8.js"><link rel="prefetch" href="/assets/js/41.539e0258.js"><link rel="prefetch" href="/assets/js/42.bf78cf53.js"><link rel="prefetch" href="/assets/js/43.94b1feb1.js"><link rel="prefetch" href="/assets/js/44.3d866a5e.js"><link rel="prefetch" href="/assets/js/45.a43c08ab.js"><link rel="prefetch" href="/assets/js/46.3708c582.js"><link rel="prefetch" href="/assets/js/47.08d4e6fa.js"><link rel="prefetch" href="/assets/js/48.b04c304f.js"><link rel="prefetch" href="/assets/js/49.1ab5dff6.js"><link rel="prefetch" href="/assets/js/5.162e5946.js"><link rel="prefetch" href="/assets/js/50.24f8b1cb.js"><link rel="prefetch" href="/assets/js/51.f37ba477.js"><link rel="prefetch" href="/assets/js/52.1ac6baba.js"><link rel="prefetch" href="/assets/js/53.70ec05dc.js"><link rel="prefetch" href="/assets/js/54.17b9181e.js"><link rel="prefetch" href="/assets/js/55.c725f32e.js"><link rel="prefetch" href="/assets/js/56.3c41f3b7.js"><link rel="prefetch" href="/assets/js/57.8e4f2e95.js"><link rel="prefetch" href="/assets/js/58.91c3f015.js"><link rel="prefetch" href="/assets/js/59.edd958db.js"><link rel="prefetch" href="/assets/js/6.3ee933b5.js"><link rel="prefetch" href="/assets/js/60.d596573c.js"><link rel="prefetch" href="/assets/js/61.40bab83b.js"><link rel="prefetch" href="/assets/js/62.10d81f0c.js"><link rel="prefetch" href="/assets/js/63.6673e5af.js"><link rel="prefetch" href="/assets/js/64.5272ede2.js"><link rel="prefetch" href="/assets/js/65.7f84613c.js"><link rel="prefetch" href="/assets/js/66.ec783047.js"><link rel="prefetch" href="/assets/js/67.61586354.js"><link rel="prefetch" href="/assets/js/68.f09c7ab8.js"><link rel="prefetch" href="/assets/js/69.89857c7f.js"><link rel="prefetch" href="/assets/js/7.66fedf66.js"><link rel="prefetch" href="/assets/js/70.425986e7.js"><link rel="prefetch" href="/assets/js/71.d844f970.js"><link rel="prefetch" href="/assets/js/72.297bd597.js"><link rel="prefetch" href="/assets/js/73.a956bc4a.js"><link rel="prefetch" href="/assets/js/74.f886caf8.js"><link rel="prefetch" href="/assets/js/75.fbb56272.js"><link rel="prefetch" href="/assets/js/76.9b447e16.js"><link rel="prefetch" href="/assets/js/77.58334735.js"><link rel="prefetch" href="/assets/js/78.67b641da.js"><link rel="prefetch" href="/assets/js/79.21691a0a.js"><link rel="prefetch" href="/assets/js/8.2d5e4b34.js"><link rel="prefetch" href="/assets/js/80.c8400077.js"><link rel="prefetch" href="/assets/js/81.5f03df86.js"><link rel="prefetch" href="/assets/js/82.f9732f33.js"><link rel="prefetch" href="/assets/js/83.57993181.js"><link rel="prefetch" href="/assets/js/84.b5fd2be3.js"><link rel="prefetch" href="/assets/js/85.d75f0c5e.js"><link rel="prefetch" href="/assets/js/86.7b03b410.js"><link rel="prefetch" href="/assets/js/87.3dcecbe5.js"><link rel="prefetch" href="/assets/js/88.a04c1b66.js"><link rel="prefetch" href="/assets/js/89.e9f54a72.js"><link rel="prefetch" href="/assets/js/9.797e3d02.js"><link rel="prefetch" href="/assets/js/90.07e85482.js"><link rel="prefetch" href="/assets/js/91.ac9d2561.js"><link rel="prefetch" href="/assets/js/92.d0963eac.js"><link rel="prefetch" href="/assets/js/93.d24b4985.js"><link rel="prefetch" href="/assets/js/94.241c0409.js"><link rel="prefetch" href="/assets/js/95.e0e479d1.js"><link rel="prefetch" href="/assets/js/96.85eb7fce.js"><link rel="prefetch" href="/assets/js/97.04de0d3f.js"><link rel="prefetch" href="/assets/js/98.6dc12b9b.js"><link rel="prefetch" href="/assets/js/99.3d19a8ef.js">
    <link rel="stylesheet" href="/assets/css/0.styles.23dd1510.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小武子知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">
  javascript
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/html5/" class="nav-link">
  HTML5
</a></div><div class="nav-item"><a href="/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/project/" class="nav-link">
  软件工程
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/materials/" class="nav-link">
  资料收集
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于作者
</a></div><div class="nav-item"><a href="https://www.github.com/fttony" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/js/" class="nav-link router-link-active">
  javascript
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/html5/" class="nav-link">
  HTML5
</a></div><div class="nav-item"><a href="/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/project/" class="nav-link">
  软件工程
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/materials/" class="nav-link">
  资料收集
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于作者
</a></div><div class="nav-item"><a href="https://www.github.com/fttony" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>javascript基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/es5-expression.html" class="sidebar-link">表达式与运算符</a></li><li><a href="/js/es5-type.html" class="sidebar-link">JS 数据类型与数据类型转换</a></li><li><a href="/js/es5-prototype.html" class="sidebar-link">原型与原型链</a></li><li><a href="/js/es5-this.html" class="sidebar-link">this 解析</a></li><li><a href="/js/es5-closure.html" class="sidebar-link">闭包</a></li><li><a href="/js/es5-apply-call-bind.html" class="sidebar-link">apply&amp;bind&amp;call</a></li><li><a href="/js/es5-dom.html" class="sidebar-link">DOM与BOM</a></li><li><a href="/js/es5-event.html" class="sidebar-link">JS事件</a></li><li><a href="/js/es5-execution-context.html" class="sidebar-link">执行上下文与执行上下文栈</a></li><li><a href="/js/es5-extends.html" class="sidebar-link">继承</a></li><li><a href="/js/es5-fn.html" class="sidebar-link">函数</a></li><li><a href="/js/es5-news.html" class="sidebar-link">new 理解</a></li><li><a href="/js/es5-array.html" class="sidebar-link">数组</a></li><li><a href="/js/es5-object.html" class="sidebar-link">对象</a></li><li><a href="/js/es5-reg.html" class="sidebar-link">正则表达式学习</a></li><li><a href="/js/es5-scope.html" class="sidebar-link">作用域</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>javascript进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/js-clone.html" class="sidebar-link">JS的浅拷贝与深拷贝</a></li><li><a href="/js/js-curry.html" class="sidebar-link">函数柯理化</a></li><li><a href="/js/js-debounce.html" class="sidebar-link">节流与防抖动</a></li><li><a href="/js/js-precision.html" class="active sidebar-link">js 精度丢失问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/js-precision.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/js/js-precision.html#内容" class="sidebar-link">内容</a></li><li class="sidebar-sub-header"><a href="/js/js-precision.html#联系作者" class="sidebar-link">联系作者</a></li></ul></li><li><a href="/js/js-memory.html" class="sidebar-link">js 内存管理</a></li><li><a href="/js/js-memory-1.html" class="sidebar-link">JS 内存泄漏、监控和分析</a></li><li><a href="/js/js-async.html" class="sidebar-link">事件循环和异步编程的崛起</a></li><li><a href="/js/js-bit.html" class="sidebar-link">js 位运算</a></li><li><a href="/js/js-eventloop.html" class="sidebar-link">理解 EventLoop</a></li><li><a href="/js/js-module.html" class="sidebar-link">js 模块化</a></li><li><a href="/js/js-run.html" class="sidebar-link">javascript 执行过程</a></li><li><a href="/js/js-ast.html" class="sidebar-link">解析、抽象语法树（AST）+ 提升编译速度 5 个技巧</a></li><li><a href="/js/js-v8.html" class="sidebar-link">V8 简介</a></li><li><a href="/js/js-principle.html" class="sidebar-link">JS 编译器，解释引擎</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>es6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/es6-array.html" class="sidebar-link">数组扩展</a></li><li><a href="/js/es6-fn.html" class="sidebar-link">函数扩展</a></li><li><a href="/js/es6-class-1.html" class="sidebar-link">Class 基本用法</a></li><li><a href="/js/es6-class-2.html" class="sidebar-link">Class 继承</a></li><li><a href="/js/es6-async.html" class="sidebar-link">async 函数</a></li><li><a href="/js/es6-generator-1.html" class="sidebar-link">Generator 函数的语法</a></li><li><a href="/js/es6-generator-2.html" class="sidebar-link">Generator 函数的异步应用</a></li><li><a href="/js/es6-iterator.html" class="sidebar-link">Iterator 和 for...of 循环</a></li><li><a href="/js/es6-let-const.html" class="sidebar-link">let 与 const</a></li><li><a href="/js/es6-module.html" class="sidebar-link">Module 对象</a></li><li><a href="/js/es6-number.html" class="sidebar-link">数值扩展</a></li><li><a href="/js/es6-object.html" class="sidebar-link">对象扩展</a></li><li><a href="/js/es6-promise.html" class="sidebar-link">Promise 对象</a></li><li><a href="/js/es6-proxy-reflect.html" class="sidebar-link">Proxy 和 Reflect</a></li><li><a href="/js/es6-set-map.html" class="sidebar-link">Set和Map数据结构</a></li><li><a href="/js/es6-string.html" class="sidebar-link">字符串扩展</a></li><li><a href="/js/es6-symbol.html" class="sidebar-link">Symbol</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/ts-introduct.html" class="sidebar-link">ts 学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>nodejs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/node-introdect.html" class="sidebar-link">node 介绍</a></li><li><a href="/js/node-eventloop.html" class="sidebar-link">Node 的事件循环机制</a></li><li><a href="/js/node-buffer.html" class="sidebar-link">buffer 模块</a></li><li><a href="/js/node-cheerio.html" class="sidebar-link">cheerio 模块</a></li><li><a href="/js/node-cluster.html" class="sidebar-link">cluster 集群</a></li><li><a href="/js/node-egg.html" class="sidebar-link">egg 基础应用</a></li><li><a href="/js/node-events.html" class="sidebar-link">events 模块</a></li><li><a href="/js/node-express.html" class="sidebar-link">express 基础应用</a></li><li><a href="/js/node-fs.html" class="sidebar-link">fs 模块</a></li><li><a href="/js/node-http.html" class="sidebar-link">http 模块</a></li><li><a href="/js/node-rpc.html" class="sidebar-link">RPC 调用</a></li><li><a href="/js/node-koa.html" class="sidebar-link">koa 基础应用</a></li><li><a href="/js/node-koa-code.html" class="sidebar-link">koa 源码分析</a></li><li><a href="/js/node-net.html" class="sidebar-link">net 模块</a></li><li><a href="/js/node-process.html" class="sidebar-link">process 进程</a></li><li><a href="/js/node-querystring.html" class="sidebar-link">querystring 模块</a></li><li><a href="/js/node-stream.html" class="sidebar-link">stream 模块</a></li><li><a href="/js/node-queue.html" class="sidebar-link">node.js 中的消息队列</a></li><li><a href="/js/node-url.html" class="sidebar-link">url 模块</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/mvvm.html" class="sidebar-link">mvvm 框架介绍</a></li><li><a href="/js/jquery-code.html" class="sidebar-link">jquery 源码分析</a></li><li><a href="/js/undescore.html" class="sidebar-link">undescore 源码分析</a></li><li><a href="/js/vue-jsx.html" class="sidebar-link">Vue 中使用 JSX</a></li><li><a href="/js/vue-lifecycle.html" class="sidebar-link">Vue 生命周期</a></li><li><a href="/js/vue-keep.html" class="sidebar-link">keep-alive 学习</a></li><li><a href="/js/vue-dom.html" class="sidebar-link">虚拟 DOM 解析</a></li><li><a href="/js/vue-communication.html" class="sidebar-link">vue 组件通信</a></li><li><a href="/js/vue-bind.html" class="sidebar-link">vue 双向数据绑定原理</a></li><li><a href="/js/vue-nexttick.html" class="sidebar-link">Vue.netTick 理解与分析</a></li><li><a href="/js/vue-watch.html" class="sidebar-link">Vue 中的 computed,watch,methods 理解与分析</a></li><li><a href="/js/vue-router.html" class="sidebar-link">vue-router 学习及原理</a></li><li><a href="/js/vue-router-code.html" class="sidebar-link">vue-router 源码分析</a></li><li><a href="/js/vue-vuex.html" class="sidebar-link">vuex 学习及原理</a></li><li><a href="/js/vue-vuex-code.html" class="sidebar-link">vue-vuex 源码分析</a></li><li><a href="/js/vue-code.html" class="sidebar-link">vue 源码分析</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-精度丢失问题"><a href="#js-精度丢失问题" class="header-anchor">#</a> js 精度丢失问题</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>众所周知，JavaScript 浮点数运算时经常遇到会<code>0.000000001</code>和<code>0.999999999</code>这样奇怪的结果，如<code>0.1+0.2=0.30000000000000004</code>、<code>1-0.9=0.09999999999999998</code>，出现这种问题到底是为什么？</p> <h2 id="内容"><a href="#内容" class="header-anchor">#</a> 内容</h2> <ul><li><a href="#%E4%B8%80%E3%80%81javascript%E6%98%AF%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E6%95%B0%E5%AD%97%E7%9A%84%EF%BC%9F">JavaScript 是如何表示数字的？</a></li> <li><a href="#%E4%BA%8C%E3%80%81%E8%BF%90%E7%AE%97%E6%97%B6%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F">运算时发生了什么？</a></li> <li><a href="#%E4%B8%89%E3%80%81%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98%EF%BC%9F">怎么解决精度问题？</a></li></ul> <h3 id="一、javascript-是如何表示数字的？"><a href="#一、javascript-是如何表示数字的？" class="header-anchor">#</a> 一、JavaScript 是如何表示数字的？</h3> <p>JavaScript 使用 Number 类型表示数字（整数和浮点数），遵循<a href="https://zh.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noopener noreferrer">IEEE 754<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>标准通过 64 位来表示一个数字，也就是标准的 double 双精度浮点数（相关的还有 float 32 位单精度）。</p> <p>这样的存储结构优点是可以归一化处理整数和小数，节省存储空间。</p> <p>64 位比特双可以三个部分：</p> <ul><li>符号位 S：第 1 位是正负数符号位(sign)，0 代表正数，1 代表负数</li> <li>指数位 E：中间的 11 位存储指数(exponent),用来表示次方数</li> <li>尾数位 M：最后的 52 位是尾数(mantissa)，储存小数部分，超出的部分自动进一舍零</li></ul> <p><img src="precision.png" alt=""></p> <p>实际数字就可以用以下公式来计算：</p> <p><img src="precision01.png" alt=""></p> <p>对于 64 位的双精度浮点数，最高的 1 位是符号位 S，接着的 11 位是指数 E，剩下的 52 位为有效数字 M。</p> <table><thead><tr><th>位数</th> <th>阶数</th> <th>有效数字/尾数</th></tr></thead> <tbody><tr><td>单精度浮点数</td> <td>32</td> <td>8</td></tr> <tr><td>双精度浮点数</td> <td>64</td> <td>11</td></tr></tbody></table> <h3 id="二、运算时发生了什么？"><a href="#二、运算时发生了什么？" class="header-anchor">#</a> 二、运算时发生了什么？</h3> <p>计算机无法直接对十进制的数字进行运算，这是硬件物理特性已经决定的。这样去运算分成了两个部分：<strong>先按照 IEEE754 转成相应的二进制，然后对阶运算</strong></p> <ul><li><a href="#_2-1-%E6%B5%AE%E7%82%B9%E6%95%B0%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BA%8C%E8%BF%9B%E5%88%B6">浮点数转换为二进制</a></li> <li><a href="#_2-2-0-1%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6">0.1 的二进制</a></li> <li><a href="#_2-3-0-2%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6">0.2 的二进制</a></li> <li><a href="#_2-4-0-1-0-2%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6">0.1+0.2 的二进制</a></li></ul> <h4 id="_2-1-浮点数转换为二进制"><a href="#_2-1-浮点数转换为二进制" class="header-anchor">#</a> 2.1 浮点数转换为二进制</h4> <p>浮点数转换成二进制，我们要将整数部分和小数部分分开，整数部分采用除 2 取余，小数部分采用乘 2 取整。</p> <p>例如：13.125 转换为二进制：</p> <p><strong>整数部分</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
        13
    ÷   2
--------------       ↑
        6    1       |
    ÷   2            |
--------------       |
        3    0       |
    ÷   2            |
--------------       |
        1    1       |
    ÷   2            |
--------------       |
        0    1    ----
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>逆序将余数拼上得到 13 的二进制：1101</p> <p><strong>小数部分</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>        0.125
    x       2        ----
-----------------       |
        0.25    0       |
    x      2            |
-----------------       |
        0.5     0       |
    x     2             |
-----------------       |
        1.0     1       ↓

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>得到小数部分的二进制：0.001</p> <p>两部分相加，得到 13.125 的二进制：<code>1101.001</code></p> <p>二进制 <code>1101.001</code>可以写成 <code>1.101001 * 2^3</code>，即这里 M 为 <code>1.101001</code>,E 为 3,s 为 0</p> <h4 id="_2-2-0-1-的二进制"><a href="#_2-2-0-1-的二进制" class="header-anchor">#</a> 2.2 0.1 的二进制</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>    0.1
x     2
-------
    0.2     0
x     2
-------
    0.4     0
x     2
-------
    0.8     0
x     2
-------
    0.6     1
x     2
-------
    0.2     1
------- 又从0.2开始循环了

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>于是，我们得到了 0.1 的二进制表示，即为<code>0.0001100110011(0011循环)</code>，即<code>1.100110011(0011)*2^-4</code>，即，M 1.100110011(0011),E -4,那么，s=0,e=-4+1023=1019,那么，js 中由于是双精度的，那么 0.1 的表示为</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>0  01111111011  1001100110011001100110011001100110011001100110011001
--------------------------------------------------------------------
s  exp(11位)     frac(52位)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_2-3-0-2-的二进制"><a href="#_2-3-0-2-的二进制" class="header-anchor">#</a> 2.3 0.2 的二进制</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>    0.2
x     2
-------
    0.4     0
x     2
-------
    0.8     0
x     2
-------
    0.6     1
x     2
-------
    0.2     1
------- 又从0.2开始循环了

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>0.2 的二进制表示：0.001100110011(0011 循环)，即 1.100110011(0011)*2^-3
那么，js 双精度 0.2 的表示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>0  01111111100  1001100110011001100110011001100110011001100110011001

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-4-0-1-0-2-的二进制"><a href="#_2-4-0-1-0-2-的二进制" class="header-anchor">#</a> 2.4 0.1+0.2 的二进制</h4> <p>浮点数的加减运算一般由以下五个步骤完成：</p> <ul><li>对阶</li> <li>尾数运算</li> <li>结果处理</li> <li>舍入处理</li> <li>溢出判断</li></ul> <p><strong>对阶</strong></p> <p>将两个进行运算的浮点数的阶码对齐的操作。对阶的目的是为使两个浮点数的尾数能够进行加减运算。因为，当进行 Mx·2Ex 与 My·2Ey 加减运算时，只有使两浮点数的指数值部分相同，才能将相同的指数值作为公因数提出来，然后进行尾数的加减运算。
对阶的具体方法是：首先求出两浮点数阶码的差，即 ⊿E ＝ Ex-Ey，将小阶码加上 ⊿E，使之与大阶码相等，同时将小阶码对应的浮点数的尾数右移相应位数，以保证该浮点数的值不变。几点注意：</p> <ol><li>对阶的原则是小阶对大阶，之所以这样做是因为若大阶对小阶，则尾数的数值部分的高位需移出，而小阶对大阶移出的是尾数的数值部分的低位，这样损失的精度更小。</li> <li>若 ⊿E ＝ 0，说明两浮点数的阶码已经相同，无需再做对阶操作了。</li> <li>采用补码表示的尾数右移时，符号位保持不变。</li> <li>由于尾数右移时是将最低位移出，会损失一定的精度，为减少误差，可先保留若干移出的位，供以后舍入处理用。</li></ol> <p><strong>尾数运算</strong></p> <p>尾数运算就是进行完成对阶后的尾数相加减。这里采用的就是我们前面讲过的纯小数的定点数加减运算。</p> <p><strong>结果规格化</strong></p> <p>在机器中，为保证浮点数表示的唯一性，浮点数在机器中都是以规格化形式存储的。对于 IEEE754 标准的浮点数来说，就是尾数必须是 1.M 的形式。由于在进行上述两个定点小数的尾数相加减运算后，尾数有可能是非规格化形式，为此必须进行规格化操作。 规格化操作包括左规和右规两种情况。 左规操作：将尾数左移，同时阶码减值，直至尾数成为 1.M 的形式。例如，浮点数 0.0011·25 是非规格化的形式，需进行左规操作，将其尾数左移 3 位，同时阶码减 3，就变成 1.1100·22 规格化形式了。 右规操作：将尾数右移 1 位，同时阶码增 1，便成为规格化的形式了。要注意的是，右规操作只需将尾数右移一位即可，这种情况出现在尾数的最高位（小数点前一位）运算时出现了进位，使尾数成为 10.xxxx 或 11.xxxx 的形式。例如，10.0011·25 右规一位后便成为
1.00011·26 的规格化形式了。</p> <p><strong>舍入处理</strong></p> <p>浮点运算在对阶或右规时，尾数需要右移，被右移出去的位会被丢掉，从而造成运算结果精度的损失。为了减少这种精度损失，可以将一定位数的移出位先保留起来，称为保护位，在规格化后用于舍入处理。 IEEE754 标准列出了四种可选的舍入处理方法：</p> <ol><li>就近舍入（round to nearest） 这是标准列出的默认舍入方式，其含义相当于我们日常所说的“四舍五入”。例如，对于 32 位单精度浮点数来说，若超出可保存的 23 位的多余位大于等于 100…01，则多余位的值超过了最低可表示位值的一半，这种情况下，舍入的方法是在尾数的最低有效位上加 1；若多余位小于等于 011…11，则直接舍去；若多余位为 100…00，此时再判断尾数的最低有效位的值，若为 0 则直接舍去，若为 1 则再加 1。</li> <li>朝+∞ 舍入（round toward +∞） 对正数来说，只要多余位不为全 0，则向尾数最低有效位进 1；对负数来说，则是简单地舍去。</li> <li>朝-∞ 舍入（round toward -∞） 与朝+∞ 舍入方法正好相反，对正数来说，只是简单地舍去；对负数来说，只要多余位不为全 0，则向尾数最低有效位进 1。</li> <li>朝 0 舍入（round toward 0） 即简单地截断舍去，而不管多余位是什么值。这种方法实现简单，但容易形成累积误差，且舍入处理后的值总是向下偏差。</li></ol> <p><strong>溢出判断</strong></p> <p>与定点数运算不同的是，浮点数的溢出是以其运算结果的阶码的值是否产生溢出来判断的。若阶码的值超过了阶码所能表示的最大正数，则为上溢，进一步，若此时浮点数为正数，则为正上溢，记为+∞，若浮点数为负数，则为负上溢，记为-∞；若阶码的值超过了阶码所能表示的最小负数，则为下溢，进一步，若此时浮点数为正数，则为正下溢，若浮点数为负数，则为负下溢。正下溢和负下溢都作为 0 处理。</p> <p><strong>计算 0.1+0.2</strong></p> <p>0.1 的阶码-4,0.2 的阶码-3,对阶阶段，将 0.1 的阶码变为-3，然后 0.1 的尾数部分：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> 0.00011001100110011001100110011001100110011001100110011010
+0.00110011001100110011001100110011001100110011001100110100
------------------------------------------------------------
=0.01001100110011001100110011001100110011001100110011001110

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>该数表示的即 0.1+0.2 的结果 <code>2^-2 * 1.0011001100110011001100110011001100110011001100110100</code>
将其转换成十进制数为：<code>0.3000000000000000444089209850062616169452667236328125</code>
由于精度问题，只取到<code>0.30000000000000004</code></p> <h3 id="三、怎么解决精度问题？"><a href="#三、怎么解决精度问题？" class="header-anchor">#</a> 三、怎么解决精度问题？</h3> <ul><li><a href="#_3-1-%E7%B1%BB%E5%BA%93">类库</a></li> <li><a href="#_3-2-%E8%A7%A3%E5%86%B3tofixed">解决 toFixed</a></li> <li><a href="#_3-3-%E6%B5%AE%E7%82%B9%E6%95%B0%E8%BF%90%E7%AE%97%E7%B2%BE%E5%BA%A6">浮点数运算精度</a></li> <li><a href="#_3-4-es6">ES6</a></li></ul> <h4 id="_3-1-类库"><a href="#_3-1-类库" class="header-anchor">#</a> 3.1 类库</h4> <p>NPM 上有许多支持 JavaScript 和 Node.js 的数学库，比如<code>Math.js</code>，<code>decimal.js</code>，<code>D.js</code>等等。</p> <h4 id="_3-2-解决-tofixed"><a href="#_3-2-解决-tofixed" class="header-anchor">#</a> 3.2 解决 toFixed</h4> <p>针对 toFixed 的兼容性问题，我们可以把 toFix 重写一下来解决，代码如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Number.prototype.toFixed = function(len){
    if(len&gt;20 || len&lt;0){
        throw new RangeError('toFixed() digits argument must be between 0 and 20');
    }
    // .12转为.0.123
    var number = Number(this);
    if(isNaN(number) || number &gt;= Math.pow(10,21)){
        return number.toString();
    }
    if(typeof(len) == 'unefined' || len === 0){
        return (Math.round(number)).toString();
    }
    var result = number.toString(),
        numberArr = result.split('.');

    if(numberArr.length&lt;2){
        // 需要截取的长度等于当前长度
        return result;
    }

    if(deciNum.length &lt; len){
        //需要截取的长度大于当前长度 1.3.toFixed(2)
        return padNum(result)
    }
    //需要截取的长度小于当前长度，需要判断最后一位数字
    result = intNum + '.' + deciNum.substr(0, len);
    if(parseInt(lastNum, 10)&gt;=5){
        //最后一位数字大于5，要进位
        var times = Math.pow(10, len); //需要放大的倍数
        var changedInt = Number(result.replace('.',''));//截取后转为整数
        changedInt++;//整数进位
        changedInt /= times;//整数转为小数，注：有可能还是整数
        result = padNum(changedInt+'');
    }
    return result;
    //对数字末尾加0
    function padNum(num){
        var dotPos = num.indexOf('.');
        if(dotPos === -1){
            //整数的情况
            num += '.';
            for(var i = 0;i&lt;len;i++){
                num += '0';
            }
            return num;
        } else {
            //小数的情况
            var need = len - (num.length - dotPos - 1);
            for(var j = 0;j&lt;need;j++){
                num += '0';
            }
            return num;
        }
    }
}


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>我们通过判断最后一位是否大于等于 5 来决定需不需要进位，如果需要进位先把小数乘以倍数变为整数，加 1 之后，再除以倍数变为小数，这样就不用一位一位的进行判断。</p> <h4 id="_3-3-浮点数运算精度"><a href="#_3-3-浮点数运算精度" class="header-anchor">#</a> 3.3 浮点数运算精度</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>function add(num1,num2){
    const num1Digits = (num1.toString().split('.')[1] || '').length;
    const num2Digits = (num2.toString().split('.')[1] || '').length;
    const baseNum = Math.pow(10,Math.max(num1Digits,num2Digits));
    return (num1 * baseNum + num2 * baseNum) / baseNum;
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3-4-es6"><a href="#_3-4-es6" class="header-anchor">#</a> 3.4 ES6</h4> <p>ES6 在 Number 对象上新增了一个极小的常量——Number.EPSILON，引入一个这么小的量，目的在于为浮点数计算设置一个误差范围，如果误差能够小于 Number.EPSILON，我们就可以认为结果是可靠的。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>function withinErrorMargin(left,right){
    return Math.abs(left-right)&lt; Number.EPSILON
}

withinErrorMargin(0.1+0.2,0.3)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h3> <ul><li><a href="https://juejin.im/post/5b90e00e6fb9a05cf9080dff" target="_blank" rel="noopener noreferrer">0.1 + 0.2 不等于 0.3？为什么 JavaScript 有这种“骚”操作？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.barretlee.com/blog/2016/09/28/ieee754-operation-in-js/" target="_blank" rel="noopener noreferrer">揭秘 0.1 + 0.2 != 0.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://coolcao.com/2016/10/12/js%E4%B8%AD0-1-0-2%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%AD%89%E4%BA%8E0-3/" target="_blank" rel="noopener noreferrer">js 中 0.1+0.2 为什么不等于 0.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/camsong/blog/issues/9" target="_blank" rel="noopener noreferrer">JavaScript 浮点数陷阱及解法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/fsjohnhuang/p/5115672.html" target="_blank" rel="noopener noreferrer">JS 魔法堂：彻底理解 0.1 + 0.2 === 0.30000000000000004 的背后<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5ddc7fa66fb9a07ad665b1f0" target="_blank" rel="noopener noreferrer">JavaScript 加减危机 —— 为什么会出现这样的结果？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s/0D6melRtJYwv_XBfq8wSvg" target="_blank" rel="noopener noreferrer">JavaScript 浮点数之迷：0.1 + 0.2 为什么不等于 0.3？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="联系作者"><a href="#联系作者" class="header-anchor">#</a> 联系作者</h2> <div align="center"><p>
        平凡世界，贵在坚持。
    </p> <img src="/about/contact.png"></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">2017/7/21 下午6:59:33</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/js-debounce.html" class="prev">
        节流与防抖动
      </a></span> <span class="next"><a href="/js/js-memory.html">
        js 内存管理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><div></div></div></div>
    <script src="/assets/js/app.6529fce5.js" defer></script><script src="/assets/js/2.c7f5c1a5.js" defer></script><script src="/assets/js/179.96e086f4.js" defer></script><script src="/assets/js/3.fb5a4386.js" defer></script>
  </body>
</html>
