<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XSS 攻击 | 小武子知识库</title>
    <meta name="description" content="用心，谈技术。大前端">
    <link rel="icon" href="/hero.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.63e2627a.css" as="style"><link rel="preload" href="/assets/js/app.15e91dcf.js" as="script"><link rel="preload" href="/assets/js/2.d829aec4.js" as="script"><link rel="preload" href="/assets/js/175.8f70bce9.js" as="script"><link rel="preload" href="/assets/js/3.7b1884f5.js" as="script"><link rel="prefetch" href="/assets/js/10.cebcff48.js"><link rel="prefetch" href="/assets/js/100.5d0cfbdb.js"><link rel="prefetch" href="/assets/js/101.d90c6d30.js"><link rel="prefetch" href="/assets/js/102.970e3761.js"><link rel="prefetch" href="/assets/js/103.d43ad104.js"><link rel="prefetch" href="/assets/js/104.697c8a1c.js"><link rel="prefetch" href="/assets/js/105.8e8821e5.js"><link rel="prefetch" href="/assets/js/106.1a2a4fa5.js"><link rel="prefetch" href="/assets/js/107.d03f1238.js"><link rel="prefetch" href="/assets/js/108.0269e2d6.js"><link rel="prefetch" href="/assets/js/109.93b4edf1.js"><link rel="prefetch" href="/assets/js/11.30d63bfb.js"><link rel="prefetch" href="/assets/js/110.10aceb14.js"><link rel="prefetch" href="/assets/js/111.92e1c6fd.js"><link rel="prefetch" href="/assets/js/112.468f86ae.js"><link rel="prefetch" href="/assets/js/113.0b4d88ed.js"><link rel="prefetch" href="/assets/js/114.8bbb04ae.js"><link rel="prefetch" href="/assets/js/115.185e9625.js"><link rel="prefetch" href="/assets/js/116.51ae6d91.js"><link rel="prefetch" href="/assets/js/117.29c05be7.js"><link rel="prefetch" href="/assets/js/118.c161a59a.js"><link rel="prefetch" href="/assets/js/119.999a8aac.js"><link rel="prefetch" href="/assets/js/12.64e4114b.js"><link rel="prefetch" href="/assets/js/120.64f1dcb4.js"><link rel="prefetch" href="/assets/js/121.1da5d36b.js"><link rel="prefetch" href="/assets/js/122.f8a409cd.js"><link rel="prefetch" href="/assets/js/123.94f1c056.js"><link rel="prefetch" href="/assets/js/124.782cb7b6.js"><link rel="prefetch" href="/assets/js/125.aa51ad4e.js"><link rel="prefetch" href="/assets/js/126.732beca0.js"><link rel="prefetch" href="/assets/js/127.bb13e33f.js"><link rel="prefetch" href="/assets/js/128.21706159.js"><link rel="prefetch" href="/assets/js/129.ec48cc80.js"><link rel="prefetch" href="/assets/js/13.7f75093d.js"><link rel="prefetch" href="/assets/js/130.d03590fa.js"><link rel="prefetch" href="/assets/js/131.e5bc987a.js"><link rel="prefetch" href="/assets/js/132.3fc0c3a8.js"><link rel="prefetch" href="/assets/js/133.f701fa23.js"><link rel="prefetch" href="/assets/js/134.5ba610ba.js"><link rel="prefetch" href="/assets/js/135.1af319de.js"><link rel="prefetch" href="/assets/js/136.7c20f5bb.js"><link rel="prefetch" href="/assets/js/137.0d3f6b01.js"><link rel="prefetch" href="/assets/js/138.e9c8c240.js"><link rel="prefetch" href="/assets/js/139.c1af0c6a.js"><link rel="prefetch" href="/assets/js/14.b2cb9de8.js"><link rel="prefetch" href="/assets/js/140.aa970ab4.js"><link rel="prefetch" href="/assets/js/141.e6492838.js"><link rel="prefetch" href="/assets/js/142.9212e5fd.js"><link rel="prefetch" href="/assets/js/143.2e07dbf9.js"><link rel="prefetch" href="/assets/js/144.e914aeae.js"><link rel="prefetch" href="/assets/js/145.6de5039f.js"><link rel="prefetch" href="/assets/js/146.f04dac4d.js"><link rel="prefetch" href="/assets/js/147.9d0deb56.js"><link rel="prefetch" href="/assets/js/148.c7bb17cd.js"><link rel="prefetch" href="/assets/js/149.89d1622f.js"><link rel="prefetch" href="/assets/js/15.75825087.js"><link rel="prefetch" href="/assets/js/150.fdd55d5b.js"><link rel="prefetch" href="/assets/js/151.0931ca04.js"><link rel="prefetch" href="/assets/js/152.35f5646c.js"><link rel="prefetch" href="/assets/js/153.52289128.js"><link rel="prefetch" href="/assets/js/154.b3b7dbf6.js"><link rel="prefetch" href="/assets/js/155.a0da0515.js"><link rel="prefetch" href="/assets/js/156.b0f371ff.js"><link rel="prefetch" href="/assets/js/157.8c600dd7.js"><link rel="prefetch" href="/assets/js/158.b46c7c10.js"><link rel="prefetch" href="/assets/js/159.7b9b60a0.js"><link rel="prefetch" href="/assets/js/16.53f27d2e.js"><link rel="prefetch" href="/assets/js/160.a23e1535.js"><link rel="prefetch" href="/assets/js/161.67570f98.js"><link rel="prefetch" href="/assets/js/162.8f76dde6.js"><link rel="prefetch" href="/assets/js/163.bd71a67c.js"><link rel="prefetch" href="/assets/js/164.d31350f5.js"><link rel="prefetch" href="/assets/js/165.2f13eb8b.js"><link rel="prefetch" href="/assets/js/166.aee4023e.js"><link rel="prefetch" href="/assets/js/167.50b09b9e.js"><link rel="prefetch" href="/assets/js/168.ea546150.js"><link rel="prefetch" href="/assets/js/169.d293c446.js"><link rel="prefetch" href="/assets/js/17.19d33517.js"><link rel="prefetch" href="/assets/js/170.1408f678.js"><link rel="prefetch" href="/assets/js/171.c0d175b7.js"><link rel="prefetch" href="/assets/js/172.85a91e74.js"><link rel="prefetch" href="/assets/js/173.3cf4a9d4.js"><link rel="prefetch" href="/assets/js/174.c50d5cc6.js"><link rel="prefetch" href="/assets/js/176.d69e5622.js"><link rel="prefetch" href="/assets/js/177.c32fe56f.js"><link rel="prefetch" href="/assets/js/178.e73ad5a4.js"><link rel="prefetch" href="/assets/js/179.9c2743ad.js"><link rel="prefetch" href="/assets/js/18.839833b0.js"><link rel="prefetch" href="/assets/js/180.f9b6ae3c.js"><link rel="prefetch" href="/assets/js/181.5b50f262.js"><link rel="prefetch" href="/assets/js/182.e5664611.js"><link rel="prefetch" href="/assets/js/183.34681238.js"><link rel="prefetch" href="/assets/js/184.44f84309.js"><link rel="prefetch" href="/assets/js/185.5dd6aa78.js"><link rel="prefetch" href="/assets/js/186.7c4b8770.js"><link rel="prefetch" href="/assets/js/187.9d62ebe5.js"><link rel="prefetch" href="/assets/js/188.2a95428e.js"><link rel="prefetch" href="/assets/js/189.31cc6989.js"><link rel="prefetch" href="/assets/js/19.b9101095.js"><link rel="prefetch" href="/assets/js/190.27d58c6f.js"><link rel="prefetch" href="/assets/js/191.feb02cfe.js"><link rel="prefetch" href="/assets/js/192.58e52c82.js"><link rel="prefetch" href="/assets/js/20.bf2e5bcc.js"><link rel="prefetch" href="/assets/js/21.950282ae.js"><link rel="prefetch" href="/assets/js/22.e23d0df8.js"><link rel="prefetch" href="/assets/js/23.899b2158.js"><link rel="prefetch" href="/assets/js/24.0177b331.js"><link rel="prefetch" href="/assets/js/25.df45d611.js"><link rel="prefetch" href="/assets/js/26.2c1f031f.js"><link rel="prefetch" href="/assets/js/27.59bd0619.js"><link rel="prefetch" href="/assets/js/28.9f62636c.js"><link rel="prefetch" href="/assets/js/29.55c1abfe.js"><link rel="prefetch" href="/assets/js/30.36c2376f.js"><link rel="prefetch" href="/assets/js/31.e430a45a.js"><link rel="prefetch" href="/assets/js/32.9991c772.js"><link rel="prefetch" href="/assets/js/33.1f3ac843.js"><link rel="prefetch" href="/assets/js/34.70b81d32.js"><link rel="prefetch" href="/assets/js/35.665f99dc.js"><link rel="prefetch" href="/assets/js/36.acd2d2f3.js"><link rel="prefetch" href="/assets/js/37.e941826a.js"><link rel="prefetch" href="/assets/js/38.6b410697.js"><link rel="prefetch" href="/assets/js/39.63ef470c.js"><link rel="prefetch" href="/assets/js/4.71a79285.js"><link rel="prefetch" href="/assets/js/40.e0530a60.js"><link rel="prefetch" href="/assets/js/41.c2f14f18.js"><link rel="prefetch" href="/assets/js/42.781e30b1.js"><link rel="prefetch" href="/assets/js/43.8dca9f7d.js"><link rel="prefetch" href="/assets/js/44.474b85af.js"><link rel="prefetch" href="/assets/js/45.7e28bd1e.js"><link rel="prefetch" href="/assets/js/46.c426d624.js"><link rel="prefetch" href="/assets/js/47.dd79ed48.js"><link rel="prefetch" href="/assets/js/48.b127981e.js"><link rel="prefetch" href="/assets/js/49.645aa60f.js"><link rel="prefetch" href="/assets/js/5.348af5f5.js"><link rel="prefetch" href="/assets/js/50.431db6e1.js"><link rel="prefetch" href="/assets/js/51.27f45dfb.js"><link rel="prefetch" href="/assets/js/52.49c240b3.js"><link rel="prefetch" href="/assets/js/53.52e2ce1d.js"><link rel="prefetch" href="/assets/js/54.0b0d010c.js"><link rel="prefetch" href="/assets/js/55.44515bfe.js"><link rel="prefetch" href="/assets/js/56.26076f53.js"><link rel="prefetch" href="/assets/js/57.e2937632.js"><link rel="prefetch" href="/assets/js/58.a8fec1e7.js"><link rel="prefetch" href="/assets/js/59.23521b29.js"><link rel="prefetch" href="/assets/js/6.5f8cf22f.js"><link rel="prefetch" href="/assets/js/60.3e6ef10e.js"><link rel="prefetch" href="/assets/js/61.eee89bad.js"><link rel="prefetch" href="/assets/js/62.e2aea6f5.js"><link rel="prefetch" href="/assets/js/63.0a8e317d.js"><link rel="prefetch" href="/assets/js/64.a4293812.js"><link rel="prefetch" href="/assets/js/65.54a09818.js"><link rel="prefetch" href="/assets/js/66.428ca83d.js"><link rel="prefetch" href="/assets/js/67.9b5b7deb.js"><link rel="prefetch" href="/assets/js/68.11496a42.js"><link rel="prefetch" href="/assets/js/69.bc325ed2.js"><link rel="prefetch" href="/assets/js/7.b76edd10.js"><link rel="prefetch" href="/assets/js/70.71315718.js"><link rel="prefetch" href="/assets/js/71.33031a88.js"><link rel="prefetch" href="/assets/js/72.c9cec6f8.js"><link rel="prefetch" href="/assets/js/73.90a26568.js"><link rel="prefetch" href="/assets/js/74.91d8902a.js"><link rel="prefetch" href="/assets/js/75.917e44f0.js"><link rel="prefetch" href="/assets/js/76.283d9e31.js"><link rel="prefetch" href="/assets/js/77.5dc96242.js"><link rel="prefetch" href="/assets/js/78.2938743b.js"><link rel="prefetch" href="/assets/js/79.dbd7cc52.js"><link rel="prefetch" href="/assets/js/8.3e9099da.js"><link rel="prefetch" href="/assets/js/80.5263d244.js"><link rel="prefetch" href="/assets/js/81.56ca6747.js"><link rel="prefetch" href="/assets/js/82.366b8571.js"><link rel="prefetch" href="/assets/js/83.3606efce.js"><link rel="prefetch" href="/assets/js/84.a1a30dcf.js"><link rel="prefetch" href="/assets/js/85.08788b2c.js"><link rel="prefetch" href="/assets/js/86.c89e9428.js"><link rel="prefetch" href="/assets/js/87.a82c3da1.js"><link rel="prefetch" href="/assets/js/88.94f876a0.js"><link rel="prefetch" href="/assets/js/89.d144dba4.js"><link rel="prefetch" href="/assets/js/9.a30bcaa1.js"><link rel="prefetch" href="/assets/js/90.83712470.js"><link rel="prefetch" href="/assets/js/91.dd4b037d.js"><link rel="prefetch" href="/assets/js/92.85aa9b47.js"><link rel="prefetch" href="/assets/js/93.cb1c7a3e.js"><link rel="prefetch" href="/assets/js/94.86565fda.js"><link rel="prefetch" href="/assets/js/95.626cd1af.js"><link rel="prefetch" href="/assets/js/96.68885233.js"><link rel="prefetch" href="/assets/js/97.f6fe44de.js"><link rel="prefetch" href="/assets/js/98.e810dd8b.js"><link rel="prefetch" href="/assets/js/99.20b96af4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.63e2627a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小武子知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/js/" class="nav-link">javascript</a></div><div class="nav-item"><a href="/css/" class="nav-link">css</a></div><div class="nav-item"><a href="/html5/" class="nav-link">HTML5</a></div><div class="nav-item"><a href="/tool/" class="nav-link">工具</a></div><div class="nav-item"><a href="/project/" class="nav-link router-link-active">软件工程</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机基础</a></div><div class="nav-item"><a href="/materials/" class="nav-link">资料收集</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于作者</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/js/" class="nav-link">javascript</a></div><div class="nav-item"><a href="/css/" class="nav-link">css</a></div><div class="nav-item"><a href="/html5/" class="nav-link">HTML5</a></div><div class="nav-item"><a href="/tool/" class="nav-link">工具</a></div><div class="nav-item"><a href="/project/" class="nav-link router-link-active">软件工程</a></div><div class="nav-item"><a href="/cs/" class="nav-link">计算机基础</a></div><div class="nav-item"><a href="/materials/" class="nav-link">资料收集</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于作者</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/test.html" class="sidebar-link">单元测试与集成测试</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>规范化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/standard.html" class="sidebar-link">规范化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/browser-working.html" class="sidebar-link">浏览器工作原理</a></li><li><a href="/project/cross-domain.html" class="sidebar-link">跨域</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>PWA介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/pwa-0.html" class="sidebar-link">PWA介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>直播原理与实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/live.html" class="sidebar-link">直播原理及实践</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/performance-1.html" class="sidebar-link">执行性能</a></li><li><a href="/project/performance-2.html" class="sidebar-link">加载性能</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Web安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/xss.html" class="active sidebar-link">XSS 攻击</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/xss.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/project/xss.html#内容" class="sidebar-link">内容</a></li><li class="sidebar-sub-header"><a href="/project/xss.html#联系作者" class="sidebar-link">联系作者</a></li></ul></li><li><a href="/project/csrf.html" class="sidebar-link">CSRF 攻击</a></li><li><a href="/project/sql.html" class="sidebar-link">SQL 攻击</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>web监控</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/monitoring-performance.html" class="sidebar-link">性能监控</a></li><li><a href="/project/monitoring-api.html" class="sidebar-link">接口监控</a></li><li><a href="/project/monitoring-behavior.html" class="sidebar-link">行为监控</a></li><li><a href="/project/monitoring-error.html" class="sidebar-link">错误监控</a></li><li><a href="/project/report.html" class="sidebar-link">上报与告警</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>WEB调试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/mobile-debug.html" class="sidebar-link">移动端调试</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="xss-攻击"><a href="#xss-攻击" aria-hidden="true" class="header-anchor">#</a> XSS 攻击</h1> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>本人平时学习及收集内容，欢迎参入一起讨论。</p> <h2 id="内容"><a href="#内容" aria-hidden="true" class="header-anchor">#</a> 内容</h2> <ul><li><a href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-xss-%E6%94%BB%E5%87%BB">什么是 XSS 攻击</a></li> <li><a href="#%E4%BA%8C%E3%80%81xss-%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F">XSS 攻击方式</a></li> <li><a href="#%E4%B8%89%E3%80%81xss-%E7%9A%84%E5%8D%B1%E5%AE%B3">XSS 的危害</a></li> <li><a href="#%E5%9B%9B-%E3%80%81xss-%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD">XSS 防御措施</a></li></ul> <h3 id="一、什么是-xss-攻击"><a href="#一、什么是-xss-攻击" aria-hidden="true" class="header-anchor">#</a> 一、什么是 XSS 攻击</h3> <p>跨站点脚本（Cross-site scripting，XSS）是一种允许攻击者在另一个用户的浏览器中执行恶意脚本的脚本注入式攻击。</p> <h3 id="二、xss-攻击方式"><a href="#二、xss-攻击方式" aria-hidden="true" class="header-anchor">#</a> 二、XSS 攻击方式</h3> <ol><li>反射型</li></ol> <p><code>将用户输入的存在XSS攻击的数据，发送给后台，后台并未对数据进行存储，也未经过任何过滤，直接返回给客户端。被浏览器渲染。就可能导致XSS攻击；</code></p> <p>例一：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://www.xss.com?x=&lt;script&gt;alert('xss')&lt;/script&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>示例图</p> <p><img src="/images/xss/eb141420f5d5638711537444b863eb76_r.jpg" alt=""></p> <p>攻击者构造了一个包含恶意文本的 URL 发送给受害者</p> <p>受害者被攻击者欺骗，通过访问这个 URL 向网站发出请求</p> <p>网站给受害者的返回中包含了来自 URL 的的恶意文本</p> <p>受害者的浏览器执行了来自返回中的恶意脚本，把受害者的 cookie 发送给攻击者的服务器</p> <ol start="2"><li>存储型</li></ol> <p><code>数据库中存有的存在XSS攻击的数据，返回给客户端。若数据未经过任何转义。被浏览器渲染。就可能导致XSS攻击；</code></p> <ol start="3"><li>基于 DOM 的 XSS 攻击</li></ol> <p><code>与前面两种不一样的地方是不需要提交到服务器中，可直接在浏览器中执行</code></p> <p>常见的输入输出点可利用下面这些：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//常见的输入点：
document.URL
document.URLUnencoded
document.location(and many of its properties)
document.referrer
window.location(and many of its properties)
//常见的输出点：
document.write(…)
document.writeln(…)
document.body.innerHtml = …
//直接修改DOM树：
document.forms[0].action = … (and various other collections)
document.attachEvent(…)
document.create…(…)
document.execCommand(…)
document.body.…(accessing the DOM through the body object)
window.attachEvent(…)
//替换document URL：
document.location = … (and assigning to location’ s href, host and hostname)
document.location.hostname = …
document.location.replace(…)
document.location.assign(…)
document.URL = …
window.navigate(…)
//打开或修改新窗口：
document.open(…)
window.open(…)
window.location.href = … (and assigning to location’ s href, host and hostname)
//直接执行脚本：
eval(…)
window.execScript(…)
window.setInterval(…)
window.setTimeout(…)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div> <h3 id="三、xss-的危害"><a href="#三、xss-的危害" aria-hidden="true" class="header-anchor">#</a> 三、XSS 的危害</h3> <ol><li>挂马</li></ol> <p>所谓挂马就是通过各种方法获得网站管理员账号，然后登陆网站后台，网页挂马可通过嵌入 iframe 实现</p> <ol start="2"><li>盗取用户 COOKIE</li></ol> <p>骑过“document.cookie”读取 cookie 信息，发起劫持，可直接通过加密的 cookie 登录凭证登录登陆用户的账户。</p> <ol start="3"><li>DDOS（Distributed Denial of Service）分布式拒绝攻击</li></ol> <p>在目标流星器中注入 Ajax 请求的代码，Ajax 请求的响应有同源策略的限制，但请求不会，所以可以同时发起请求攻击。</p> <ol start="4"><li>钓鱼攻击</li></ol> <p>在网页中，伪造真实的登录框，欺骗用户登录时，账号密码就会被盗取。</p> <ol start="5"><li>劫持用户 web 行为</li></ol> <p>网站的很多操作是可以 http 的 get 或 post 请求完成的，攻击者可通过代码发起这两种请求，例如构造 form、ajax 等。</p> <ol start="6"><li>XSS Worm（蠕虫）</li></ol> <p>当被攻击用户查看存在 XSS 蠕虫代码的内容时，蠕虫触发并开始感染传播。</p> <p>用户之间发生交互行为的页面，存在存储型 XSS，比较容易发起 XSS Worm 攻击。</p> <h3 id="四-、xss-防御措施"><a href="#四-、xss-防御措施" aria-hidden="true" class="header-anchor">#</a> 四 、XSS 防御措施</h3> <h4 id="_4-1-httponly"><a href="#_4-1-httponly" aria-hidden="true" class="header-anchor">#</a> 4.1 HttpOnly</h4> <p>浏览器将禁止页面的 JS 访问带有 HttpOnly 属性的 Cookie。此属性解决的是 XSS 后的 Cookie 劫持攻击。</p> <p>Cookie 的使用过程大致如下：</p> <ol><li>浏览器向服务器发起请求</li> <li>服务器响应后发送 Set-Cookie 头（此时可设置 HttpOnly），向客户端浏览器写入 Cookie</li> <li>浏览器访问该域下的所有页面都将发送该 Cookie（只要 Cookie 还没过期）</li></ol> <p>PHP 代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?php
header(&quot;Set-Cookie: hidden=value; httpOnly&quot;);

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_4-2-输入检查"><a href="#_4-2-输入检查" aria-hidden="true" class="header-anchor">#</a> 4.2 输入检查</h4> <p>在服务器与客户端添加验证规则，在特定的地方使用特定的规则，例如不匹配“script 标签或&lt;、&gt;特殊符号”等。</p> <p>启用“白名单原则”，可用于标签、属性或事件，只让正常的“a、div”等标签通过。</p> <p>下面是<a href="https://code.google.com/archive/p/domxsswiki/wikis/FindingDOMXSS.wiki" target="_blank" rel="noopener noreferrer">FindingDOMXSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中对输入点（sources）的匹配规则：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
/(location\s*[\[.])|([.\[]\s*[&quot;']?\s*(arguments|dialogArguments|innerHTML|write(ln)?
|open(Dialog)?|showModalDialog|cookie|URL|documentURI|baseURI|referrer|
name|opener|parent|top|content|self|frames)\W)|(localStorage|sessionStorage|Database)/

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字符串类型的数据，需要针对&lt;、&gt;、/、’、”、&amp;五个字符进行实体化转义。</p> <p><img src="/images/xss/640.webp" alt=""></p> <h4 id="_4-3-转出检查"><a href="#_4-3-转出检查" aria-hidden="true" class="header-anchor">#</a> 4.3 转出检查</h4> <p>变量输出到 HTML 页面时，可以使用编码或转义的方式防御 XSS 攻击。</p> <p>针对 HTML 与 JavaScript 的编码可通过 HtmlEncode 和 JavaScriptEncode 实现，具体的函数内容可<a href="http://www.cnblogs.com/lovesong/p/5211667.html" target="_blank" rel="noopener noreferrer">参考此处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>在<a href="https://code.google.com/archive/p/domxsswiki/wikis/FindingDOMXSS.wiki" target="_blank" rel="noopener noreferrer">FindingDOMXSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中同样给出了输出点（sinks）的匹配规则</p> <h5 id="情况一"><a href="#情况一" aria-hidden="true" class="header-anchor">#</a> 情况一</h5> <ul><li>数据类型：String</li> <li>上下文：HTML Body</li> <li>示例代码：<code>&lt;span&gt;UNTRUSTED DATA&lt;/span&gt;</code></li> <li>防御措施：HTML Entity 编码</li></ul> <h5 id="情况二"><a href="#情况二" aria-hidden="true" class="header-anchor">#</a> 情况二</h5> <ul><li>数据类型：String</li> <li>上下文：安全 HTML 变量</li> <li>示例代码：<code>&lt;input type=&quot;text&quot; name=&quot;fname&quot; value=&quot;UNTRUSTED DATA&quot;&gt;</code></li> <li>防御措施
<ul><li>HTML Attribute 编码</li> <li>只把不可信数据放在安全白名单内的变量上（白名单在下文列出）</li> <li>严格地校验不安全变量，如 background、id 和 name</li></ul></li></ul> <h5 id="情况三"><a href="#情况三" aria-hidden="true" class="header-anchor">#</a> 情况三</h5> <ul><li>数据类型：String</li> <li>上下文：GET 参数</li> <li>示例代码：<code>&lt;a href=&quot;/site/search?value=UNTRUSTED DATA&quot;&gt;clickme&lt;/a&gt;</code></li> <li>防御措施：URL 编码</li></ul> <h5 id="情况四"><a href="#情况四" aria-hidden="true" class="header-anchor">#</a> 情况四</h5> <ul><li>数据类型：String</li> <li>上下文：使用在 src 或 href 变量上的不可信 URLs</li> <li>示例代码：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;a href=&quot;UNTRUSTED URL&quot;&gt;clickme&lt;/a&gt;
&lt;iframe src=&quot;UNTRUSTED URL&quot; /&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>防御措施：</li></ul> <ol><li>对输入进行规范化</li> <li>URL 校验</li> <li>URL 安全性认证</li> <li>只允许使用 http 和 https 协议（避免使用 JavaScript 协议去打开一个新窗口）</li> <li>HTML Attribute 编码</li></ol> <h4 id="情况五"><a href="#情况五" aria-hidden="true" class="header-anchor">#</a> 情况五</h4> <ul><li>数据类型：String</li> <li>上下文：CSS 值</li> <li>示例代码：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;div style=&quot;width: UNTRUSTED DATA;&quot;&gt;Selection&lt;/div&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>防御措施：</li></ul> <ol><li>使用 CSS 编码</li> <li>使用 CSS Hex 编码</li> <li>良好的 CSS 设计</li></ol> <h5 id="情况六"><a href="#情况六" aria-hidden="true" class="header-anchor">#</a> 情况六</h5> <ul><li>数据类型：String</li> <li>上下文：JavaScript 变量</li> <li>示例代码：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>
&lt;script&gt;var currentValue='UNTRUSTED DATA';&lt;/script&gt;
&lt;script&gt;someFunction('UNTRUSTED DATA');&lt;/script&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>防御措施：</li></ul> <ol><li>确保所有变量值都被引号括起来</li> <li>使用 JavaScript Hex 编码</li> <li>使用 JavaScript Unicode 编码</li> <li>避免使用“反斜杠转译”（&quot;、'或者\）</li></ol> <h5 id="情况七"><a href="#情况七" aria-hidden="true" class="header-anchor">#</a> 情况七</h5> <ul><li>数据类型：HTML</li> <li>上下文：HTML Body</li> <li>示例代码：<code>&lt;div&gt;UNTRUSTED HTML&lt;/div&gt;</code></li> <li>防御措施：
<ul><li>[HTML 校验 (JSoup, AntiSamy, HTML Sanitizer)]</li></ul></li></ul> <p><code>(https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet#RULE_.236_-_Use_an_HTML_Policy_engine_to_validate_or_clean_user-driven_HTML_in_an_outbound_way)</code></p> <h5 id="情况八"><a href="#情况八" aria-hidden="true" class="header-anchor">#</a> 情况八</h5> <ul><li>数据类型：String</li> <li>上下文：DOM XSS</li> <li>示例代码：<code>&lt;script&gt;document.write(&quot;UNTRUSTED INPUT: &quot; + document.location.hash);&lt;script/&gt;</code></li></ul> <h3 id="dom-based-xss-防御"><a href="#dom-based-xss-防御" aria-hidden="true" class="header-anchor">#</a> DOM Based XSS 防御</h3> <p>DOM Based XSS 是直接从“JavaScript”中输出数据到 HTML 页面里，前面提到的都是从“服务器”中输出。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
//x 是从服务器中输出的，并且做了 JavaScriptEncode 操作
var x=&quot;\x20\x27onclick\x3dalert\x281\x29\x3b&quot;;
//在输出后会变成&lt;a href=&quot; &quot; onclick=&quot;alert(1);&quot;&gt;test&lt;/a&gt;还是能执行点击
document.write(&quot;&lt;a href='&quot;+x+&quot;&gt;test&lt;/a&gt;&quot;);

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>所以要在合适的地方再做一次编码操作，下面是分情况说明：</p> <p>如果输出到事件或脚本中，则再做一次 JavaScriptEncode；如果输出到 HTML 内容或属性中，就再做一次 HtmlEncode。</p> <p>在 OWASP 中有一篇《<a href="https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet" target="_blank" rel="noopener noreferrer">DOM based XSS Prevention Cheat Sheet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>》，详细记录了发生场景和解决指南。</p> <h3 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h3> <ul><li><a href="http://www.cnblogs.com/strick/p/6349911.html" target="_blank" rel="noopener noreferrer">谨慎能捕千秋蝉（一）——XSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s/GMA2OpBLtRTEU2E2DoE_iQ" target="_blank" rel="noopener noreferrer">如何让前端更安全？——XSS 攻击和防御详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/21308080" target="_blank" rel="noopener noreferrer">了解 XSS 攻击<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/lovesong/p/5199623.html" target="_blank" rel="noopener noreferrer">前端安全之 XSS 攻击<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="联系作者"><a href="#联系作者" aria-hidden="true" class="header-anchor">#</a> 联系作者</h2> <div align="center"><p>
        平凡世界，贵在坚持。
    </p> <img src="/about/contact.png"></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">2019-10-13 10:58:09</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/project/performance-2.html" class="prev">加载性能</a></span> <span class="next"><a href="/project/csrf.html">CSRF 攻击</a>→
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.15e91dcf.js" defer></script><script src="/assets/js/2.d829aec4.js" defer></script><script src="/assets/js/175.8f70bce9.js" defer></script><script src="/assets/js/3.7b1884f5.js" defer></script>
  </body>
</html>
