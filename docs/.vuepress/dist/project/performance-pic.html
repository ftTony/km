<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>图片优化 | 小武子知识库</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/hero.jpg">
    <meta name="description" content="用心，谈技术。大前端">
    
    <link rel="preload" href="/assets/css/0.styles.0c763008.css" as="style"><link rel="preload" href="/assets/js/app.c0e6e248.js" as="script"><link rel="preload" href="/assets/js/2.95c27d7d.js" as="script"><link rel="preload" href="/assets/js/248.1758f1a7.js" as="script"><link rel="preload" href="/assets/js/3.e9403692.js" as="script"><link rel="prefetch" href="/assets/js/10.55459c06.js"><link rel="prefetch" href="/assets/js/100.979736e1.js"><link rel="prefetch" href="/assets/js/101.221faf61.js"><link rel="prefetch" href="/assets/js/102.94aedcca.js"><link rel="prefetch" href="/assets/js/103.f20c9812.js"><link rel="prefetch" href="/assets/js/104.315a1860.js"><link rel="prefetch" href="/assets/js/105.b1c1457e.js"><link rel="prefetch" href="/assets/js/106.d15e2ca0.js"><link rel="prefetch" href="/assets/js/107.a9aa8c09.js"><link rel="prefetch" href="/assets/js/108.dadba095.js"><link rel="prefetch" href="/assets/js/109.29b359ec.js"><link rel="prefetch" href="/assets/js/11.01d1c96d.js"><link rel="prefetch" href="/assets/js/110.f8caf907.js"><link rel="prefetch" href="/assets/js/111.cb06f760.js"><link rel="prefetch" href="/assets/js/112.b6f22b04.js"><link rel="prefetch" href="/assets/js/113.93ad072c.js"><link rel="prefetch" href="/assets/js/114.5b5e7b79.js"><link rel="prefetch" href="/assets/js/115.64a2e93b.js"><link rel="prefetch" href="/assets/js/116.67807b09.js"><link rel="prefetch" href="/assets/js/117.9d2d0bae.js"><link rel="prefetch" href="/assets/js/118.64be5c72.js"><link rel="prefetch" href="/assets/js/119.f8645233.js"><link rel="prefetch" href="/assets/js/12.52c45b75.js"><link rel="prefetch" href="/assets/js/120.33f78b92.js"><link rel="prefetch" href="/assets/js/121.68c62c07.js"><link rel="prefetch" href="/assets/js/122.6ac0bce5.js"><link rel="prefetch" href="/assets/js/123.2fbe615c.js"><link rel="prefetch" href="/assets/js/124.db2635d9.js"><link rel="prefetch" href="/assets/js/125.b9a55161.js"><link rel="prefetch" href="/assets/js/126.8a58009d.js"><link rel="prefetch" href="/assets/js/127.c2bef3ea.js"><link rel="prefetch" href="/assets/js/128.bce1d8c0.js"><link rel="prefetch" href="/assets/js/129.7db75c40.js"><link rel="prefetch" href="/assets/js/13.29d360fe.js"><link rel="prefetch" href="/assets/js/130.d51af23f.js"><link rel="prefetch" href="/assets/js/131.9f4f3763.js"><link rel="prefetch" href="/assets/js/132.cbfe0551.js"><link rel="prefetch" href="/assets/js/133.d56e5883.js"><link rel="prefetch" href="/assets/js/134.72718d19.js"><link rel="prefetch" href="/assets/js/135.e4b301a2.js"><link rel="prefetch" href="/assets/js/136.4c624f68.js"><link rel="prefetch" href="/assets/js/137.20fdc89b.js"><link rel="prefetch" href="/assets/js/138.a4a888fc.js"><link rel="prefetch" href="/assets/js/139.78817bdd.js"><link rel="prefetch" href="/assets/js/14.77482c04.js"><link rel="prefetch" href="/assets/js/140.834efd86.js"><link rel="prefetch" href="/assets/js/141.1fe471c0.js"><link rel="prefetch" href="/assets/js/142.da2e7c72.js"><link rel="prefetch" href="/assets/js/143.34d6dd1d.js"><link rel="prefetch" href="/assets/js/144.86e14680.js"><link rel="prefetch" href="/assets/js/145.a7693849.js"><link rel="prefetch" href="/assets/js/146.cbf95e38.js"><link rel="prefetch" href="/assets/js/147.6bd8239e.js"><link rel="prefetch" href="/assets/js/148.956aed02.js"><link rel="prefetch" href="/assets/js/149.1fcf5700.js"><link rel="prefetch" href="/assets/js/15.fb659717.js"><link rel="prefetch" href="/assets/js/150.bee6e3f2.js"><link rel="prefetch" href="/assets/js/151.9ebfe7de.js"><link rel="prefetch" href="/assets/js/152.1b2879bd.js"><link rel="prefetch" href="/assets/js/153.c4e12f19.js"><link rel="prefetch" href="/assets/js/154.6dfa976e.js"><link rel="prefetch" href="/assets/js/155.3dc3dff8.js"><link rel="prefetch" href="/assets/js/156.cd6e2787.js"><link rel="prefetch" href="/assets/js/157.ecc4c737.js"><link rel="prefetch" href="/assets/js/158.a2ec8adc.js"><link rel="prefetch" href="/assets/js/159.5e7798da.js"><link rel="prefetch" href="/assets/js/16.21715c63.js"><link rel="prefetch" href="/assets/js/160.99b23434.js"><link rel="prefetch" href="/assets/js/161.db46840f.js"><link rel="prefetch" href="/assets/js/162.a5b22316.js"><link rel="prefetch" href="/assets/js/163.21333d52.js"><link rel="prefetch" href="/assets/js/164.1f975bdc.js"><link rel="prefetch" href="/assets/js/165.e2012583.js"><link rel="prefetch" href="/assets/js/166.06773b17.js"><link rel="prefetch" href="/assets/js/167.4bc25080.js"><link rel="prefetch" href="/assets/js/168.3a82aa57.js"><link rel="prefetch" href="/assets/js/169.3018185f.js"><link rel="prefetch" href="/assets/js/17.670573d5.js"><link rel="prefetch" href="/assets/js/170.8936fbb2.js"><link rel="prefetch" href="/assets/js/171.dc6f6900.js"><link rel="prefetch" href="/assets/js/172.eedaccbd.js"><link rel="prefetch" href="/assets/js/173.c844546f.js"><link rel="prefetch" href="/assets/js/174.d20cd29c.js"><link rel="prefetch" href="/assets/js/175.6cf88876.js"><link rel="prefetch" href="/assets/js/176.04fa621e.js"><link rel="prefetch" href="/assets/js/177.cd30bc38.js"><link rel="prefetch" href="/assets/js/178.ced35bd4.js"><link rel="prefetch" href="/assets/js/179.a6219453.js"><link rel="prefetch" href="/assets/js/18.806c513e.js"><link rel="prefetch" href="/assets/js/180.f3514b7d.js"><link rel="prefetch" href="/assets/js/181.eda890f2.js"><link rel="prefetch" href="/assets/js/182.715a83d2.js"><link rel="prefetch" href="/assets/js/183.d4c63d89.js"><link rel="prefetch" href="/assets/js/184.a6c1307c.js"><link rel="prefetch" href="/assets/js/185.5b06b5fe.js"><link rel="prefetch" href="/assets/js/186.7694f778.js"><link rel="prefetch" href="/assets/js/187.b5ec80a1.js"><link rel="prefetch" href="/assets/js/188.c3bfc8c4.js"><link rel="prefetch" href="/assets/js/189.953765e3.js"><link rel="prefetch" href="/assets/js/19.78101a53.js"><link rel="prefetch" href="/assets/js/190.ad16fe45.js"><link rel="prefetch" href="/assets/js/191.4df29c79.js"><link rel="prefetch" href="/assets/js/192.6ca4d558.js"><link rel="prefetch" href="/assets/js/193.cddcb53e.js"><link rel="prefetch" href="/assets/js/194.ff774765.js"><link rel="prefetch" href="/assets/js/195.73e67053.js"><link rel="prefetch" href="/assets/js/196.59b60e08.js"><link rel="prefetch" href="/assets/js/197.bd02a76b.js"><link rel="prefetch" href="/assets/js/198.0f31256e.js"><link rel="prefetch" href="/assets/js/199.b16eff53.js"><link rel="prefetch" href="/assets/js/20.a8d2fc52.js"><link rel="prefetch" href="/assets/js/200.f150de80.js"><link rel="prefetch" href="/assets/js/201.126a0e4f.js"><link rel="prefetch" href="/assets/js/202.1c7c4c65.js"><link rel="prefetch" href="/assets/js/203.38f7ff3c.js"><link rel="prefetch" href="/assets/js/204.294df981.js"><link rel="prefetch" href="/assets/js/205.9e25e35a.js"><link rel="prefetch" href="/assets/js/206.841ab598.js"><link rel="prefetch" href="/assets/js/207.f730319d.js"><link rel="prefetch" href="/assets/js/208.b4fcd3e9.js"><link rel="prefetch" href="/assets/js/209.95a87d7b.js"><link rel="prefetch" href="/assets/js/21.eb35b9f1.js"><link rel="prefetch" href="/assets/js/210.69f1e0bb.js"><link rel="prefetch" href="/assets/js/211.07fc0dbd.js"><link rel="prefetch" href="/assets/js/212.fc3748b2.js"><link rel="prefetch" href="/assets/js/213.f5a4b09e.js"><link rel="prefetch" href="/assets/js/214.4b0381ab.js"><link rel="prefetch" href="/assets/js/215.15678e44.js"><link rel="prefetch" href="/assets/js/216.ac94f0f1.js"><link rel="prefetch" href="/assets/js/217.920d0adf.js"><link rel="prefetch" href="/assets/js/218.5e05db83.js"><link rel="prefetch" href="/assets/js/219.66e5d241.js"><link rel="prefetch" href="/assets/js/22.af8dae44.js"><link rel="prefetch" href="/assets/js/220.e7231313.js"><link rel="prefetch" href="/assets/js/221.972b3641.js"><link rel="prefetch" href="/assets/js/222.91fb255b.js"><link rel="prefetch" href="/assets/js/223.ad64491b.js"><link rel="prefetch" href="/assets/js/224.30dca230.js"><link rel="prefetch" href="/assets/js/225.adab052f.js"><link rel="prefetch" href="/assets/js/226.34a0be2d.js"><link rel="prefetch" href="/assets/js/227.c0d3ee20.js"><link rel="prefetch" href="/assets/js/228.2aeaefd0.js"><link rel="prefetch" href="/assets/js/229.033e4089.js"><link rel="prefetch" href="/assets/js/23.a542dcb5.js"><link rel="prefetch" href="/assets/js/230.4a8509be.js"><link rel="prefetch" href="/assets/js/231.558ea837.js"><link rel="prefetch" href="/assets/js/232.d8344106.js"><link rel="prefetch" href="/assets/js/233.24b91ff6.js"><link rel="prefetch" href="/assets/js/234.143af17a.js"><link rel="prefetch" href="/assets/js/235.27208c92.js"><link rel="prefetch" href="/assets/js/236.f91cccfa.js"><link rel="prefetch" href="/assets/js/237.609f41b7.js"><link rel="prefetch" href="/assets/js/238.0e9dbc88.js"><link rel="prefetch" href="/assets/js/239.4bca5a19.js"><link rel="prefetch" href="/assets/js/24.bebc3fd0.js"><link rel="prefetch" href="/assets/js/240.505fbb80.js"><link rel="prefetch" href="/assets/js/241.364fc3f9.js"><link rel="prefetch" href="/assets/js/242.8f2bcb7e.js"><link rel="prefetch" href="/assets/js/243.e444d545.js"><link rel="prefetch" href="/assets/js/244.b722e92a.js"><link rel="prefetch" href="/assets/js/245.02ae3936.js"><link rel="prefetch" href="/assets/js/246.fa726b67.js"><link rel="prefetch" href="/assets/js/247.8d32305f.js"><link rel="prefetch" href="/assets/js/249.1f3771b7.js"><link rel="prefetch" href="/assets/js/25.99a5ea92.js"><link rel="prefetch" href="/assets/js/250.e228c98e.js"><link rel="prefetch" href="/assets/js/251.3af79d2d.js"><link rel="prefetch" href="/assets/js/252.3e04b68c.js"><link rel="prefetch" href="/assets/js/253.6fbfe8dc.js"><link rel="prefetch" href="/assets/js/254.1c0ac586.js"><link rel="prefetch" href="/assets/js/255.80a26fbb.js"><link rel="prefetch" href="/assets/js/256.c3aaaf0c.js"><link rel="prefetch" href="/assets/js/257.7190679f.js"><link rel="prefetch" href="/assets/js/258.4943ab16.js"><link rel="prefetch" href="/assets/js/259.dcf70155.js"><link rel="prefetch" href="/assets/js/26.b7030b19.js"><link rel="prefetch" href="/assets/js/260.3be306d0.js"><link rel="prefetch" href="/assets/js/261.0ae95ea5.js"><link rel="prefetch" href="/assets/js/262.bb365195.js"><link rel="prefetch" href="/assets/js/263.0aa716fb.js"><link rel="prefetch" href="/assets/js/264.78a933c0.js"><link rel="prefetch" href="/assets/js/265.be0b27be.js"><link rel="prefetch" href="/assets/js/266.ea75c372.js"><link rel="prefetch" href="/assets/js/267.8fb51a0d.js"><link rel="prefetch" href="/assets/js/268.1de2cd46.js"><link rel="prefetch" href="/assets/js/269.9538f5e4.js"><link rel="prefetch" href="/assets/js/27.7e8d245c.js"><link rel="prefetch" href="/assets/js/270.096a1296.js"><link rel="prefetch" href="/assets/js/271.87e68697.js"><link rel="prefetch" href="/assets/js/272.5e6144f6.js"><link rel="prefetch" href="/assets/js/273.ef37f06f.js"><link rel="prefetch" href="/assets/js/274.3063ed39.js"><link rel="prefetch" href="/assets/js/275.c7d2ace2.js"><link rel="prefetch" href="/assets/js/276.039b6af9.js"><link rel="prefetch" href="/assets/js/277.b1538013.js"><link rel="prefetch" href="/assets/js/278.921015a3.js"><link rel="prefetch" href="/assets/js/279.f5efdb65.js"><link rel="prefetch" href="/assets/js/28.417a693f.js"><link rel="prefetch" href="/assets/js/280.8b708dd7.js"><link rel="prefetch" href="/assets/js/281.32c7d7d9.js"><link rel="prefetch" href="/assets/js/282.bca40967.js"><link rel="prefetch" href="/assets/js/283.dc65e580.js"><link rel="prefetch" href="/assets/js/284.c094dc03.js"><link rel="prefetch" href="/assets/js/285.8da857a9.js"><link rel="prefetch" href="/assets/js/286.f6fc008f.js"><link rel="prefetch" href="/assets/js/287.579299eb.js"><link rel="prefetch" href="/assets/js/288.def44f5f.js"><link rel="prefetch" href="/assets/js/289.249367fd.js"><link rel="prefetch" href="/assets/js/29.e74a8793.js"><link rel="prefetch" href="/assets/js/290.51e83cbc.js"><link rel="prefetch" href="/assets/js/30.2ada8ef8.js"><link rel="prefetch" href="/assets/js/31.0fa0fe16.js"><link rel="prefetch" href="/assets/js/32.ee957bcf.js"><link rel="prefetch" href="/assets/js/33.3da559bf.js"><link rel="prefetch" href="/assets/js/34.dc25f4d2.js"><link rel="prefetch" href="/assets/js/35.fa475c71.js"><link rel="prefetch" href="/assets/js/36.a2175633.js"><link rel="prefetch" href="/assets/js/37.6ea8f9a4.js"><link rel="prefetch" href="/assets/js/38.a80cc766.js"><link rel="prefetch" href="/assets/js/39.acc0d98a.js"><link rel="prefetch" href="/assets/js/4.ff22f931.js"><link rel="prefetch" href="/assets/js/40.98cc10f0.js"><link rel="prefetch" href="/assets/js/41.50ce2979.js"><link rel="prefetch" href="/assets/js/42.1c3175a0.js"><link rel="prefetch" href="/assets/js/43.bfe278c0.js"><link rel="prefetch" href="/assets/js/44.1632f7a8.js"><link rel="prefetch" href="/assets/js/45.9fb9fe8b.js"><link rel="prefetch" href="/assets/js/46.312723aa.js"><link rel="prefetch" href="/assets/js/47.9a486a43.js"><link rel="prefetch" href="/assets/js/48.b58bbdbe.js"><link rel="prefetch" href="/assets/js/49.f9594351.js"><link rel="prefetch" href="/assets/js/5.8402f590.js"><link rel="prefetch" href="/assets/js/50.c7ee805f.js"><link rel="prefetch" href="/assets/js/51.af3c953e.js"><link rel="prefetch" href="/assets/js/52.0117b04d.js"><link rel="prefetch" href="/assets/js/53.c0accba1.js"><link rel="prefetch" href="/assets/js/54.19574e6e.js"><link rel="prefetch" href="/assets/js/55.854ebf03.js"><link rel="prefetch" href="/assets/js/56.2876c393.js"><link rel="prefetch" href="/assets/js/57.2015b2b4.js"><link rel="prefetch" href="/assets/js/58.ea17fa42.js"><link rel="prefetch" href="/assets/js/59.b8b54acf.js"><link rel="prefetch" href="/assets/js/6.49e43e20.js"><link rel="prefetch" href="/assets/js/60.eaab2243.js"><link rel="prefetch" href="/assets/js/61.87d7aa63.js"><link rel="prefetch" href="/assets/js/62.e3e52dc6.js"><link rel="prefetch" href="/assets/js/63.a354853d.js"><link rel="prefetch" href="/assets/js/64.c7954f0d.js"><link rel="prefetch" href="/assets/js/65.cfc29f1c.js"><link rel="prefetch" href="/assets/js/66.3b86207c.js"><link rel="prefetch" href="/assets/js/67.876b4986.js"><link rel="prefetch" href="/assets/js/68.1fa63c02.js"><link rel="prefetch" href="/assets/js/69.d4036cbb.js"><link rel="prefetch" href="/assets/js/7.4258fd2a.js"><link rel="prefetch" href="/assets/js/70.bb9df0cf.js"><link rel="prefetch" href="/assets/js/71.6fccae14.js"><link rel="prefetch" href="/assets/js/72.71df66fa.js"><link rel="prefetch" href="/assets/js/73.d1a322b0.js"><link rel="prefetch" href="/assets/js/74.c537a104.js"><link rel="prefetch" href="/assets/js/75.4972e8bf.js"><link rel="prefetch" href="/assets/js/76.fa44b618.js"><link rel="prefetch" href="/assets/js/77.c29e5132.js"><link rel="prefetch" href="/assets/js/78.7d92b430.js"><link rel="prefetch" href="/assets/js/79.308181de.js"><link rel="prefetch" href="/assets/js/8.ca0c9873.js"><link rel="prefetch" href="/assets/js/80.ce541bcd.js"><link rel="prefetch" href="/assets/js/81.be7f983b.js"><link rel="prefetch" href="/assets/js/82.f40c645f.js"><link rel="prefetch" href="/assets/js/83.95f37310.js"><link rel="prefetch" href="/assets/js/84.627c3517.js"><link rel="prefetch" href="/assets/js/85.e70e72c4.js"><link rel="prefetch" href="/assets/js/86.0c5e2f61.js"><link rel="prefetch" href="/assets/js/87.f417dab7.js"><link rel="prefetch" href="/assets/js/88.2be78ecd.js"><link rel="prefetch" href="/assets/js/89.95820484.js"><link rel="prefetch" href="/assets/js/9.0b3f9e20.js"><link rel="prefetch" href="/assets/js/90.fdd86251.js"><link rel="prefetch" href="/assets/js/91.67916501.js"><link rel="prefetch" href="/assets/js/92.90a9c9a0.js"><link rel="prefetch" href="/assets/js/93.095c4ae9.js"><link rel="prefetch" href="/assets/js/94.ee58e3a1.js"><link rel="prefetch" href="/assets/js/95.8cdf233a.js"><link rel="prefetch" href="/assets/js/96.afd52c5b.js"><link rel="prefetch" href="/assets/js/97.4d635846.js"><link rel="prefetch" href="/assets/js/98.bfa2d297.js"><link rel="prefetch" href="/assets/js/99.444f9853.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0c763008.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小武子知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/js/" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/html5/" class="nav-link">
  HTML5
</a></div><div class="nav-item"><a href="/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/project/" class="nav-link router-link-active">
  软件工程
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/materials/" class="nav-link">
  资料收集
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于作者
</a></div><div class="nav-item"><a href="https://www.github.com/fttony" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/js/" class="nav-link">
  javascript
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/html5/" class="nav-link">
  HTML5
</a></div><div class="nav-item"><a href="/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/project/" class="nav-link router-link-active">
  软件工程
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/materials/" class="nav-link">
  资料收集
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于作者
</a></div><div class="nav-item"><a href="https://www.github.com/fttony" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>网站架构设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/component-design.html" class="sidebar-link">组件设计原则</a></li><li><a href="/project/architecture-1.html" class="sidebar-link">网站架构设计（上）</a></li><li><a href="/project/architecture-2.html" class="sidebar-link">网站架构设计（中）</a></li><li><a href="/project/architecture-3.html" class="sidebar-link">网站架构设计（下）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/test-1.html" class="sidebar-link">单元测试</a></li><li><a href="/project/test-3.html" class="sidebar-link">UI 测试</a></li><li><a href="/project/test-2.html" class="sidebar-link">集成测试</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>规范化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/standard.html" class="sidebar-link">规范化</a></li><li><a href="/project/restful.html" class="sidebar-link">RESTful 架构</a></li><li><a href="/project/codereview.html" class="sidebar-link">代码 Code Review</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/browser-working.html" class="sidebar-link">浏览器工作原理</a></li><li><a href="/project/browser-url.html" class="sidebar-link">从 URL 输入到页面展现到底发生什么？</a></li><li><a href="/project/cross-domain.html" class="sidebar-link">跨域</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>新技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/live.html" class="sidebar-link">直播原理及实践</a></li><li><a href="/project/pwa-0.html" class="sidebar-link">PWA 介绍</a></li><li><a href="/project/webAssembly.html" class="sidebar-link">WebAssembly 学习</a></li><li><a href="/project/dsl.html" class="sidebar-link">前端 DSL 学习</a></li><li><a href="/project/ssr.html" class="sidebar-link">Vue 服务端渲染（SSR）</a></li><li><a href="/project/skeleton.html" class="sidebar-link">骨架屏</a></li><li><a href="/project/serverless.html" class="sidebar-link">serverless 前世今生</a></li><li><a href="/project/micro-frontends.html" class="sidebar-link">微前端</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>性能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/performance-1.html" class="sidebar-link">加载性能</a></li><li><a href="/project/performance-2.html" class="sidebar-link">执行性能</a></li><li><a href="/project/performance-3.html" class="sidebar-link">性能优化手段</a></li><li><a href="/project/performance-4.html" class="sidebar-link">性能优化——网络优化</a></li><li><a href="/project/performance-5.html" class="sidebar-link">性能优化——专业术语</a></li><li><a href="/project/performance-tool.html" class="sidebar-link">性能优化——工具使用</a></li><li><a href="/project/performance-pic.html" aria-current="page" class="active sidebar-link">图片优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/performance-pic.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/project/performance-pic.html#内容" class="sidebar-link">内容</a></li><li class="sidebar-sub-header"><a href="/project/performance-pic.html#参考资料" class="sidebar-link">参考资料</a></li><li class="sidebar-sub-header"><a href="/project/performance-pic.html#联系作者" class="sidebar-link">联系作者</a></li></ul></li><li><a href="/project/infinite-pull-down.html" class="sidebar-link">无限下拉解决方案</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Web安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/login-1.html" class="sidebar-link">OAuth 授权工作原理</a></li><li><a href="/project/login-2.html" class="sidebar-link">单点登录原则</a></li><li><a href="/project/login-3.html" class="sidebar-link">扫码登录</a></li><li><a href="/project/token.html" class="sidebar-link">彻底理解 cookie、session、token</a></li><li><a href="/project/osi-hijack.html" class="sidebar-link">流量劫持</a></li><li><a href="/project/xss.html" class="sidebar-link">XSS 攻击</a></li><li><a href="/project/csrf.html" class="sidebar-link">CSRF 攻击</a></li><li><a href="/project/sql.html" class="sidebar-link">SQL 攻击</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>web监控</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/monitoring-performance.html" class="sidebar-link">性能监控</a></li><li><a href="/project/monitoring-api.html" class="sidebar-link">接口监控</a></li><li><a href="/project/monitoring-behavior.html" class="sidebar-link">行为监控</a></li><li><a href="/project/monitoring-error.html" class="sidebar-link">错误监控</a></li><li><a href="/project/report.html" class="sidebar-link">上报与告警</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>WEB调试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/mobile-debug.html" class="sidebar-link">移动端调试</a></li><li><a href="/project/seo.html" class="sidebar-link">搜索引擎优化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="图片优化"><a href="#图片优化" class="header-anchor">#</a> 图片优化</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>本人平时学习及收集内容，欢迎参入一起讨论。</p> <h2 id="内容"><a href="#内容" class="header-anchor">#</a> 内容</h2> <ul><li><a href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AF%B9%E5%9B%BE%E7%89%87%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96">为什么要对图片进行优化</a></li> <li><a href="#%E4%BA%8C%E3%80%81%E4%BB%8E%E5%9B%BE%E7%89%87%E5%A4%A7%E5%B0%8F%E5%BC%80%E5%A7%8B%E4%BC%98%E5%8C%96">从图片大小开始优化</a></li> <li><a href="#%E4%B8%89%E3%80%81%E9%80%9A%E8%BF%87%E5%9B%BE%E7%89%87%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD%E5%87%8F%E5%B0%91%E8%AF%B7%E6%B1%82%E5%8E%8B%E5%8A%9B">通过图片按需加载减少请求压力</a></li> <li><a href="#%E5%9B%9B%E3%80%81%E5%93%8D%E5%BA%94%E5%BC%8F%E5%9B%BE%E7%89%87%E7%9A%84%E5%AE%9E%E8%B7%B5">响应式图片的实践</a></li> <li><a href="#%E4%BA%94%E3%80%81%E5%AE%89%E5%85%A8%E5%9C%B0%E4%BD%BF%E7%94%A8-webp-%E5%9B%BE%E7%89%87">安全地使用 WebP 图片</a></li> <li><a href="#%E5%85%AD%E3%80%81%E5%AF%B9-base64url-%E7%9A%84%E5%8F%8D%E6%80%9D">对 Base64Url 的反思</a></li></ul> <h3 id="一、为什么要对图片进行优化"><a href="#一、为什么要对图片进行优化" class="header-anchor">#</a> 一、为什么要对图片进行优化</h3> <p>对于大多数前端工程师来说，图片就是 UI 设计师（或者自己）切好的图，你要做的只是把图片丢进项目中，然后用以链接的方式呈现在页面上，而且我们也经常把精力放在项目的打包优化构建上，如何分包，如何抽取第三方库....有时我们会忘了，图片才是一个网站最大头的那块加载资源，虽然图片加载可以不阻碍页面渲染，但优化图片，绝对可以让网站的体验提升一个档次。</p> <h3 id="二、从图片大小开始优化"><a href="#二、从图片大小开始优化" class="header-anchor">#</a> 二、从图片大小开始优化</h3> <p>压缩图片可以使用统一的压缩工具—imagemin，它是一款可以集成多个压缩库的工具，支持 jpg、png、webp 等等格式的图片压缩，比如 pngquant，mozjpeg 等等，作为测试用途，我们可以直接安装 imagemin-pngquant 来尝试 png 图片的压缩</p> <h4 id="_2-1-png-压缩"><a href="#_2-1-png-压缩" class="header-anchor">#</a> 2.1 PNG 压缩</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install imagemin
npm install imagemin-pngquant
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这里先安装 imagemin 库，再安装对应的 png 压缩库</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const imagemin = require('imagemin');
const imageminPngquant = require('imagemin-pngquant');

(async () =&gt; {
        await imagemin(['images/*.png'], 'build/images', {
            plugins: [
                imageminPngquant({ quality: '65-80' })
            ]
        });

        console.log('Images optimized');
})();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>我们可以在 quanilty 一项决定压缩比率，65-80 貌似是一个在压缩率和质量之间实现平衡的数值，腾讯 AlloyTeam 出品的 gka 图片处理工具，同样使用到了 imagemin 库，他们黑夜也是使用 65-80 的选项：gka 代码</p> <p>用它压缩一张 png 图片，我们看看效果如何：</p> <p>压缩前的：</p> <p><img src="performance09.jpg" alt="images"></p> <p>压缩后的：</p> <p><img src="performance10.jpg" alt="images"></p> <p>从肉眼上几乎看不出区别，但实际上减少了百分之 77 的体积！</p> <h4 id="_2-2-jpg-jpeg-压缩与渐进式图片"><a href="#_2-2-jpg-jpeg-压缩与渐进式图片" class="header-anchor">#</a> 2.2 JPG/JPEG 压缩与渐进式图片</h4> <p>压缩 jpg/jpeg 图片的方式与 png 类似,imagemin 提供了一两个插件：jpegtrain 和 mozjpeg 供我们使用。一般我们选择 mozjpeg，它拥有更丰富的压缩选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install imagemin-mozjpeg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code> const imagemin = require('imagemin');
    const imageminMozjpeg = require('imagemin-mozjpeg');

    (async () =&gt; {
        await imagemin(['images/*.jpg'], 'build/images', {
            use: [
                imageminMozjpeg({ quality: 65, progressive: true })
            ]
        });

        console.log('Images optimized');
    })();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>注意到我们使用 progressive:true 选项，这可以将图片转换为渐进式图片，关于渐进式图片，它允许在加载照片的时候，如果网速比较慢的话，先显示一个类似模糊有点小马赛克的质量比较差的照片，然后慢慢的变为清晰的照片：</p> <p><img src="performance11.gif" alt="images"></p> <p>而相比之下，非渐进式的图片(Baseline JPEG)则会老老实实地从头到尾去加载：</p> <p><img src="performance12.gif" alt="images"></p> <p>张鑫旭大神的这篇文章，可以帮你更好地了解两者的区别：<a href="https://www.zhangxinxu.com/wordpress/2013/01/progressive-jpeg-image-and-so-on/" target="_blank" rel="noopener noreferrer">渐进式 jpeg(progressive jpeg)图片及其相关<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>简单来说，渐进式图片一开始就决定了大小，而不像 Baseline 图片一样，不断地从上往下加载，从而造成多次回流，但渐进式图片需要消耗 CPU 去多次计算渲染，这是其主要缺点。</p> <p>当然，交错式 png 也可以实现相应的效果，但目前 pngquant 没有实现转换功能，但是 ps 中导出 png 时是可以设置为交错式的。</p> <h4 id="_2-3-在真实项目中如何操作"><a href="#_2-3-在真实项目中如何操作" class="header-anchor">#</a> 2.3 在真实项目中如何操作？</h4> <p>实际项目中，总不能 UI 丢一个图过来你就跑一遍压缩代码吧？幸好 imagemin 有对应的 webpack 插件，在 webpack 遍地使用的今天，我们可以轻松指压缩：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install imagemin-webpack-plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>先安装 imagemin-webpack-plugin</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> import ImageminPlugin from 'imagemin-webpack-plugin'
    import imageminMozjpeg from 'imagemin-mozjpeg'

    module.exports = {
      plugins: [
        new ImageminPlugin({
          plugins: [
            imageminMozjpeg({
              quality: 100,
              progressive: true
            })
          ]
        })
      ]
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>接着在 webpack 配置文件中，引入自己需要的插件，使用方法完全相同。</p> <h3 id="三、通过图片按需加载减少请求压力"><a href="#三、通过图片按需加载减少请求压力" class="header-anchor">#</a> 三、通过图片按需加载减少请求压力</h3> <p>图片按需加载是个老生常谈的话题，传统做法自然是通过监听页面的滚动位置，符合条件了再去资源加载，我们看看如今还有什么方法可以做到按需加载。</p> <h4 id="_3-1-使用强大的-intersectionobserver"><a href="#_3-1-使用强大的-intersectionobserver" class="header-anchor">#</a> 3.1 使用强大的 IntersectionObserver</h4> <p>IntersectionObserver 提供给我们一项能力：可以用来监听元素是否进入了设备的可视区域之内，这意味着：我们等待图片元素进入可视区域后，再决定是否加载它，毕竟用户没有看到图片前，根本不关心它是否已经加载了。</p> <p>这是 Chrome51 率先提出和支持的 API，而在 2019 年的今天，各大浏览器对它的支持度已经有所改善(除了 IE，全线崩~)：</p> <p><img src="performance13.jpg" alt="images"></p> <p>废话不多说，上代码：首先假设我们有一个图片列表，它们的 src 属性我们暂不设置，而用 data-src 来替代：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;li&gt;
  &lt;img class=&quot;list-item-img&quot; alt=&quot;loading&quot; data-src='a.jpg'/&gt;
&lt;/li&gt;
&lt;li&gt;
  &lt;img class=&quot;list-item-img&quot; alt=&quot;loading&quot; data-src='b.jpg'/&gt;
&lt;/li&gt;
&lt;li&gt;
  &lt;img class=&quot;list-item-img&quot; alt=&quot;loading&quot; data-src='c.jpg'/&gt;
&lt;/li&gt;
&lt;li&gt;
  &lt;img class=&quot;list-item-img&quot; alt=&quot;loading&quot; data-src='d.jpg'/&gt;
&lt;/li&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样会导致图片无法加载，这当然不是我们的目的，我们想做的是，当 IntersectionObserver 监听到图片元素进入可视区域时，将 data-src“还给”src 属性，这样我们就可以实现图片加载了：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const observer = new IntersectionObserver(function(changes){
    changes.forEach(function(element,index){
        // 当这个值大于0，说明满足我们的加载条件了，这个值可通过rootMargin手动设置
        if(element.intersectionRatio&gt;0){
            // 放弃监听，防止性能浪费，并加载图片
            observer.unobserve(element.target);
            element.target.src=element.target.dataset.src;
        }
    });
});
function initObserver(){
    const listItems = document.querySelectorAll('.list-item-img');
    listItems.forEach(function(item){
        // 对每个list元素进行监听
        observer.observe(item);
    });
}

initObserver();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>运行代码并观察控制台的 Network，会发现图片随着可视区域的移动而加载，我们的目的达到了。</p> <p><img src="performance14.jpg" alt="images"></p> <p>ps：一个 vue 的图片懒加载组件 vue-view-lazy，也是基于 IntersectionObserver 实现的</p> <h4 id="_3-2-还是-chrome-的黑科技-loading-属性"><a href="#_3-2-还是-chrome-的黑科技-loading-属性" class="header-anchor">#</a> 3.2 还是 Chrome 的黑科技——loading 属性</h4> <p>从新版本 Chrome(76)开始，已经默认支持一种新的 html 属性——loading，它包含三种取值：</p> <ul><li>auto：让浏览器自动决定是否进行懒加载，这其中的机制尚不明确。</li> <li>lazy：明确地让浏览器对此图片进行懒加载，即当用户滚动到图片附近时才进行加载，但目前没有具体说明这个“附近”具体是多近。</li> <li>eager：让浏览器立刻加载此图片。</li></ul> <p>我们可以通过 chrome 的开发工具看看这个 demo 中的图片加载方式，我们把上一个 demo 中的 js 脚本删掉了，只用了 loading=lazy 这个属性。接着，勾选工具栏中的 Disabled Cache 后仔细观察 Network 一栏，细心的人应该会发现，一张图片被分为了两次去请求！第一次的状态码是 206，第二次状态码才是 200，如图所示：</p> <p><img src="performance15.jpg" alt="images"></p> <p>这个现象跟 chrome 的 lazy-loading 功能的实现机制有关；</p> <ul><li><p>首先，浏览器会发送一个预请求，请求地址就是这张图片的 url，但是这个请求只摘取这张图片的头部数据，大约 2kb，具体做法是在请求头中设置 range:butes=0-2047，<img src="performance16.jpg" alt="images">而从这段数据中浏览器就可以解析出图片的宽高等基本维度，接着浏览器立马为它生成一个空白的占位，以免图片加载过程中而页面不断跳动，这很合理，总不能为了一个懒加载，让用户牺牲其他方面的体验吧？这个请求返回的状态是 206，表明：客户端通过发送范围请求头 Range 抓取到了资源的部分数据，详细的状态码解释可以看看<a href="https://www.cnblogs.com/ziyunfei/archive/2012/11/18/2775499.html" target="_blank" rel="noopener noreferrer">这篇文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>然后，在用户滚动到图片附近时，再发起一个请求，完整地摘取图片的数据下来，这个才是我们熟悉的状态码 200 请求。
可以预测到，如果以后这个属性被普遍使用，那一个服务器要处理的图片请求连接数可能会变成两倍，对服务器的压力会有所增大，但时代在进步，我们可以依靠 http2 多路复用的特性来缓解这个压力，这时候就需要技术负责人权衡利弊了</p></li> <li><p>要注意，使用这项我进行图片懒加载时，刻先进行兼容性处理，对不支持这项属性的浏览器，转而使用 JavaScript 来实现，比如上面说到的 IntersectionObserver：</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>	if (&quot;loading&quot; in HTMLImageElement.prototype) {
	  // 没毛病
	} else {
	  // .....
	}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_3-3-还可以做到锦上添花"><a href="#_3-3-还可以做到锦上添花" class="header-anchor">#</a> 3.3 还可以做到锦上添花！</h4> <p>以上介绍的两种方式，其实最终实现的效果是相似的，但这里还有个问题，当网速慢的时候，图片还没加载完之前，用户会看到一段空白时间，在这段空白时间，就算是渐进图片也无法发挥它的作用，我们需要更友好的展示方式来弥补这段空白，有一种方法简单粗暴，那就是用一张占位图来顶替，这张占位图被加载过一次后，即可从缓存中取出，无须重新加载，但这种图片会显得有些千篇一律，并不能很好地做到 preview 的效果。这里我向大家介绍另一种占位图做法——<strong>css 渐变色背影</strong>，原理很简单，当 img 标签的图片还没有加载出来，我们可以为其设置背景色，比如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;img src=&quot;a.jpg&quot; style=&quot;background: red;&quot;/&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样会先显示出红色背景，再渲染出真实的图片，重点来了，我们此时要借用工具为这张图片“配制”出合适的渐变背景色，以达到部分 preview 的效果，我们可以使用<a href="https://calendar.perfplanet.com/2018/gradient-image-placeholders/" target="_blank" rel="noopener noreferrer">Gradient Image Placeholders<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这篇文章中推荐的工具 GIP 进行转换，这里附上在线转换的地址<a href="https://tools.w3clubs.com/gip/" target="_blank" rel="noopener noreferrer">gip<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>经过转换后，我们得到了下面这串代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>   background: linear-gradient(
      to bottom,
      #1896f5 0%,
      #2e6d14 100%
    )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>最终效果如下所示：</p> <p><img src="performance17.gif" alt="images"></p> <h3 id="四、响应式图片的实践"><a href="#四、响应式图片的实践" class="header-anchor">#</a> 四、响应式图片的实践</h3> <p>我们经常会遇到这种情况：一张在普通笔记本上显示清晰的图片，到了苹果的 Retina 屏幕或是其他高清晰度的屏幕上，就变得模糊了。</p> <p>这是因为，在同样尺寸的屏幕上，高清屏可以展示的物理像素点比普通屏多，比如 Retina 屏，同样的屏幕尺寸下，它的物理像素点的个数是普通屏的 4 倍(<code>2*2</code>)，所以普通屏上显示清晰的图片，在高清屏上就像是被放大了，自然就变得模糊了，要从图片资源上解决这个问题，就需要在设备像素密度为 2 的高清屏中，对应地展示一张两倍大小的图。</p> <p><img src="performance18.jpg" alt="images"></p> <p>而通常来讲，对于背影图片，我们可以使用 css 的@media 进行媒体查询，以决定不同像素密度下该用哪张倍图，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>.bg{
    background-image:url(&quot;bg.png&quot;);
    width:100px;
    height:100px;
    background-size:100% 100%;
}
@media(-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2){
    .bg {
            background-image: url(&quot;bg@2x.png&quot;) // 尺寸为200 * 200的图
        }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这么做有两个好处，一是保证高像素密度的设备下，图片仍能保持应有的清晰度，二是防止在低像素密度的设备下加载大尺寸图片造成浪费。</p> <p>那么如何处理 img 标签呢？</p> <p>我们可以使用 HTML5 中 img 标签的 srcset 来达到这个效果，代码如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;img width=&quot;320&quot; src=&quot;bg@2x.png&quot; srcset=&quot;bg.png 1x;bg@2x.png 2x&quot; /&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这段代码的作用是：当设备像素密度，也就是 dpr(devicePixelRatio)为 1 时，使用 bg.png，为 2 时使用二倍图 bg@2x.png，依此类推，你可以根据需要设置多种精度下要加载的图片，如果没有命中，浏览器会选择最邻近的一个精度对应的图片进行加载。要注意：老旧的浏览器不支持 srcset 的特性，它会继续正常加载 src 属性引用的图像。</p> <h3 id="五、安全地使用-webp-图片"><a href="#五、安全地使用-webp-图片" class="header-anchor">#</a> 五、安全地使用 WebP 图片</h3> <p>WebP 优势这里不再赘述，简单来说就是：同样尺寸的图片，WebP 能保证比未压缩过的 png、jpg、gif 等格式的图片减少百分之 40-70（甚至 90）的比例，且保证较高的质量，更可以支持显示动态图和透明通道。</p> <p><img src="performance19.jpg" alt="images"></p> <p>但目前 WebP 的兼容性并不太好：</p> <p><img src="performance20.jpg" alt="images"></p> <p>但我们可以通过两种方式，对暂未支持 webp 的浏览器进行兼容：</p> <p><strong>picture 结合 source 标签</strong></p> <p>HTML5 的 picture 标签，可以理解为相框，里面可以支持多种格式的图片，并保留一张默认底图：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;picture&gt;
  &lt;source srcset=&quot;bg.webp&quot; type=&quot;images/webp&quot;&gt;
  &lt;source srcset=&quot;bg.jpg&quot; type=&quot;images/jpeg&quot;&gt;
  &lt;img src=&quot;bg.jpg&quot; alt=&quot;背景图&quot;&gt;
&lt;/pictrue&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>有了这段代码，浏览器会自动根据是否支持 webp 格式来选择加载哪张图片，若不支持，则会显示 bg.jpg，如果浏览器连 picture 都不支持，那么会 fallback 到默认的 img 图片，这是必不可少的一个选项。</p> <p>而且这里要注意 source 的放置顺序，如果把 jpg 放在第一位，webp 放在第二位，即使用浏览器支持 webp，那么选择加载 jpg 图片。</p> <p><strong>借助 cdn 服务自动判断</strong></p> <p>目前，有些图片 cdn 服务可以开启自动兼容 webp 的模式，即支持 webp 的浏览器则将原图转换为 webp 图片并返回，否则直接返回原图。实现这个功能的原理是，根据浏览器发起的请求头中的 Accept 属性是否包含 webp 格式来判断：</p> <p><img src="performance21.jpg" alt="images"></p> <p>有则说明浏览器支持 webp 格式，这对于开发者来说可能是最简单的兼容方案，但是依赖于后端服务。</p> <h3 id="六、对-base64url-的反思"><a href="#六、对-base64url-的反思" class="header-anchor">#</a> 六、对 Base64Url 的反思</h3> <p>Base64 就是一种基于 64 个可打印字符来表示二进制数据的方法，编码过程是从二进制数据到字符串的过程，在 web 应用中我们经常用它来做啥呢——传输图片数据。HTML 中，img 的 src 和 css 样式的 background-image 都可以都可以接受 base64 字符串，从而在页面上渲染出对应的图片。正是基于浏览器的这项能力，很多开发者提出了将多张图片转换为 base64 字符串，放进 css 样式文件中的“优化方式”，这样做的目的只有一个——减少 HTTP 请求数。但实际上，在如今的应用开发中，这种做法大多数情况是“负优化”效果，接下来让我们细数 base64 Url 的“罪状”</p> <h4 id="_6-1-让-css-文件的体积失去控制"><a href="#_6-1-让-css-文件的体积失去控制" class="header-anchor">#</a> 6.1 让 css 文件的体积失去控制</h4> <p>当你把图片转换为 base64 字符串之后，字符串的体积一般会比原图更大，一般会多出接近 3 成的大小，如果你一个页面中有 20 张平均大小为 50KB 的图片，转它们为 base64 后，你的 css 文件将可能增大 1.2MB 的大小，这样将严重阻碍浏览器的关键渲染路径：</p> <p><img src="performance22.jpg" alt="images"></p> <p>css 文件本身就是<strong>渲染阻塞资源</strong>，浏览器首次加载时如果没有全部下载和解析完 css 内容就无法进行渲染树的构建，而 base64 的嵌入则是雪上加霜，这将把原生浏览器可以进行优化的图片异步加载，变成首屏渲染的阻塞和延迟。</p> <p>或许有人会说，webpack 的 url-loader 可以根据图片大小决定是否转为 base64(一般是小于 10kb 的图片)，但你也应该担心如果页面中有 100 张小于 10kb 的图片时，会给 css 文件增加多少体积。</p> <h4 id="_6-2-让浏览器的资源缓存策略功亏一篑"><a href="#_6-2-让浏览器的资源缓存策略功亏一篑" class="header-anchor">#</a> 6.2 让浏览器的资源缓存策略功亏一篑</h4> <p>假设你的 base64Url 会被你的应用多次利用，本来浏览器可以直接从本地缓存取出的图片，换成 base64Url，将造成应用中多个页面重复下载 1.3 倍大小的文本，假设一张图片是 100kb 大小，被你的应用使用了 10 次，那么造成的流量浪费将是(100 *1.3 *10) - 100 = 1200kb。</p> <h4 id="_6-3-低版本浏览器的兼容问题"><a href="#_6-3-低版本浏览器的兼容问题" class="header-anchor">#</a> 6.3 低版本浏览器的兼容问题</h4> <p>这是比较次要的问题，dataurl 在低版本 IE 浏览器，比如 IE8 及以下的浏览器，会有兼容性问题，详细情况可以参考<a href="https://www.cnblogs.com/murphyzhou/p/base64-image-compatible.html" target="_blank" rel="noopener noreferrer">这篇文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_6-4-不利于开发者工具调试与查看"><a href="#_6-4-不利于开发者工具调试与查看" class="header-anchor">#</a> 6.4 不利于开发者工具调试与查看</h4> <p>无论哪张图片，看上去都是一堆没有意义的字符串，光看代码无法知道原图是哪张，不利于某些情况下的比对。</p> <p>说了这么多，有人可能不服气，既然这种方案缺点这么多，为啥它会从以前就被广泛使用呢？这要从早期的 http 协议我说起，在 http1.1 之前，http 协议尚未实现 keep-alive，也就是每一次请求，都必须走三次握手四次挥手去建立连接，连接完又丢弃无法利用，而即使得是到了 http1.1 的时代，keep-alive 可以保证 tcp 的长连接，不需要多次重新建立，但由于 http1.1 是基于文本分割的协议，所以消息是串行的，必须有序地逐个解析，所以在这种请求“昂贵”，且早期图片体积并不是特别大，用户对网页响应速度和体验要求也不是很高的各种前提结合下，减少图片资源的请求数是可以理解的。</p> <p>但是，在越来越多网站支持 http2.0 的前提下，这些都不是问题，h2 是基于二进制帧的协议，在保留 http1.1 长连接的前提下，实现了消息的并行处理，请求和响应可以交错甚至可以复用，多个并行请求的开销已经大大降低，我已经不知道还有什么理由继续坚持 base64Url 的使用了。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="http://www.cnblogs.com/wizcabbit/p/web-image-optimization.html" target="_blank" rel="noopener noreferrer">Web 性能优化：图片优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s/3aosOSPut-zkqJDhBfVQ1Q" target="_blank" rel="noopener noreferrer">图像优化自动化实用指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/5c8e4feb6fb9a070aa5ce200" target="_blank" rel="noopener noreferrer">PNG 图片压缩原理解析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/5d4979cc5188255b3e4126ae" target="_blank" rel="noopener noreferrer">谈谈 Web 应用中的图片优化技巧及反思<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="联系作者"><a href="#联系作者" class="header-anchor">#</a> 联系作者</h2> <div align="center"><p>
        平凡世界，贵在坚持。
    </p> <img src="/about/contact.png"></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">2020/1/30 上午9:16:16</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/project/performance-tool.html" class="prev">
        性能优化——工具使用
      </a></span> <span class="next"><a href="/project/infinite-pull-down.html">
        无限下拉解决方案
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><div></div></div></div>
    <script src="/assets/js/app.c0e6e248.js" defer></script><script src="/assets/js/2.95c27d7d.js" defer></script><script src="/assets/js/248.1758f1a7.js" defer></script><script src="/assets/js/3.e9403692.js" defer></script>
  </body>
</html>
