# 性能优化——工具使用

## 前言

本人平时学习及收集内容，欢迎参入一起讨论。

## 内容

- 谷歌开发者工具 Audits
- 谷歌开发者工具 Performance

### 一、Audits

Audit 的配置模块主要有两部分组成，一个是**监测类型**，另外一个是**设备类型（Device）**（注意使用 Audit 功能需要翻墙）。

**监控类型（Categories）是指需要监控哪些内容，**这里有五个对应的选项，它们的功能分别是：

- 监测并分析 Web 性能（**Performance**）；
- 监测并分析 PWA（**Progessive Web App**）程序的性能；
- 监测并分析 Web 应用是否采用了最佳实践策略（Best practices）；
- 监测并分析是否实施了无障碍功能（**Accessibility**），无障碍功能让一些身体有障碍的人可以方便地浏览你的 Web 应用。
- 监测并分析 Web 应用是否采实施了 SEO 搜索引擎优化（**SEO**）。

### 二、Performance

#### 2.1 分析步骤说明

首先，我们在分析的时候，建议使用隐身模式打开页面，排除一些插件等因素对页面性能情况的影响。然后，我们把页面缓存勾选去掉，要测 disable cache 的情况，再把网络调整一下，我们电脑打开页面的时候一般都连着 wifi 等，要更真实一些去测页面的性能，还是把网络调到 3G 等情况比较好，如图：

![images](performance44.png)

调整好之后，我们切到 Performance 面板，这里先说明一下一些按钮的作用：

![images](performance45.png)

上图，从左到右分别代表的是：

1. 手动开始记录，开始后需要手动结束
2. 自动重启页面，并记录整个页面加载的过程。这个是最常用的，一般大概分析页面性能的时候都是点这个就够了
3. 清除性能录制的记录
4. 上传页面性能录制的数据
5. 下载页面性能录制的数据
6. 选择要展示的性能记录。你可能进行了多次分析，这里可以切换去看每次的结果
7. 是否捕捉页面加载过程的截图，这个一般都要勾选
8. 是否记录内存变化
9. 垃圾回收，点击了即进行一次垃圾回收

#### 2.2 认识报告页

生成的报告页，如下图所示：

![images](performance43.png)

我们可以将 Performance 分为三个主要的部分，分别为**概览面板、性能指标面板和详情面板**。

#### 2.3 概览面板

Performance 就会将几个关键指标，诸如页面帧速（FPS）、CPU 资源消耗、网络请求流量、V8 内存使用量（堆内存）等，按照时间顺序成图表的形式展现出来，这就是概览面板。

有了概览面板，我们就能一览几个关键的历史数据指标，进而能快速定位到可能存在问题的时间节点。

- 如果 FPS 图表上出现了红色块，那么就表示红色块附近渲染出一帧所需时间过久，帧的渲染时间过久，就有可能导致页面卡顿。
- 如果 CPU 图形占用面积太大，表示 CPU 使用率就越高，那么就有可能因为某个 JavaScript 占用太多的主线程时间，从而影响其他任务的执行。
- 如果 V8 的内存使用量一直在增加，就有可能是某种原因导致了内存泄漏。

除了以上指标以外，概览面板还展示加载过程中的几个关键时间节点，如 FP、LCP、DOMContentLoaded、Onload 等事件产生的时间点。

#### 2.4 性能面板

通常，我们通过概览面板来定位到可能存在问题的时间节点，接下来需要更进一步的数据来分析导致该问题的原因，这就是需要引入**性能板**了，在性能面板中，记录了非常多的性能指标项，比如**Main**指标记录渲染主线程的任务执行过程，**Compositor 指标**记录了合成线程的任务执行过程，**GPU 指标**记录了 GPU 进程主线程的任务执行过程。有了这些详细的性能数据，就可以帮助我们轻松地定位页面的性能问题。

简而言之，**我们通过概览面板来定位问题的时间节点，然后再使用性能面板分析该时间节点内的性能数据。**

分析性能面板各个指标项的具体含义。参考下图：

![images](performance46.png)

观看上图的左边，我们可以看到它是由很多性能指标项组成的，比如 Network、Frames、Main 等，下我们就来一一分析这些性能指标项的含义。

- **Main 指标**，它记录了渲染进程的主线程的任务执行记录，在 Performace 录制期间，在渲染主线程程上执行的所有记录都可以通过 Main 指标来查看，你可以通过点击 Main 来展开主进程的任务执行记录。具体你可以观察下图：

![images](performance47.png)

观察上图，一段段横条代表执行一个个任务，长度越长，花费的时间越多；竖向代表该任务的执行记录。

Main 指标就是记录渲染主线上所执行的全部**任务**，以及每个任务的详细执行**过程**。

具体内容可参考[加餐五 | 性能分析工具：如何分析 Performance 中的 Main 指标？](https://time.geekbang.org/column/article/179428)

- **Network 指标**，网络记录展示了页面中的每个网络请求所消耗的时长，并以瀑布流的形式展现。这块内容和网络面板的瀑布流类似，之所以放在性能面板中是为了方便我们和其他指标对照着分析。
- **Timings 指标**，用来记录一些关键的时间节点在何时产生的数据信息，关于这些时间点的信息可以参考上一篇文章[性能优化——专业术语](https://km.xiaowuzi.info/project/performance-5.html)
- **Frames 指标**，也就是浏览器生成每帧的记录，我们知道页面所展现出来的画面都是由渲染进程一帧一帧渲染出来的，帧记录就是用来记录渲染进程生成所有帧信息，包括了渲染出每帧的时长、每帧的图层构造等信息，你可以点击对应的帧，然后在详细信息面板里面查看具体信息。
- **Interactions 指标**，用来记录用户交互操作，比如点击鼠标、输入文字等交互信息。

#### 2.5 详情面板

通过性能面板的分析，我们知道了性能面板记录了多种指标的数据信息，并且以图形式展现在性能面板上。

### 参考资料

- [加餐四｜页面性能工具：如何使用 Performance？](https://time.geekbang.org/column/article/177070)
- [加餐五 | 性能分析工具：如何分析 Performance 中的 Main 指标？](https://time.geekbang.org/column/article/179428)
- [前端性能优化之利用 Chrome Dev Tools 进行页面性能分析](https://juejin.im/post/5e3ce5fb51882549575f7dea)

## 联系作者

<div align="center">
    <p>
        平凡世界，贵在坚持。
    </p>
    <img :src="$withBase('/about/contact.png')" />
</div>
