# B 树与 B+树

## 前言

本人平时学习及收集内容，欢迎参入一起讨论。

## 内容

- [定义](#一、B树定义)
- [查找](#二、B树查找)
- [插入](#三、B树插入)
- [B 树删除](#四、B树删除)
- [B+树定义](#五、B+树定义)
- [B+树插入](#六、B+树插入)
- [B+树删除](#七、B+树删除)

### 一、B 树定义

**B 树**也称 B-树，B-树直接读作 B 树，不能因为有“-”号就读作 B 减树，它是一颗多路平衡查找树。我们描述一颗 B 树时需要指定它的除数，除数表示了一个结点最多有多少个孩子结点，一般用字母 m 表示除数。当 m 取 2 时，就是我们常见的二叉搜索树，m 为 3 时是 2-3 树。

一颗 m 阶的 B 树定义如下：

1. 每个结点最多有 m-1 个关键字。
2. 根结点最少可以只有 1 个关键字。
3. 非根结点至少有 Math.ceil(m/2)-1 个关键字。Math.ceil(m/2)含义是向上取整。例如 Math.ceil(4.5)=5。
4. 每个结点中的关键字都按照从小到大的顺序排列，每个关键字的左子树中的所有关键字都小于它，而右子树中的所有关键字都大于它。
5. 所有叶子结点都位于同一层，或者说根结点到每个叶子结点的长度相同。

### 二、B 树查找

B-树的查找其实是对二叉搜索树查找的扩展，与二叉搜索树不同的地方是，B-树中每个节点有不止一棵子树。在 B-树中查找某个结点时，需要先判断要查找的结点在哪棵子树上，然后在结点中逐个查找目标结点。B 树的查找过程相对简单，与二叉搜索树类似。

### 三、B 树插入

#### 3.1 B 树的插入流程

1. 根据要插入的 key 的值，对 B 树执行查找操作，查找到待插入数据的当前节点位置。
2. 判断当前结点 key 的个数是否小于等于 m-1，若满足，则结束直接插入数据，否则，进行下一步。
3. 以结点中间的 key 为中心分裂成左右两部分，然后将这个中间的 key 插入到父结点中，这个 key 的左子树指向分裂后的左半部分，这个 key 的右子支指向分裂后的右半部分，然后将当前结点指向父结点，继续进行第三步。

#### 3.2 实例图解

#### 3.3 性能分析

B 树插入过程首先需要执行一次查找操作，B 树的查找操作的时间复杂度为 O(mlogmn)。其中 m 为 B 树的阶数，n 为 B 树中 key 的数目。

### 四、B 树删除

#### 4.1 删除流程

1. 如果当前需要删除的 key 位于非叶子结点上，则用后继 key（这里的后继 key 均指后继记录的意思）覆盖要删除的 key，然后在后继 key 所在的子支中删除该后继 key。此时后继 key 一定位于叶子结点上，这个过程和二叉搜索树删除结点的方式类似。删除这个记录执行下一步
2. 该结点 key 个数大于等于 Math.ceil(m/2)-1，结束删除操作，否则执行第三步。
3. 如果兄弟结点 key 个数大于 Math.ceil(m/2)-1，则父结点中的 key 下移到该结点，兄弟结点中的一个 key 上移，删除操作结束。否则，将父结点中的 key 下移与当前结点及它的兄弟结点中的 key 合并，形成一个新的结点。原父结点中的 key 的两个孩子指针就变成了一个孩子指针，指向这个新结点。然后当前结点的指针指向父结点，重复第二步。

#### 4.2 实例图解

#### 4.3 性能分析

B 树的删除操作同样需要执行查找过程，时间复杂度为 O(mlogmn)。删除数据过程与插入过程类似，最坏情况需要回溯 O(h)。因此 B 树的删除操作的时间复杂度近似为 O(mlogmn)。

### 五、B+树定义

### 六、B+树插入

### 七、B+树删除

### 参考资料

- [B 树和 B+树的插入、删除图文详解](https://www.cnblogs.com/nullzx/p/8729425.html)
- [平衡二叉树、B 树、B+树、`B*`树 理解其中一种你就都明白了](https://zhuanlan.zhihu.com/p/27700617)
- [心里没点 B 树。。。](https://mp.weixin.qq.com/s/5ERFlmeUGXnfQPAZBLn6RA)

## 联系作者

<div align="center">
    <p>
        平凡世界，贵在坚持。
    </p>
    <img :src="$withBase('/about/contact.png')" />
</div>
