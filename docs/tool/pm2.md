# pm2 工具

## 前言

pm2 是 node 进程管理工具，可以利用它来简化很多 node 应用管理的繁琐任务，如性能监控、自动重启、负载均衡等，因为在工作中遇到服务器重启后，需要一个个去重新启动每个服务，这样不仅繁琐、效率低，而且容易遗忘开启一些服务。

## 内容

- 安装&目录
- 常用命令
- 配置文件
- 高阶应用

### 一、安装&目录

#### 1.1 运行以下命令进行全局安装

```
npm install -g pm2
```

#### 1.2 安装完之后，会自动创建以下目录：

```
$HOME/.pm2/logs // 包括所有应用的日志
$HOME/.pm2/pids // 包括所有应用的 pids
$HOME/.pm2/dump.pm2 // 开机自启动配置
$HOME/.pm2/pm2.log // pm2 日志
$HOME/.pm2/pm2.pid // pm2 pid

```

### 二、常用命令

#### 2.1 启动命令

```
pm2 start app.js
```

启动成功后，我们对应可以看到启动的服务的一些信息，如下所示：

![images](pm2-01.png)

#### 2.2 命令行参数

我们可以在最基本的启动命令后面，添加一些参数选项，去满足我们的需求，常用的参数选项如下所示：

- `--watch`：监听应用目录的变化，一旦发生变化，自动重启。
- `-i or --instance`：启用多少个实例，可用于负载均衡，如果-i 0 或或者-i max，则根据当前机器核数确定实例数目。
- `--ingore-watch`：排队监听的目录或文件，可以是特定的文件名，也可以是与此正则。
- `-n or --name`：应用的名称，查看应用信息的时候可以用到。
- `-o or --output path`：标准输出日志文件的路径。
- `-e or --error path`：错误输出日志文件的路径

```
pm2 start app.js --watch -i max -n first_app
```

启动成功后的截图如下，我们通过截图可以看到启动的应用名称变为 first_app，然后启动四个进程，说明我们在启动命令后面添加的参数已经起作用。

![images](pm2-02.png)

#### 2.3 重启命令

```
pm2 restart app.js
```

#### 2.4 停止命令

停止特定的应用，可以通过 pm2 list 先获取应用的名字或者

```
pm2 stop app_name | app_id
```

#### 2.5 删除命令

```
pm2 delete app_name | app_id
```

如果需要删除全部的应用，则使用以下命令：

```
pm2 delete all
```

#### 2.6 查看有哪些进程

```
pm2 list
```

#### 2.7 查看某个进程的信息

```
pm2 descripe app_name | app_id
```

相应的进程信息输出如下所示：

### 三、配置文件

### 四、高阶应用

#### 4.1 负载均衡

#### 4.2 日志查看

### 参考资料

- [pm2 实践指南](https://juejin.im/post/5e1fa941e51d451c774dcc18)

## 联系作者

<div align="center">
    <p>
        平凡世界，贵在坚持。
    </p>
    <img :src="$withBase('/about/contact.png')" />
</div>
