sudo: true
git:
  submodules: false
branches:
  only:
    - master
language: node_js
cache:
  directories:
    - node_modules
node_js:
  - '10'
before_install:
  # 注意 这里我改成了 ~/.ssh/id_rsa 而不是自动生成的 ~\/.ssh/id_rsa
  - openssl aes-256-cbc -K $encrypted_######_key -iv $encrypted_######_iv -in id_rsa.enc -out ~/.ssh/id_rsa -d
  # 赋予权限
  - chmod 600 ~/.ssh/id_rsa
install:
  - npm install
script:
  - npm km:build
after_success:
  # $DEPLOY_USER 环境变量：服务器用户名
  # $DEPLOY_HOST 环境变量：服务器IP
  # 项目目录 你在服务器上的项目目录
  - ssh "$DEPLOY_USER"@"$DEPLOY_HOST" -o StrictHostKeyChecking=no 'cd /data/www/km && git pull && bash ./deploy.sh'
addons:
  ssh_known_hosts:
    # 你的服务器IP
    - '$DEPLOY_HOST'
